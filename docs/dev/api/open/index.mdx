---
title: 开放接口
---
import APITable from '@site/src/components/APITable';
import { GET, POST, DELETE } from '@site/src/components/RequestTag';

## 接口基准地址

- `http://localhost:5678/api/open`

服务端已开启 CORS 跨域支持

## 需要授权

需要在 **请求头（Header）** 或 **请求地址参数（URL）** 中使用 `api-token` 字段并提供 `openApiToken（令牌）` 的值

```bash title="获取令牌的方法"
arcadia service info
```
每次修改管理面板登录认证信息后都会随机生成一个新的 `32` 位字符串

## 安全的操作

接口方法都经过了严格的设计和实现，以确保操作的安全性，并且加强了传参的校验  
接口响应一般不会返回原生错误信息，当然如果你遇到了请主动反馈

## 接口响应规范

数据返回格式统一使用 JSON

| 状态码 |   说明   |
| :---: | :-----: |
|  `0`  |  请求失败 |
|  `1`  |  请求成功 |
| `4403` |  认证失败 |

| 参数 | 说明 |
| :----: | :-----: |
|  code  | 业务代码 |
|  message | 消息 |
|  type | 类型 |
|  result | 返回结果 |

***

## 用户自定义接口

目前后端使用 Node.js® 编写，所以如果你想使用这个功能则需要会写一些 JavaScript 代码

:::info 编写规范
将代码存放在 **config** 目录下的 `extra_server.js` 脚本（自行创建）中，执行 `arcadia service restart` 重启服务后生效，注意届时检查日志进行确认  
脚本需要导出唯一函数名，已固定函数传参详见下方示例，接口框架使用 [Express v4](https://www.expressjs.com.cn)，更多编写方法请查阅其文档
:::

请参考下方的简单示例

```jsx language=javascript title="extra_server.js" showLineNumbers
async function Main(api, API_STATUS_CODE, logger) {
    // api express框架实例
    // API_STATUS_CODE 接口响应封装模板
    // logger 日志组件，支持分级（info、warn、debug、error、fatal）
    api.get('/test1', function (request, response) {
        // queryParams = request.query
        try {
            const msg = '/api/open/test1 GET 接口请求成功'
            response.send(API_STATUS_CODE.okData(msg)) // 请求成功
            logger.info(msg)
        } catch (e) {
            response.send(API_STATUS_CODE.fail(e.message)) // 请求失败
        }
    })
    api.post('/test2', function (request, response) {
        // bodyParams = request.body
        try {
            const msg = '/api/open/test2 POST 接口请求成功'
            response.send(API_STATUS_CODE.okData(msg)) // 请求成功
            logger.info(msg)
        } catch (e) {
            response.send(API_STATUS_CODE.fail(e.message)) // 请求失败
        }
    })
}

module.exports = Main
```

## 接口类别

import DocCardList from '@theme/DocCardList';

<DocCardList />
