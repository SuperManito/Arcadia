---
title: 环境变量
toc_max_heading_level: 2
---
import Tabs from '@theme/Tabs';
import TabItem from '@theme/TabItem';
import APITable from '@site/src/components/APITable';
import { GET, POST } from '@site/src/components/RequestTag';

为了提高开发效率已将请求传参设计为了更容易理解的形式，但更改返回数据的字段名称不太现实  
所以建议使用前先学习项目[数据模型](/docs/dev/api/internal/env)设计并了解前端实现


## 获取分页

#### <GET>/env/v1/page</GET>

### 请求

<APITable>

| 名称 | 类型 | 必填 | 描述 |
| --- | :-: | :-: | --- |
| `type` | `string<'ordinary' \| 'composite' \| 'composite_value'>` | 是 | 变量类型，分别对应普通变量、复合变量(组)、复合变量的值 |
| `page` | `string` | 否 | 指定页数，默认`1` |
| `size` | `string` | 否 | 指定分页大小数量，默认`20` |
| `composite_id` | `string` | 否 | 查看复合变量的值时需要指定此参数为复合变量(组)的唯一标识 |
| `search` | `string` | 否 | 搜索内容过滤，涉及变量名称、用户标签 |
| `enable` | `string<'0' \| '1'>` | 否 | 变量状态过滤，`1 启用 \| 0 禁用` |
| `orderBy` | `string` | 否 | 指定排序字段，默认 `sort`（暂不支持其它字段） |
| `order` | `string<'0' \| '1'>` | 否 | 指定排序方式 `0 升序 \| 1 降序`，默认降序 |

</APITable>

### 响应

<APITable>

| 名称 | 类型 | 描述 |
| --- | :-: | --- |
| `data` | `object[]` | 数据项 |
| `page` | `number` | 当前页码 |
| `size` | `number` | 每页数据量 |
| `total` | `number` | 数据总量 |

</APITable>

<details>
<summary>点此展开查看具体响应数据示例</summary>

<Tabs>

<TabItem value="ordinary&composite_value" label="普通变量 / 复合变量的值">

数据项（主要为数据库 `envs` 表字段）

<APITable>

| 名称 | 类型 | 描述 |
| --- | :-: | --- |
| `id` | `number` | 唯一标识 |
| `group_id` | `number` | `envs_group` 表 `id` 字段关联记录 |
| `type` | `string` | 变量名称 |
| `tag_list` | `string<object>` | 标签，`label名称 \| color颜色(HEX)` |
| `description` | `string` | 描述 |
| `remark` | `string` | 备注 |
| `value` | `string` | 值 |
| `sort` | `number` | 在分页中的位置序号（正整数），默认按照先后顺序递增 |
| `enable` | `number` | 启用状态，`1 启用 \| 0 禁用` |

</APITable>

```json title="响应数据示例"
{
  "data": [
    {
      "id": 1,
      "group_id": 0,
      "type": "TEST1",
      "tag_list": "[{\"label\":\"test\",\"color\":\"#2080f0\"}]",
      "description": "",
      "remark": "",
      "value": "测试1",
      "sort": 0,
      "enable": 1
    },
    {
      "id": 2,
      "group_id": 0,
      "type": "TEST2",
      "tag_list": "",
      "description": "",
      "remark": "",
      "value": "测试2",
      "sort": 0,
      "enable": 0
    },
    ...
  ],
  "total": 5,
  "page": 1,
  "size": 20
}
```
默认倒序返回


</TabItem>

<TabItem value="composite" label="复合变量（组）">

数据项（主要为数据库 `envs_group` 表记录）

<APITable>

| 名称 | 类型 | 描述 |
| --- | :-: | --- |
| `id` | `number` | 唯一标识 |
| `type` | `string` | 变量名称 |
| `description` | `string` | 描述 |
| `tag_list` | `string<object>` | 标签，`label名称 \| color颜色(HEX)` |
| `separator` | `string` | 分割字符 |
| `sort` | `number` | 在分页中的位置序号（正整数），默认按照先后顺序递增 |
| `enable` | `number` | 启用状态，`1 启用 \| 0 禁用` |
| `envs` | `number` | 成员（复合变量的值）长度 |

</APITable>

```json title="响应数据示例"
{
  "data": [
    {
      "id": 1,
      "type": "TEST1",
      "description": "",
      "tag_list": "",
      "separator": "",
      "sort": 1,
      "enable": 1,
      "envs": 0
    },
    {
      "id": 2,
      "type": "TEST2",
      "description": "@",
      "tag_list": "",
      "separator": "",
      "sort": 0,
      "enable": 1,
      "envs": 3
    },
    ...
  ],
  "total": 3,
  "page": 1,
  "size": 20
}
```
默认倒序返回

</TabItem>

</Tabs>

</details>


## 查询数据

### 查询指定名称的变量

#### <GET>/v1/queryName</GET>

<APITable>

| 名称 | 类型 | 必填 | 描述 |
| --- | :-: | :-: | --- |
| `name` | `string` | 是 | 名称关键字 |

</APITable>

根据项目设计，变量名称是唯一的

### 查询复合变量的值

#### <GET>/v1/queryMember</GET>

<APITable>

| 名称 | 类型 | 必填 | 描述 |
| --- | :-: | :-: | --- |
| `id` | `string` | 是 | 唯一标识 |
| `value` | `string` | 是 | 值关键字 |

</APITable>

只匹配复合变量的值不匹配备注

## 调整排序

#### <POST>/env/v1/order</POST>

<APITable>

| 名称 | 类型 | 必填 | 描述 |
| --- | :-: | :-: | --- |
| `id` | `number` | 是 | 唯一标识 |
| `isComposite` | `boolean` | 否 | 是否为复合变量(组)，否则为普通变量和复合变量的值，默认否 |
| `order` | `number` | 否 | 目的修改位置 |
| `moveToEnd` | `boolean` | 否 | 是否移动到最后 |

</APITable>

至少需要提供 `order` 或 `moveToEnd` 其中一个，设置 `moveToEnd` 时 `order` 参数的值会被覆盖

设置 `moveToEnd` 为 `true` 时，`order` 参数的值会被覆盖为所有记录 `sort` 字段中的最大值，与其相反的操作是将 `order` 参数的值设置为 `1`。关于置顶或置底操作应建立在可视化的角度上，前端分页数据默认均为倒序返回所以应注意区分使用场景，只有复合变量值的排序有实际意义，并且在前端设计中只有管理复合变量值的表格加上了正向排序的功能。

:::info 总结：除复合变量值以外对于其它变量记录的排序无实际意义且操作方向相反，因为分页数据是倒序返回的，即最近添加的变量靠前展示。
:::


## 删除

#### <POST>/env/v1/delete</POST>

<APITable>

| 名称 | 类型 | 必填 | 描述 |
| --- | :-: | :-: | --- |
| `id` | `number \| number[]` | 是 | 唯一标识 |
| `isComposite` | `boolean` | 否 | 是否为复合变量(组)，否则为普通变量和复合变量的值，默认否 |

</APITable>
