import{_ as we}from"./PageWrapper.vue_vue_type_style_index_0_lang-DleleeUi.js";import{_ as $e,B as Fe,a as Oe}from"./TableAction.vue_vue_type_script_setup_true_lang-DOnW1aZm.js";import{_ as Me}from"./search2-line-C7V4Mle5.js";import{_ as Ie}from"./plus-B-AkAw1V.js";import{I as Pe,bp as Le,bq as Ue,A as u,am as l,b7 as T,br as qe,bs as Ke,bt as Ve,bu as le,a7 as m,a8 as f,a9 as o,aa as s,u as n,aG as S,aK as ie,ax as Ge,aR as je,aF as se,ay as We,aw as He,aS as _,aL as v,av as I,aA as re,bv as ce,at as Ee,au as Je,B as Qe,a_ as Xe,ap as Ye,bw as Ze,bx as et,bd as tt,by as at,aE as nt,aT as ot,b3 as lt,ba as it,aM as st,bz as rt}from"./vendor-CsvKI2kS.js";import{I as r}from"./Icon-w75mFLja.js";import{a as ct,c as ut,d as pt}from"./index-hO6mdrNR.js";import{u as dt}from"./useAppInject-BoZf51bk.js";import{u as bt}from"./useLocale-CiQ9eAn6.js";import{u as mt}from"./useRunLog-wCZ9Nz23.js";import{u as gt}from"./useTransition-66F1_su1.js";import{r as yt,s as ft,a as _t,e as ue,d as pe,E as vt,g as ht,b as kt}from"./editTask-C6WcnYCD.js";import{_ as Ct}from"./viewHistory.vue_vue_type_script_setup_true_lang-Cd2wN3qr.js";import{_ as zt}from"./viewSourceFile.vue_vue_type_script_setup_true_lang-DR5drqO9.js";import"./sharp-arrow-back-ios-DPZSNare.js";import"./useDesign-7pXfWKnw.js";import"./clickOutside-DGRBMUUq.js";import"./download-simple-bold-CrGQmHNY.js";import"./question-circle-outlined-BBN51sNn.js";import"./propTypes-C3nnPquf.js";import"./more-horiz-pnQhQE51.js";import"./cronVisualization.vue_vue_type_script_setup_true_lang-BP_qT9sT.js";import"./clock-plus-outline-zI7Ya36t.js";import"./zoom-out-line-C8dCBZPI.js";import"./fullscreen-CDp7Z4mn.js";import"./file-h9mNNik_.js";import"./index-CYBHNIXZ.js";import"./swap-outlined-C6YFrvtc.js";import"./fileUnknown-BsScC3-k.js";import"./file-question-outline-Bbpb0p_t.js";const xt={key:3},Tt={class:"table-toolbar-right-icon"},St={style:{color:"var(--app-primary-color)"}},Rt=Pe({__name:"index",setup(At){const{getIsMobile:i}=dt(),{t}=ct(),{getLocale:P}=bt(),L=P.value==="zh_CN"?Le:Ue,{message:g,confirm:D}=ut(),{runLog:de}=mt(),U=u("fade-slide");gt(U);const d=u("system"),be=u([{type:"system",name:t("page.cron.type.system")},{type:"user",name:t("page.cron.type.user")}]),q=u(),K=u([]),V=u([]),h=u([]),G=u(!1),z=u(!1),j=u(),N=u(),W=u(),H=u(),me=u([{label:()=>l(T,{style:{color:"var(--app-info-color)"}},{default:()=>t("page.cron.table.action.enable.button")}),key:"enable",icon:()=>l(r,{icon:"mdi:timer-check-outline",color:"var(--app-info-color)",style:"vertical-align: baseline"},{}),props:{onClick:()=>{ee(!0)}}},{label:t("page.cron.table.action.disable.button"),key:"disable",icon:()=>l(r,{icon:"mdi:alarm-off",style:"vertical-align: baseline"},{}),props:{onClick:()=>{ee(!1)}}},{label:()=>l(T,{style:{color:"var(--app-error-color)"}},{default:()=>t("page.cron.table.action.delete.button")}),key:"delete",icon:()=>l(r,{icon:"fe:trash",color:"var(--app-error-color)",style:"vertical-align: baseline"},{}),props:{onClick:()=>{ke()}}}]),E=u([]),ge=[{type:"selection",key:"selection",width:"3%"},{title:t("page.cron.table.title.name"),key:"name",width:i.value?180:"10%",renderFilterIcon:()=>l(r,{icon:"ic:round-filter-list",style:"vertical-align: baseline"},{}),defaultFilterOptionValues:[],filterOptions:E,filter(){}},{title:t("page.cron.table.title.cron"),key:"cron",width:i.value?140:"8%",resizable:!0},{title:t("page.cron.table.title.shell"),key:"shell",width:i.value?360:"20%",resizable:!0,render(e){return d.value==="user"?l(qe,{code:String(e.shell||""),language:"shell",inline:!0,trim:!0},{}):l("span",{style:{fontFamily:"var(--app-font-family-mono)"}},String(e.shell||""))}},{title:t("page.cron.table.title.remark"),key:"remark",width:i.value?void 0:"8%",resizable:!0},{title:t("page.cron.table.title.create_time"),key:"create_time",align:"center",width:i.value?void 0:"10%",sorter:!0,defaultSortOrder:!1},{title:t("page.cron.table.title.last_runtime"),key:"last_runtime",align:"center",width:i.value?void 0:"10%",render(e){return e.last_runtime?Date.now()-new Date(e.last_runtime).getTime()<1e3*60*60?Ke(new Date(e.last_runtime),{addSuffix:!0,locale:L}):e.last_runtime:t("page.cron.table.last_runtime.never")},sorter:!0,defaultSortOrder:!1},{title:t("page.cron.table.title.last_run_use"),key:"last_run_use",align:"right",titleAlign:"right",width:i.value?void 0:"7%",render(e){if(e.last_run_use===0)return t("page.cron.table.zeroSeconds");if(!e.last_run_use===null)return t("page.cron.table.none");const a=Math.ceil(Number(e.last_run_use)),p=Math.floor(a/86400),C=Math.floor((a-p*86400)/3600),b=Math.floor((a-p*86400-C*3600)/60),O=a-p*86400-C*3600-b*60;return Ve({days:p,hours:C,minutes:b,seconds:O},{locale:L})},sorter:!0,defaultSortOrder:!1},{title:t("page.cron.table.title.isRunning"),key:"isRunning",align:"center",width:i.value?void 0:"7%",render(e){return l(le,{type:e.isRunning?"success":"default",round:!!e.isRunning},{default:()=>e.isRunning?t("page.cron.table.status.running"):t("page.cron.table.status.idle"),icon:()=>l(r,{icon:e.isRunning?"svg-spinners:12-dots-scale-rotate":"mdi:sleep",style:"vertical-align: baseline"},{})})}},{title:t("page.cron.table.title.active"),key:"active",align:"center",width:i.value?void 0:"6%",renderFilterIcon:()=>l(r,{icon:"ic:round-filter-list",style:"vertical-align: baseline"},{}),render(e){return l(le,{type:e.active===1?"success":"error",bordered:!1,style:P.value==="zh_CN"?"":"width: 66px; line-height: 28px; display: block; text-align: center"},{default:()=>e.active===1?t("common.active"):t("common.inactive")})},defaultFilterOptionValues:[],filterOptions:[{label:t("common.active"),value:1},{label:t("common.inactive"),value:0}],filter(){}}],x=(e,a)=>{switch(e){case"edit":return{icon:"mdi:square-edit-outline",tooltip:t("page.cron.table.action.edit"),quaternary:!0,focusable:!1,onClick:J.bind(null,a)};case"debug":return{icon:"mdi:bug-play-outline",tooltip:t("page.cron.table.action.debug"),quaternary:!0,focusable:!1,onClick:Q.bind(null,a)};case"run":return{icon:"tabler:clock-play",iconProps:{size:18},tooltip:t("page.cron.table.action.run.button"),quaternary:!0,focusable:!1,loading:a?.is_operation===!0,onClick:X.bind(null,a)};case"terminate":return{icon:"tabler:clock-stop",iconProps:{size:18},tooltip:t("page.cron.table.action.terminate.button"),quaternary:!0,focusable:!1,loading:a?.is_operation===!0,onClick:Y.bind(null,a)};case"history":return{icon:"mdi:history",iconProps:{size:21},tooltip:t("page.cron.table.action.history"),quaternary:!0,focusable:!1,disabled:!a.logPath,onClick:Z.bind(null,a)}}},ye={title:t("page.cron.table.title.action"),key:"action",titleAlign:i.value?"center":"left",width:i.value?68:void 0,fixed:i.value?"right":void 0,render(e){const a={edit:{label:t("page.cron.table.action.edit"),key:"edit",icon:()=>l(r,{icon:"mdi:square-edit-outline",size:18,style:"vertical-align: baseline"},{}),props:{onClick:J.bind(null,e)}},history:{label:t("page.cron.table.action.history"),key:"history",disabled:!e.logPath,icon:()=>l(r,{icon:"mdi:history",size:20,style:"vertical-align: baseline"},{}),props:e.logPath?{onClick:Z.bind(null,e)}:{}},run:{label:t("page.cron.table.action.run.button"),key:"debug",icon:()=>l(r,{icon:"tabler:clock-play",size:18,style:"vertical-align: baseline"},{}),props:{onClick:X.bind(null,e)}},terminate:{label:t("page.cron.table.action.terminate.button"),key:"debug",icon:()=>l(r,{icon:"tabler:clock-stop",size:18,style:"vertical-align: baseline"},{}),props:{onClick:Y.bind(null,e)}},debug:{label:t("page.cron.table.action.debug"),key:"debug",icon:()=>l(r,{icon:"mdi:bug-play-outline",size:20,style:"vertical-align: baseline"},{}),props:{onClick:Q.bind(null,e)}},source:{label:t("page.cron.table.action.source"),key:"source",icon:()=>l(r,{icon:"mdi:file-eye-outline",size:18,style:"vertical-align: baseline"},{}),props:{onClick:fe.bind(null,e)}},changeStatus:{label:e.active===1?t("page.cron.table.action.disable.button"):t("page.cron.table.action.enable.button"),key:"changeStatus",icon:()=>l(r,{icon:e.active===1?"mdi:alarm-off":"mdi:timer-check-outline",size:18,style:"vertical-align: baseline"},{}),props:{onClick:ve.bind(null,e)}},delete:{label:()=>l(T,{style:{color:"var(--app-error-color)"}},{default:()=>t("page.cron.table.action.delete.button")}),key:"delete",icon:()=>l(r,{icon:"fe:trash",size:18,color:"var(--app-error-color)",style:"vertical-align: baseline"},{}),props:{onClick:he.bind(null,e)}},sort:{label:t("page.cron.table.action.sort.title"),key:"sort",icon:()=>l(r,{icon:"mdi:sort",style:"vertical-align: baseline"},{}),children:[{label:t("page.cron.table.action.sort.moveUp"),key:"sortMoveUp",icon:()=>l(r,{icon:"material-symbols:arrow-upward-rounded",style:"vertical-align: baseline"},{}),props:{onClick:w.bind(null,e,"up")}},{label:t("page.cron.table.action.sort.moveDown"),key:"sortMoveDown",icon:()=>l(r,{icon:"material-symbols:arrow-downward-rounded",style:"vertical-align: baseline"},{}),props:{onClick:w.bind(null,e,"down")}},{label:t("page.cron.table.action.sort.moveTop"),key:"sortMoveTop",icon:()=>l(r,{icon:"material-symbols:text-select-move-up-rounded",style:"vertical-align: baseline"},{}),props:{onClick:w.bind(null,e,"top")}}]}};let p={};return d.value==="system"&&e.bind?i.value?p={style:"button",actions:[],dropDownActions:[a.edit,a[e?.isRunning?"terminate":"run"],a.history,a.debug,a.source,a.changeStatus,a.sort,a.delete]}:p={style:"button",actions:[x("edit",e),x(e?.isRunning?"terminate":"run",e),x("history",e)],dropDownActions:[a.debug,a.source,a.changeStatus,a.sort,a.delete]}:i.value?p={style:"button",actions:[],dropDownActions:[a.edit,a[e?.isRunning?"terminate":"run"],a.debug,a.changeStatus,a.sort,a.delete]}:p={style:"button",actions:[x("edit",e),x(e?.isRunning?"terminate":"run",e)],dropDownActions:[a.debug,a.changeStatus,a.sort,a.delete]},l($e,p)}},J=async e=>{N.value?.open(e)},Q=async e=>{de.value?.open({title:`${e.name}`,cmd:e.shell})},X=async e=>{e.is_operation=!0;try{await yt({id:e.id})}catch{g.error(t("page.cron.table.action.run.errorMsg"))}finally{e.is_operation=!1,y()}},Y=async e=>{e.is_operation=!0;const a=g.loading(t("page.cron.table.action.terminate.loadingMsg"),{duration:0});try{await ft({id:e.id}),a.type="success",a.content=t("page.cron.table.action.terminate.successMsg")}catch{a.type="error",a.content=t("page.cron.table.action.terminate.errorMsg")}finally{e.is_operation=!1,y(),setTimeout(()=>{a.destroy()},1e3)}},Z=async e=>{W.value?.open(e)},fe=async e=>{H.value?.open(e)},w=async(e,a)=>{const{id:p,sort:C}=e;try{let b;switch(a){case"up":b={id:p,order:C+1};break;case"down":b={id:p,order:C-1};break;case"top":b={id:p,moveToEnd:!0};break;default:return}await _t(b),g.success(t("page.cron.table.message.sort.ok")),y()}catch{}},_e=async()=>{const e=await kt();E.value=e.filter(a=>a.bind).map(a=>({value:a.bind,label:a.bind}))},ve=async e=>{try{await ue([{id:e.id,active:e.active===0?1:0}]),g.success(e.active===1?t("page.cron.table.message.disable.ok"):t("page.cron.table.message.enable.ok"),{duration:1500}),e.active===0?e.active=1:e.active=0}catch{g.error(e.active===1?t("page.cron.table.message.disable.fail"):t("page.cron.table.message.enable.fail"))}},he=e=>{D.error({title:t("page.cron.table.action.delete.title"),content:t("page.cron.table.action.delete.confirm"),icon:()=>l(r,{icon:"fe:trash",style:"vertical-align: baseline"},{}),closable:!1,maskClosable:!1,autoFocus:!1,positiveText:t("page.cron.table.action.delete.button"),onPositiveClick:async()=>{try{await pe({id:e.id}),g.success(t("page.cron.table.message.delete.ok"))}catch{g.error(t("page.cron.table.message.delete.fail"))}finally{y()}},negativeButtonProps:{ghost:!1,tertiary:!0}})},ke=()=>{D.error({title:t("page.cron.table.action.delete.batchTitle"),content:t("page.cron.table.action.delete.batchConfirm"),icon:()=>l(r,{icon:"fe:trash",size:24,style:"vertical-align: baseline"},{}),closable:!1,maskClosable:!1,autoFocus:!1,onPositiveClick:async()=>{try{await pe({id:h.value.map(e=>Number(e))}),g.success(t("page.cron.table.message.delete.ok"))}catch{g.error(t("page.cron.table.message.delete.fail"))}finally{y()}},negativeButtonProps:{ghost:!1,tertiary:!0}})},ee=e=>{D.info({title:t(`page.cron.table.action.${e?"enable":"disable"}.batchTitle`),content:t(`page.cron.table.action.${e?"enable":"disable"}.batchConfirm`),icon:()=>l(r,{icon:e?"mdi:timer-check-outline":"mdi:alarm-off",size:24,style:"vertical-align: baseline"},{}),closable:!1,maskClosable:!1,autoFocus:!1,onPositiveClick:async()=>{try{await ue(h.value.map(a=>({id:Number(a),active:e?1:0}))),g.success(t(`page.cron.table.message.${e?"enable":"disable"}.ok`))}catch{g.error(t(`page.cron.table.message.${e?"enable":"disable"}.fail`))}finally{y()}},negativeButtonProps:{ghost:!1,tertiary:!0}})},y=()=>{setTimeout(()=>{q.value?.reload()},250),h.value=[]},$=()=>{z.value=!0,y(),z.value=!1},R=()=>{k.value="",y()},Ce=e=>{K.value=e.active,V.value=e.name},A=u(""),B=u(""),ze=async e=>{switch(e.order){case"ascend":A.value=e.columnKey,B.value="0";break;case"descend":A.value=e.columnKey,B.value="1";break;case!1:A.value="",B.value="";break}y()},k=u(""),xe=async e=>{const a=d.value==="system";return a&&await _e(),await ht({page:e.page,size:e.size,type:d.value,search:k.value||"",active:K.value.join(","),tags:a?V.value.join(","):"",orderBy:A.value,order:B.value})},F=async e=>{switch(e){case"createTask":d.value!=="user"&&(d.value="user",y()),N.value?.open({type:d.value});break;case"showSearchBar":G.value=!0,Qe().then(()=>{j.value?.focus()});break}};return(e,a)=>{const p=rt,C=Xe,b=Ye,O=Ie,te=Ze,Te=et,M=Me,ae=tt,Se=at,ne=nt,oe=Oe,Re=ot,Ae=lt,Be=it,De=st,Ne=we;return m(),f(Ne,{ref:"pageWrapper","content-full":"","no-header":""},{default:o(()=>[s(De,{bordered:!n(i),style:{height:"100%"},"header-style":n(i)?"padding: 0 10px":"","content-style":n(i)?"padding: 10px":""},{header:o(()=>[n(i)?(m(),f(C,{key:0,value:n(d),"onUpdate:value":[a[0]||(a[0]=c=>S(d)?d.value=c:null),R],type:"segment",size:"small",animated:""},{default:o(()=>[(m(!0),ie(je,null,Ge(n(be),c=>(m(),f(p,{key:c.type,name:c.type},{default:o(()=>[_(v(c.name),1)]),_:2},1032,["name"]))),128))]),_:1},8,["value"])):se("",!0)]),default:o(()=>[s(n(Fe),{ref_key:"tableRef",ref:q,"checked-row-keys":n(h),"onUpdate:checkedRowKeys":a[7]||(a[7]=c=>S(h)?h.value=c:null),"table-id":"CRON",class:We({"not-system-table":n(d)!=="system"}),"pagination-behavior-on-filter":"first",columns:ge,"default-hide-keys":["create_time"],request:xe,"row-key":c=>`${c.id}`,"action-column":ye,"onUpdate:filters":Ce,"onUpdate:sorter":ze},He({tableTitle:o(()=>[s(ne,{wrap:!1},{default:o(()=>[n(i)?(m(),f(b,{key:1,secondary:"",type:"primary",size:"small",style:{padding:"0 6px"},focusable:!1,onClick:a[2]||(a[2]=c=>F("createTask"))},{icon:o(()=>[s(O)]),_:1})):(m(),f(b,{key:0,type:"primary",size:"small",style:{height:"32px"},focusable:!1,onClick:a[1]||(a[1]=c=>F("createTask"))},{default:o(()=>[_(v(n(t)("page.cron.table.new")),1)]),_:1})),n(i)?se("",!0):(m(),f(Te,{key:2,value:n(d),"onUpdate:value":a[3]||(a[3]=c=>S(d)?d.value=c:null),variant:"default-filled",class:"t-radio-group","on-change":R},{default:o(()=>[s(te,{value:"system"},{default:o(()=>[_(v(n(t)("page.cron.type.system")),1)]),_:1}),s(te,{value:"user"},{default:o(()=>[_(v(n(t)("page.cron.type.user")),1)]),_:1})]),_:1},8,["value"])),n(i)?(m(),f(ae,{key:4,value:n(k),"onUpdate:value":a[6]||(a[6]=c=>S(k)?k.value=c:null),loading:n(z)||void 0,size:"small",clearable:"",placeholder:n(t)("page.cron.table.search.placeholder"),"on-clear":R,onKeyup:ce($,["enter"])},{prefix:o(()=>[s(M)]),_:1},8,["value","loading","placeholder"])):(m(),ie("div",xt,[n(G)?(m(),f(re,{key:1,name:n(U),mode:"default",appear:""},{default:o(()=>[s(Se,{style:{height:"32px"}},{default:o(()=>[s(ae,{ref_key:"searchBarInputRef",ref:j,value:n(k),"onUpdate:value":a[5]||(a[5]=c=>S(k)?k.value=c:null),disabled:n(z),loading:n(z)||void 0,size:"small",clearable:"",placeholder:n(t)("page.cron.table.search.placeholder"),"on-clear":R,onKeyup:ce($,["enter"])},{prefix:o(()=>[s(M)]),_:1},8,["value","disabled","loading","placeholder"]),s(b,{strong:"",secondary:"",type:"primary",size:"small",style:{height:"32px"},onClick:$},{default:o(()=>[_(v(n(t)("common.searchText")),1)]),_:1})]),_:1})]),_:1},8,["name"])):(m(),f(b,{key:0,strong:"",secondary:"",size:"small",style:{padding:"0 8px",height:"32px"},focusable:!1,onClick:a[4]||(a[4]=c=>F("showSearchBar"))},{icon:o(()=>[s(M)]),_:1}))]))]),_:1})]),toolbar:o(()=>[Ee(s(re,{name:"fade-slide-left",mode:"out-in",appear:""},{default:o(()=>[s(ne,{wrap:!1},{default:o(()=>[s(Be,{size:"small",trigger:"click",options:n(me)},{default:o(()=>[n(i)?(m(),f(Ae,{key:1,trigger:"hover"},{trigger:o(()=>[I("div",Tt,[s(Re,{size:"20"},{default:o(()=>[s(oe)]),_:1})])]),default:o(()=>[I("span",null,v(n(t)("page.cron.table.action.batchAction")),1)]),_:1})):(m(),f(b,{key:0,strong:"",secondary:"",size:"small",type:"primary",style:{padding:"0 8px"},focusable:!1},{icon:o(()=>[s(oe)]),default:o(()=>[_(" "+v(n(t)("page.cron.table.action.batchAction")),1)]),_:1}))]),_:1},8,["options"])]),_:1})]),_:1},512),[[Je,n(h).length]])]),_:2},[n(h).length&&!n(i)?{name:"info",fn:o(()=>[s(n(T),null,{default:o(()=>[_(v(n(t)("common.selected")),1)]),_:1}),_("  "),I("span",St,v(n(h).length),1),_("  "),s(n(T),null,{default:o(()=>[_(v(n(t)("common.item")),1)]),_:1})]),key:"0"}:void 0]),1032,["checked-row-keys","class","row-key"])]),_:1},8,["bordered","header-style","content-style"]),s(vt,{ref_key:"editTask",ref:N,onOk:y},null,512),s(Ct,{ref_key:"viewHistory",ref:W},null,512),s(zt,{ref_key:"viewSourceFile",ref:H},null,512)]),_:1},512)}}}),la=pt(Rt,[["__scopeId","data-v-d3fd1bf0"]]);export{la as default};
