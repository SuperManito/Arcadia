import{_ as de}from"./PageWrapper.vue_vue_type_style_index_0_lang-DleleeUi.js";import{a as ce,c as ue,_ as pe}from"./index-hO6mdrNR.js";import{_ as fe,a as _e}from"./sliders-horizontal-bold-BGnHX10c.js";import{_ as me,f as ge}from"./content-save-check-BS8DyfgP.js";import{I as ve}from"./Icon-w75mFLja.js";import{a7 as D,aK as he,av as ye,I as be,A as i,G as Q,aP as we,aQ as xe,a8 as T,aw as ke,u as e,a9 as t,aa as n,aG as S,aT as _,at as ze,au as Se,aS as C,aL as B,aF as Ce,aA as J,am as u,bk as Be,aU as De,bA as Ie,bB as Ee,ap as Ne,a$ as Pe,aE as $e,bb as Fe,aV as Te,aM as Ve}from"./vendor-CsvKI2kS.js";import{_ as Oe}from"./index.vue_vue_type_style_index_0_lang-dhZkmg3Y.js";import{u as Ue}from"./useAppInject-BoZf51bk.js";import{s as Le,a as X,g as Ae}from"./file-h9mNNik_.js";import{a as Y,b as Me,c as We}from"./index-CYBHNIXZ.js";import{f as je}from"./filePrefix-DWnX-gtz.js";import"./sharp-arrow-back-ios-DPZSNare.js";import"./useDesign-7pXfWKnw.js";import"./propTypes-C3nnPquf.js";import"./useTextMate-UgNy7zwp.js";const He={style:{display:"inline-block"},viewBox:"0 0 24 24",width:"1em",height:"1em"},Re=ye("path",{fill:"currentColor",d:"M10 18H6v-2h4zm0-4H6v-2h4zm0-13v1H6c-1.11 0-2 .89-2 2v16a2 2 0 0 0 2 2h4v1h2V1zm10 7v12c0 1.11-.89 2-2 2h-4v-2h4v-9h-4V9h4.5L14 4.5V2zm-4 6h-2v-2h2zm0 4h-2v-2h2z"},null,-1),Ge=[Re];function qe(Z,v){return D(),he("svg",He,[...Ge])}const Ke={name:"mdi-file-compare",render:qe},un=be({__name:"index",setup(Z){const{getIsMobile:v}=Ue(),{t:d}=ce(),{message:W}=ue(),b=i(),V=i([]),O=i([]),j=i({}),I=i({content:"",language:""}),w=i(""),E=i(!v.value),N=i(v.value?13:15),P=i("on"),U=i(!1),c=i(""),p=i(""),L=i(!1),A=i(!1),h=i(!1),m=i(!1),x=async l=>{switch(l){case"findBox":U.value=!U.value,m.value=!1;break;case"showEditorShortcutsInfo":b.value.showShortCuts();break;case"wordWrap":P.value=P.value==="on"?"off":"on",m.value=!1;break;case"renderSideBySide":E.value=!E.value,m.value=!1;break;case"save":L.value=!0;const a=e(b).getValue();try{await Le({content:a,path:c.value}),W.success(d("editor.main.savedSuccess"))}finally{L.value=!1}break}},ee=async()=>{h.value=!0;const l=await X({}),a=H(l);V.value=a;const s=await X({}),f=H(s);O.value=f,h.value=!1},H=l=>{const a=f=>{f.length&&f.forEach(o=>{if(o.type===0)Object.assign(o,{key:o.path,label:o.title,prefix:()=>u(_,null,{default:()=>u(Y)})}),a(o.children),o.children.length||(Object.assign(o,{children:null}),o.prefix=()=>u(_,null,{default:()=>u(ge)}));else{const g=o.name;if(g){const M=g.substring(g.lastIndexOf(".")+1),k=We[M]||{};Object.assign(o,{key:o.path,label:g,language:k.language||"plaintext",disabled:k.disabled||!1,prefix:()=>u(_,null,{default:()=>u(k.icon||je)})})}}})};a(l);const s=f=>f.filter(o=>o.children?(o.children=s(o.children),!0):!o.disabled);return l=s(l),l},$=(l,a,s)=>{if(s.node)switch(s.action){case"expand":s.node.prefix=()=>u(_,null,{default:()=>u(Me)});break;case"collapse":s.node.prefix=()=>u(_,null,{default:()=>u(Y)});break}},R=async(l,a)=>{A.value=!0;const s=await Ae({path:encodeURI(l.key)});if(s)switch(a){case"config":I.value={content:s,language:l.language};break;case"sample":w.value=s;break}else{switch(a){case"config":break;case"sample":w.value="";break}W.info(d("page.diff.fileContentIsEmptyMsg"))}A.value=!1},G=({option:l})=>({async onClick(){!l.children&&!l.disabled&&(j.value=l,await R(l,"config"))}}),q=({option:l})=>({async onClick(){!l.children&&!l.disabled&&(j.value=l,await R(l,"sample"))}}),F=({option:l})=>l.children?"toggleExpand":"default";return Q(c,l=>{l||(I.value={content:"",language:""})}),Q(p,l=>{l||(w.value="")}),we(async()=>{await ee()}),xe(()=>{b.value&&b.value.dispose()}),(l,a)=>{const s=Be,f=Ke,o=De,g=Ie,M=Ee,k=fe,y=Ne,z=ve,ne=Pe,K=$e,ae=Fe,te=me,le=_e,oe=Te,se=pe,ie=Ve,re=de;return D(),T(re,{ref:"pageWrapper","content-full":"",title:e(d)("routes.main.page.diff")},ke({extra:t(()=>[ze(n(J,{name:"fade",mode:"out-in",appear:""},{default:t(()=>[n(K,null,{default:t(()=>[n(o,{style:{gap:"0"}},{default:t(()=>[n(ae,{trigger:"manual",style:{padding:"8px"},show:e(m),"show-arrow":!1,placement:"bottom"},{trigger:t(()=>[n(y,{strong:"",quaternary:"",size:"small",type:e(m)?"primary":"tertiary",style:{padding:"6px"},focusable:!1,onClick:a[4]||(a[4]=r=>m.value=!e(m))},{default:t(()=>[n(e(_),{size:"18"},{default:t(()=>[n(k,{style:{"vertical-align":"baseline"}})]),_:1})]),_:1},8,["type"])]),default:t(()=>[n(K,{vertical:""},{default:t(()=>[n(o,{size:"small"},{default:t(()=>[n(z,{size:20,icon:"ri:font-size",style:{"vertical-align":"-0.45em"}}),n(ne,{value:e(N),"onUpdate:value":a[5]||(a[5]=r=>S(N)?N.value=r:null),min:12,max:40,"button-placement":"both",size:"small",style:{"text-align":"center",width:"116px"}},null,8,["value"])]),_:1}),n(o,{size:"small"},{default:t(()=>[n(z,{size:20,icon:"mdi:find-replace",style:{"vertical-align":"-0.45em"}}),n(y,{size:"small",strong:"",tertiary:"",style:{width:"116px"},onClick:a[6]||(a[6]=r=>x("findBox"))},{default:t(()=>[C(B(e(d)("editor.switch.findBtn")),1)]),_:1})]),_:1}),n(o,{size:"small"},{default:t(()=>[n(z,{size:20,color:e(P)==="on"?"var(--app-primary-color)":void 0,icon:"ant-design:swap-outlined",style:{"vertical-align":"-0.45em"}},null,8,["color"]),n(y,{size:"small",strong:"",tertiary:"",style:{width:"116px"},onClick:a[7]||(a[7]=r=>x("wordWrap"))},{default:t(()=>[C(B(e(d)("editor.switch.wordWrapBtn")),1)]),_:1})]),_:1}),n(o,{size:"small"},{default:t(()=>[n(z,{size:20,color:e(E)?void 0:"var(--app-primary-color)",icon:"fluent-mdl2:diff-inline",style:{"vertical-align":"-0.45em"}},null,8,["color"]),n(y,{size:"small",strong:"",tertiary:"",style:{width:"116px"},onClick:a[8]||(a[8]=r=>x("renderSideBySide"))},{default:t(()=>[C(B(e(d)("editor.switch.inlineModeTips")),1)]),_:1})]),_:1}),e(v)?Ce("",!0):(D(),T(o,{key:0,size:"small"},{default:t(()=>[n(z,{size:20,icon:"gg:shortcut",style:{"vertical-align":"-0.45em"}}),n(y,{size:"small",strong:"",tertiary:"",style:{width:"116px"},onClick:a[9]||(a[9]=r=>x("showEditorShortcutsInfo"))},{default:t(()=>[C(B(e(d)("editor.switch.viewShortcuts")),1)]),_:1})]),_:1}))]),_:1})]),_:1},8,["show"])]),_:1}),n(y,{strong:"",type:"primary",size:"small",disabled:!e(c),loading:e(L),focusable:!1,onClick:a[10]||(a[10]=r=>x("save"))},{icon:t(()=>[n(te)]),default:t(()=>[C(" "+B(e(d)("editor.main.saveButton")),1)]),_:1},8,["disabled","loading"])]),_:1})]),_:1},512),[[Se,e(c)&&e(p)]])]),default:t(()=>[n(ie,{bordered:!e(v),style:{height:"100%","word-break":"unset"},"content-style":"padding: 0"},{default:t(()=>[n(J,{name:"fade",mode:"out-in",appear:""},{default:t(()=>[e(I).content||e(w)?(D(),T(Oe,{key:0,ref_key:"editor",ref:b,value:e(I),"origin-value":e(w),"diff-mode":"","word-wrap":e(P),"render-side-by-side":e(E),"font-size":e(N),"find-box":e(U)},null,8,["value","origin-value","word-wrap","render-side-by-side","font-size","find-box"])):(D(),T(oe,{key:1,class:"min-h-200px flex-jc-ac h-full",size:"huge",description:e(d)("common.selectFileEmptyDesc")},{icon:t(()=>[n(e(_),null,{default:t(()=>[n(le)]),_:1})]),_:1},8,["description"]))]),_:1}),n(se,{show:e(A)},null,8,["show"])]),_:1},8,["bordered"])]),_:2},[e(v)?{name:"headerContent",fn:t(()=>[n(M,{"x-gap":12,cols:2},{default:t(()=>[n(g,null,{default:t(()=>[n(s,{value:e(p),"onUpdate:value":a[2]||(a[2]=r=>S(p)?p.value=r:null),size:"small",loading:e(h),"consistent-menu-width":!1,clearable:"",placement:"bottom-start",placeholder:e(d)("page.diff.selectSourceFilePlaceholder"),options:e(O),"override-default-node-click-behavior":F,"node-props":q,"on-update:expanded-keys":$},null,8,["value","loading","placeholder","options"])]),_:1}),n(g,null,{default:t(()=>[n(s,{value:e(c),"onUpdate:value":a[3]||(a[3]=r=>S(c)?c.value=r:null),size:"small",loading:e(h),"consistent-menu-width":!1,clearable:"",placement:"bottom-end",placeholder:e(d)("page.diff.selectDestinationFilePlaceholder"),options:e(V),"override-default-node-click-behavior":F,"node-props":G,"on-update:expanded-keys":$},null,8,["value","loading","placeholder","options"])]),_:1})]),_:1})]),key:"1"}:{name:"subtitle",fn:t(()=>[n(o,null,{default:t(()=>[n(s,{value:e(p),"onUpdate:value":a[0]||(a[0]=r=>S(p)?p.value=r:null),size:"small",style:{"min-width":"200px",width:"fit-content"},"show-path":"",loading:e(h),"consistent-menu-width":!1,clearable:"",placeholder:e(d)("page.diff.selectSourceFilePlaceholder"),options:e(O),"override-default-node-click-behavior":F,"node-props":q,"on-update:expanded-keys":$},null,8,["value","loading","placeholder","options"]),n(e(_),{size:"24",depth:3},{default:t(()=>[n(f)]),_:1}),n(s,{value:e(c),"onUpdate:value":a[1]||(a[1]=r=>S(c)?c.value=r:null),size:"small",style:{"min-width":"200px",width:"fit-content"},"show-path":"",loading:e(h),"consistent-menu-width":!1,clearable:"",placeholder:e(d)("page.diff.selectDestinationFilePlaceholder"),options:e(V),"override-default-node-click-behavior":F,"node-props":G,"on-update:expanded-keys":$},null,8,["value","loading","placeholder","options"])]),_:1})]),key:"0"}]),1032,["title"])}}});export{un as default};
