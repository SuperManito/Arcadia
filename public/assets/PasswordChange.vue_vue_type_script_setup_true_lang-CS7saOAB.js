import{a7 as l,aK as L,av as se,u as r,cH as Me,cI as De,cJ as Oe,cK as Te,cL as ge,s as K,bd as $e,aY as je,by as _e,cM as Ae,a$ as Ue,cN as Le,co as Ge,cp as Ee,cO as qe,cP as ze,cQ as Je,cR as Ke,bk as He,bL as We,cA as Qe,cF as Ye,bm as Xe,cq as Ze,I as be,A as G,r as xe,bR as et,h as T,ai as tt,G as ne,aP as ye,a8 as _,a9 as i,aa as $,ab as nt,ac as ot,aR as E,ax as J,aJ as A,aw as st,O as oe,aS as D,aL as O,b1 as pe,cS as rt,aF as U,az as fe,b7 as at,b3 as lt,bI as it,aU as ut,cx as ct,cT as dt,cU as pt,cV as ft,bn as mt,bA as gt,ap as _t,aT as bt,bB as yt,bo as Pt,c9 as ht,B as Nt,aM as wt}from"./vendor-DM0AKlTY.js";import{_ as kt}from"./question-circle-outlined-BY_ocw0L.js";import{a4 as H,ag as vt,a3 as Pe,ah as me,a2 as he,a as Ne,a1 as It,ai as Ft,aj as Bt,d as Rt,ak as Vt,al as Ct,q as St,c as Mt,am as Dt}from"./index-C5WsbIcI.js";import{p as N}from"./propTypes-BWpnk_hf.js";import{u as Ot}from"./useBreakpoint-rfcbhKbi.js";const Tt={style:{display:"inline-block"},viewBox:"0 0 1024 1024",width:"1em",height:"1em"},$t=se("path",{fill:"currentColor",d:"M890.5 755.3L537.9 269.2c-12.8-17.6-39-17.6-51.7 0L133.5 755.3A8 8 0 0 0 140 768h75c5.1 0 9.9-2.5 12.9-6.6L512 369.8l284.1 391.6c3 4.1 7.8 6.6 12.9 6.6h75c6.5 0 10.3-7.4 6.5-12.7"},null,-1),jt=[$t];function At(e,p){return l(),L("svg",Tt,[...jt])}const Ut={name:"ant-design-up-outlined",render:At},Lt={style:{display:"inline-block"},viewBox:"0 0 1024 1024",width:"1em",height:"1em"},Gt=se("path",{fill:"currentColor",d:"M884 256h-75c-5.1 0-9.9 2.5-12.9 6.6L512 654.2L227.9 262.6c-3-4.1-7.8-6.6-12.9-6.6h-75c-6.5 0-10.3 7.4-6.5 12.7l352.6 486.1c12.8 17.6 39 17.6 51.7 0l352.6-486.1c3.9-5.3.1-12.7-6.4-12.7"},null,-1),Et=[Gt];function qt(e,p){return l(),L("svg",Lt,[...Et])}const zt={name:"ant-design-down-outlined",render:qt};function Jt(e){return e?["NPicker","NSelect","NCheckbox","NRadio","NSwitch","NDatePicker","NTimePicker"].includes(e)?"请选择":"请输入":""}function Kt(e,p,f=!0){switch(p){case"NDatePicker":case"NTimePicker":e.type=f?"string":"object";break;case"NUpload":case"NCheckboxGroup":case"NDateRangePicker":e.type="array";break;case"NInputNumber":e.type="number";break}}function Ht({emit:e,getProps:p,formModel:f,getSchema:P,formElRef:u,defaultFormModel:C,handleFormValues:o}){async function m(){return r(u)?.validate()}async function c(h){h&&h.preventDefault();const{submitFunc:d}=r(p);if(d&&H(d)){await d(f);return}if(r(u))try{return await m(),e("submit",f),f}catch{return!1}}async function w(){await r(u)?.restoreValidation()}async function I(){const{resetFunc:h,submitOnReset:d}=r(p);if(h&&H(h)&&await h(),!r(u))return;r(P).forEach(j=>{Me(f,j.field,()=>ge(C.value,j.field)||null)}),await w();const M=o(f);e("reset",M),d&&await c()}function y(){return r(u)?o(f):{}}async function B(h){const d=r(P).map(k=>De(k.field)?k.field[0]:k.field).filter(Boolean);Object.keys(h).forEach(k=>{const M=h[k];d.includes(k)&&(f[k]=Oe(M)?Te(f[k],M):M)})}return{handleSubmit:c,validate:m,resetFields:I,getFieldsValue:y,clearValidate:w,setFieldsValue:B}}function Wt({defaultFormModel:e,getSchema:p,formModel:f}){function P(C){if(!vt(C))return{};const o={};for(const m of Object.entries(C)){let[,c]=m;const[w]=m;!w||Pe(c)&&c.length===0||H(c)||me(c)||(he(c)&&(c=c.trim()),K(o,w,c))}return o}function u(){const C=r(p),o={},m=c=>{c.forEach(w=>{const{defaultValue:I,childrens:y}=w;me(I)||(K(o,w.field,I),K(f,w.field,I)),y&&y?.length>0&&m(y)})};m(C),e.value=o}return{handleFormValues:P,initDefault:u}}const Qt={model:{type:Object,default:{}},disabled:N.bool.def(!1),require:N.bool.def(!1),rulesMessageJoinLabel:N.bool.def(!0),labelWidth:N.stringNumber.def(80),schemas:{type:[Array],default:()=>[]},inline:N.bool.def(!1),size:N.string.def("medium"),labelPlacement:N.string,isFull:N.bool.def(!0),showActionButtonGroup:N.bool.def(!0),showResetButton:N.bool.def(!0),resetButtonOptions:Object,showSubmitButton:N.bool.def(!0),submitButtonOptions:Object,showAdvancedButton:N.bool.def(!0),submitButtonText:N.string,resetButtonText:N.string,gridProps:Object,giProps:Object,formItemProps:Object,baseGridStyle:Object,collapsed:N.bool.def(!1),collapsedRows:N.number.def(1)},b=new Map;b.set("NInput",$e);b.set("NDynamicInput",je);b.set("NInputGroup",_e);b.set("NInputGroupLabel",Ae);b.set("NInputNumber",Ue);b.set("NAutoComplete",Le);b.set("NSelect",Ge);b.set("NSwitch",Ee);b.set("NCascader",qe);b.set("NSlider",ze);b.set("NRate",Je);b.set("NTransfer",Ke);b.set("NTreeSelect",He);b.set("NDatePicker",We);b.set("NTimePicker",Qe);b.set("NColorPicker",Ye);b.set("NUpload",Xe);b.set("NDivider",Ze);const Yt=be({name:"BasicForm",props:{...Qt},emits:["reset","submit","register"],setup(e,{emit:p,attrs:f}){const{t:P}=Ne(),{smaller:u,sizeEnum:C}=Ot(),o=G({}),m=xe({}),c=G({}),w=G(null),I=G(null),y=G(!1),B=G(!1),h=et(()=>u(C.MD).value?"top":"left"),d=T(()=>{const n=Object.assign({},e,r(c)),a={rules:{}};return(n.schemas||[]).forEach(v=>{const S=Ve(v);K(a.rules,v.field,S)}),{...n,...r(a)}}),k=T(()=>{const{schemas:n}=r(d);return{schemas:n,model:r(m)}});function M(n){if(Pe(n))return n.join(".");if(he(n))return n}function j(n){const{rulesMessageJoinLabel:a,label:g,component:v}=n,{rulesMessageJoinLabel:S}=e,R=Reflect.has(n,"rulesMessageJoinLabel")?a:S;return`${Jt(v)}${R?g??"":""}`}function q(n){const{component:a}=n;let g;switch(a){case"NInputTextarea":g="NInput";break;case"NInputPassword":g="NInput";break;case"NDateRangePicker":g="NDatePicker";break;case"NDatetimeRangePicker":g="NDatePicker";break;default:g=a}return b.get(g)}function X(n){const{component:a,componentProps:g}=n;let v={};switch(a){case null:case void 0:break;case"NInputTextarea":v={type:"textarea"};break;case"NInputPassword":v={type:"password"};break;case"NDateRangePicker":v={type:"daterange"};break;case"NDatetimeRangePicker":v={type:"datetimerange"};break}const S=g??{};return{clearable:!0,placeholder:j(n),disabled:W(n),...v,...S}}function W(n){const{disabled:a}=n,{disabled:g}=r(d);return H(a)?a(k.value):a??g??!1}function Z(n){const{show:a=!0}=n;return H(a)?a(k.value):a}const x=T(()=>Object.assign({size:e.size,type:"default"},c.value.resetButtonOptions)),ee=T(()=>Object.assign({size:e.size,type:"primary"},c.value.submitButtonOptions)),t=T(()=>r(d).inline),s=T(()=>{const{gridProps:n}=r(d);return{responsive:"screen",collapsed:t.value?y.value:!1,cols:1,...n}});function te(n){const{giProps:a}=n,{giProps:g}=r(d);return{span:1,...g,...a}}const we=T(()=>{const{labelPlacement:n,...a}=r(d);return{...f,...e,...a,labelPlacement:n??h.value}}),Q=T(()=>{const n=r(w)||r(d).schemas;for(const a of n){const{defaultValue:g,bindVal:v="value",bindUpdateVal:S="update:value"}=a;a.bindVal=v,a.bindUpdateVal=S,g&&(a.defaultValue=g)}return n}),{handleFormValues:ke,initDefault:re}=Wt({defaultFormModel:o,getSchema:Q,formModel:m}),{handleSubmit:ae,validate:ve,resetFields:le,getFieldsValue:Ie,clearValidate:Fe,setFieldsValue:ie}=Ht({emit:p,getProps:d,formModel:m,getSchema:Q,formElRef:I,defaultFormModel:o,handleFormValues:ke});function Be(){y.value=!y.value}async function Re(n){c.value=Bt(r(c)||{},n)}function Ve(n){const{rules:a=[],show:g,required:v,component:S}=n;let R=tt(a);const ue=["blur","input"],ce=j(n);function Se(F,V){const Y=F.message||ce;return V===void 0||Ft(V)||Array.isArray(V)&&V.length===0||typeof V=="string"&&V.trim()===""||typeof V=="object"&&Reflect.has(V,"checked")&&Reflect.has(V,"halfChecked")&&Array.isArray(V.checked)&&Array.isArray(V.halfChecked)&&V.checked.length===0&&V.halfChecked.length===0?Promise.reject(Y):Promise.resolve()}(!R||R.length===0)&&v&&(R=[{required:v,validator:Se,trigger:ue}]);const de=R.findIndex(F=>Reflect.has(F,"required")&&!Reflect.has(F,"validator"));if(de!==-1){const F=R[de];It(g)&&!g&&(F.required=!1),S&&(Reflect.has(F,"type")||Kt(F,S),F.message=F.message||ce,F.trigger=ue,S.includes("NInput")&&(F.whitespace=!0))}const z=R.findIndex(F=>F.max);return z!==-1&&!R[z].validator&&(R[z].message=R[z].message||P("component.form.maxTip",[R[z].max])),R}const Ce={getFieldsValue:Ie,setFieldsValue:ie,resetFields:le,validate:ve,clearValidate:Fe,setProps:Re,submit:ae};return ne(()=>Q.value,n=>{r(B)||n?.length&&(re(),B.value=!0)}),ne(()=>r(d).model,n=>{n&&ie(n)},{immediate:!0}),ye(()=>{re(),p("register",Ce)}),{t:P,get:ge,set:K,formElRef:I,formModel:m,getGrid:s,getGridItem:te,getProps:d,getShow:Z,getFormItemPath:M,getBindValue:we,getSchema:Q,getSubmitBtnOptions:ee,getResetBtnOptions:x,handleSubmit:ae,resetFields:le,isInline:t,getComponentProps:X,getComp:q,unfoldToggle:Be,componentMap:b}}});function Xt(e,p,f,P,u,C){const o=at,m=kt,c=lt,w=it,I=ut,y=ct,B=dt,h=pt,d=ft,k=_e,M=mt,j=gt,q=_t,X=zt,W=bt,Z=Ut,x=yt,ee=Pt;return l(),_(ee,A(e.getBindValue,{ref:"formElRef",model:e.formModel,class:"mt-2"}),{default:i(()=>[$(x,nt(ot(e.getGrid)),{default:i(()=>[(l(!0),L(E,null,J(e.getSchema,t=>(l(),L(E,{key:t.field},[e.getShow(t)?(l(),_(j,A({key:0,ref_for:!0},e.getGridItem(t)),{default:i(()=>[$(M,A({label:t.label,path:e.getFormItemPath(t.field),ref_for:!0},t.formItemProps),st({default:i(()=>[t.slot?oe(e.$slots,t.slot,{key:0,model:e.formModel,field:t.field,value:e.get(e.formModel,t.field)},void 0,!0):t.component==="NCheckbox"?(l(),_(y,{key:1,value:e.formModel[t.field],"onUpdate:value":s=>e.formModel[t.field]=s},{default:i(()=>[$(I,null,{default:i(()=>[(l(!0),L(E,null,J(t?.componentProps?.options,s=>(l(),_(w,{key:s.value,value:s.value,label:s.label},null,8,["value","label"]))),128))]),_:2},1024)]),_:2},1032,["value","onUpdate:value"])):t.component==="NRadioGroup"?(l(),_(h,{key:2,value:e.formModel[t.field],"onUpdate:value":s=>e.formModel[t.field]=s},{default:i(()=>[$(I,A({ref_for:!0},t?.componentProps?.spaceProps),{default:i(()=>[(l(!0),L(E,null,J(t?.componentProps?.options,s=>(l(),_(B,{key:s.value,value:s.value},{default:i(()=>[D(O(s.label),1)]),_:2},1032,["value"]))),128))]),_:2},1040)]),_:2},1032,["value","onUpdate:value"])):t.component==="NRadioButtonGroup"?(l(),_(h,{key:3,value:e.formModel[t.field],"onUpdate:value":s=>e.formModel[t.field]=s},{default:i(()=>[(l(!0),L(E,null,J(t?.componentProps?.options,s=>(l(),_(d,{key:s.value,value:s.value},{default:i(()=>[D(O(s.label),1)]),_:2},1032,["value"]))),128))]),_:2},1032,["value","onUpdate:value"])):t.component==="NInputGroup"?(l(),_(k,{key:4},{default:i(()=>[(l(!0),L(E,null,J(t.childrens,s=>(l(),_(pe(e.getComp(s)),A({key:s.filed,ref_for:!0},e.getComponentProps(s),{value:e.get(e.formModel,s.field??t.field),class:{isFull:(s.isFull??t.isFull)!=!1&&e.getProps.isFull},"onUpdate:value":te=>e.set(e.formModel,s.field??t.field,te)}),{default:i(()=>[D(O(s?.defaultSlot),1)]),_:2},1040,["value","class","onUpdate:value"]))),128))]),_:2},1024)):(l(),_(pe(e.getComp(t)),A({key:5,ref_for:!0},e.getComponentProps(t),{[t.bindVal||""]:e.get(e.formModel,t.field),class:{isFull:t.isFull!=!1&&e.getProps.isFull}},{[rt(t.bindUpdateVal)]:s=>e.set(e.formModel,t.field,s)}),null,16,["class"])),t.suffix?oe(e.$slots,t.suffix,{key:6,model:e.formModel,field:t.field,value:e.get(e.formModel,t.field)},void 0,!0):U("",!0)]),_:2},[t.subLabel||t.labelMessage?{name:"label",fn:i(()=>[D(O(t.label)+" ",1),t.subLabel?(l(),_(o,{key:0,depth:3,class:"mr-2"},{default:i(()=>[D(O(t.subLabel),1)]),_:2},1024)):U("",!0),t.labelMessage?(l(),_(c,{key:1,trigger:"hover",style:fe(t.labelMessageStyle)},{trigger:i(()=>[$(m,{class:"text-18px cursor-pointer text-$app-text-color-3"})]),default:i(()=>[D(" "+O(t.labelMessage),1)]),_:2},1032,["style"])):U("",!0)]),key:"0"}:void 0]),1040,["label","path"])]),_:2},1040)):U("",!0)],64))),128)),e.getProps.showActionButtonGroup?(l(),_(j,{key:0,span:e.isInline?"":24,suffix:!!e.isInline},{default:i(({overflow:t})=>[$(I,{align:"center",justify:e.isInline?"end":"start",style:fe({"margin-left":`${e.isInline?12:e.getProps.labelWidth}px`,"margin-bottom":"24px"})},{default:i(()=>[e.getProps.showSubmitButton?(l(),_(q,A({key:0},e.getSubmitBtnOptions,{onClick:e.handleSubmit}),{default:i(()=>[D(O(e.getProps.submitButtonText??e.t("common.queryText")),1)]),_:1},16,["onClick"])):U("",!0),e.getProps.showResetButton?(l(),_(q,A({key:1},e.getResetBtnOptions,{onClick:e.resetFields}),{default:i(()=>[D(O(e.getProps.resetButtonText??e.t("common.resetText")),1)]),_:1},16,["onClick"])):U("",!0),e.isInline&&e.getProps.showAdvancedButton?(l(),_(q,{key:2,type:"primary",text:"","icon-placement":"right",onClick:e.unfoldToggle},{icon:i(()=>[t?(l(),_(W,{key:0,size:"14",class:"unfold-icon"},{default:i(()=>[$(X)]),_:1})):(l(),_(W,{key:1,size:"14",class:"unfold-icon"},{default:i(()=>[$(Z)]),_:1}))]),default:i(()=>[D(" "+O(t?"展开":"收起"),1)]),_:2},1032,["onClick"])):U("",!0)]),_:2},1032,["justify","style"])]),_:1},8,["span","suffix"])):U("",!0)]),_:3},16)]),_:3},16,["model"])}const Zt=Rt(Yt,[["render",Xt],["__scopeId","data-v-99776a72"]]);function xt(e){const p=G(null),f=G(!1);async function P(){const o=r(p);return o||console.error("The form instance has not been obtained, please make sure that the form has been rendered when performing the form operation!"),await Nt(),o}function u(o){ht(()=>{p.value=null,f.value=null}),!(r(f)&&Vt()&&o===r(p))&&(p.value=o,f.value=!0,ne(()=>e,()=>{e&&o.setProps(Ct(e))},{immediate:!0,deep:!0}))}return[u,{setProps:async o=>{await(await P()).setProps(o)},resetFields:async()=>{P().then(async o=>{await o.resetFields()})},clearValidate:async o=>{await(await P()).clearValidate(o)},getFieldsValue:()=>r(p)?.getFieldsValue(),setFieldsValue:async o=>{await(await P()).setFieldsValue(o)},submit:async()=>(await P()).submit(),validate:async o=>(await P()).validate(o)}]}const en={class:"grid grid-cols-1 grid-flow-row-dense md:grid-cols-[450px_1fr] gap-4"},an=be({__name:"PasswordChange",setup(e){const p=St(),f=T(()=>p.getUserInfo),{message:P}=Mt(),{t:u}=Ne(),C=[{field:"username",component:"NInput",label:u("setting.identity.username"),required:!0,componentProps:{placeholder:u("setting.identity.placeholder.userName")},defaultValue:f.value.username,rules:[{required:!0,validator(y,B){return B?!0:new Error(u("setting.identity.error.userNameEmpty"))},trigger:["input","blur"]}]},{field:"password",component:"NInput",label:u("setting.identity.newPassword"),required:!0,componentProps:{placeholder:u("setting.identity.placeholder.newPassword"),type:"password",showPasswordOn:"click"},rules:[{required:!0,validator(y,B){return B?!0:new Error(u("setting.identity.error.newPasswordEmpty"))},trigger:["input","blur"]}]},{field:"confirmPassword",component:"NInput",label:u("setting.identity.confirmNewPassword"),required:!0,componentProps:{type:"password",placeholder:u("setting.identity.placeholder.confirmNewPassword"),showPasswordOn:"click"},rules:[{required:!0,validator(y,B){return c().password!==B?new Error(u("setting.identity.error.confirmNewPasswordDiff")):!0},trigger:["input","blur"]}]}],[o,{setFieldsValue:m,getFieldsValue:c,validate:w}]=xt({schemas:C,labelPlacement:"top",gridProps:{cols:3,xGap:6},giProps:{span:2},submitButtonText:u("setting.identity.button.confirm")}),I=async y=>{await w(),await Dt({username:y.username,password:y.password}),P.warning(u("setting.identity.message.msgOk"));try{setTimeout(()=>{p.logout(!0)},2e3)}catch{}};return ye(async()=>{m({})}),(y,B)=>{const h=Zt,d=wt;return l(),_(d,{bordered:!1,style:{height:"100%"},"header-style":"padding: 10px 0 0 0","content-style":"padding: 0 0 20px 0; height: 100%"},{header:i(()=>[oe(y.$slots,"title")]),default:i(()=>[se("div",en,[$(h,{onRegister:r(o),onSubmit:I},null,8,["onRegister"])])]),_:3})}}});export{an as _};
