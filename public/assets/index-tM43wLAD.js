import{_ as Ce}from"./PageWrapper.vue_vue_type_style_index_0_lang-B-QjJlfz.js";import{_ as xe,B as we,a as ze}from"./TableAction.vue_vue_type_script_setup_true_lang-BWypmYWy.js";import{_ as Se}from"./search2-line-Cm_Nf99E.js";import{_ as Ae}from"./plus-DJS6TPSC.js";import{I as Te,A as p,am as s,b7 as N,ap as w,bu as Y,n as U,aE as V,b8 as Ee,a7 as b,a8 as v,a9 as l,aa as i,u as t,aG as A,aK as Z,ax as Ie,aR as Be,aF as ee,aw as De,aS as y,aL as f,av as K,aA as ae,bv as te,at as Ne,au as Re,B as $e,a_ as Oe,bw as Fe,bx as Le,bd as Ue,by as Ve,aT as Ke,b3 as qe,ba as Me,aM as Pe,bz as Ge}from"./vendor-CVUNLYN4.js";import{I as m}from"./Icon-ljQHnwJa.js";import{a as je,c as He}from"./index-BW0Kz9QR.js";import{u as We}from"./useAppInject-Dal6O7k8.js";import{u as Je}from"./useLocale-Dvvyb-u-.js";import{u as Qe}from"./useTransition-CObelXI-.js";import{d as ne,a as oe,s as Xe,b as Ye,c as Ze,e as ea,_ as aa,g as ta,f as na}from"./editEnv.vue_vue_type_script_setup_true_lang-DlpVQFnU.js";import oa from"./manageValue-B2-stVy5.js";import"./sharp-arrow-back-ios-DFVIULGe.js";import"./useDesign-DCKbhR-1.js";import"./clickOutside-JY6MVw26.js";import"./download-simple-bold-CPvWvumI.js";import"./question-circle-outlined-tr4rZkhQ.js";import"./propTypes-CYyueTg3.js";import"./more-horiz-C-LS9eeq.js";const la={key:3},sa={class:"table-toolbar-right-icon"},ia={style:{color:"var(--app-primary-color)"}},Ta=Te({__name:"index",setup(ra){const{getIsMobile:u}=We(),{t:a}=je(),{getLocale:le}=Je(),{message:_,confirm:q}=He(),M=p("fade-slide");Qe(M);const d=p("ordinary"),se=p([{type:"ordinary",name:a("page.env.type.ordinary")},{type:"composite",name:a("page.env.type.composite")}]),P=p([]),G=p(),h=p([]),j=p(!1),z=p(!1),H=p(),R=p(),T=p(),ie=p([{label:()=>s(N,{style:{color:"var(--app-error-color)"}},{default:()=>a("page.env.table.action.delete.button")}),key:"delete",icon:()=>s(m,{icon:"fe:trash",color:"var(--app-error-color)",style:"vertical-align: baseline"},{}),props:{onClick:()=>{de()}}}]),re=[{type:"selection",key:"selection",width:54},{title:a("page.env.table.title.type"),key:"type",resizable:!0,width:280,render(e){return e.type?s("span",{style:{fontFamily:"var(--app-font-family-mono)"}},e.type):""}},{title:a("page.env.table.title.value"),key:"value",resizable:!0,render(e){if(e.envs===void 0)return e.value?s("span",{style:{fontFamily:"var(--app-font-family-mono)"}},e.value):"";const n=e.envs;return s(w,{strong:!0,secondary:!0,size:"small",focusable:!0,onClick:()=>T.value?.open(e)},{default:()=>a("page.env.table.manageItems",[n])})}},{title:a("page.env.table.title.tag_list"),key:"tag_list",resizable:!0,width:200,render(e){try{const n=e.tag_list;if(!n)return"";const o=JSON.parse(n||"['']");if(!Array.isArray(o))return"";const c=[];if(o.forEach(x=>{const{label:g,color:S}=x;c.push(s(Y,{bordered:!1,color:{color:U(S).setAlpha(.12).toHex8String(),borderColor:U(S).toHexString(),textColor:U(S).toHexString()}},{default:()=>g}))}),c.length>0)return s(V,{style:"gap: 4px"},{default:()=>c})}catch{}return""}},{title:a("page.env.table.title.description"),key:"description",resizable:!0,width:200},{title:a("page.env.table.title.enable"),key:"enable",align:"center",width:120,fixed:u.value?void 0:"right",renderFilterIcon:()=>s(m,{icon:"ic:round-filter-list",style:"vertical-align: baseline"},{}),render(e){return s(Y,{type:e.enable===1?"success":"error",bordered:!1,style:le.value==="zh_CN"?"":"width: 66px; line-height: 28px; display: block; text-align: center"},{default:()=>e.enable===1?a("common.active"):a("common.inactive")})},defaultFilterOptionValues:[],filterOptions:[{label:a("common.active"),value:1},{label:a("common.inactive"),value:0}],filter(){}}],E=(e,n)=>{switch(e){case"edit":return{icon:"mdi-square-edit-outline",tooltip:a("page.env.table.action.edit"),quaternary:!0,focusable:!1,onClick:W.bind(null,n)};case"changeStatus":return{icon:n.enable===1?"tabler-variable-off":"tabler-variable",tooltip:n.enable===1?a("page.env.table.action.disable.button"):a("page.env.table.action.enable.button"),quaternary:!0,focusable:!1,onClick:J.bind(null,n)};case"manage":return{icon:"mdi-database-cog-outline",tooltip:a("page.env.table.action.manage"),quaternary:!0,focusable:!1,onClick:()=>T.value?.open(n)}}},ce={title:a("page.env.table.title.action"),key:"action",titleAlign:u.value?"center":"left",width:u.value?68:140,fixed:"right",render(e){const n=d.value==="composite",o={edit:{label:a("page.env.table.action.edit"),key:"edit",icon:()=>s(m,{icon:"mdi:square-edit-outline",style:"vertical-align: baseline"},{}),props:{onClick:W.bind(null,e)}},delete:{label:()=>s(N,{style:{color:"var(--app-error-color)"}},{default:()=>a("page.env.table.action.delete.button")}),key:"delete",icon:()=>s(m,{icon:"fe:trash",color:"var(--app-error-color)",style:"vertical-align: baseline"},{}),props:{onClick:pe.bind(null,e)}},changeStatus:{label:e.enable===1?a("page.env.table.action.disable.button"):a("page.env.table.action.enable.button"),key:"changeStatus",icon:()=>s(m,{icon:e.enable===1?"tabler:variable-off":"tabler:variable",style:"vertical-align: baseline"},{}),props:{onClick:J.bind(null,e)}},manage:{label:a("page.env.table.action.manage"),key:"manage",icon:()=>s(m,{icon:"mdi:database-cog-outline",style:"vertical-align: baseline"},{}),props:{onClick:()=>T.value?.open(e)}},sort:{label:a("page.env.table.action.sort.title"),key:"sort",icon:()=>s(m,{icon:"mdi:sort",style:"vertical-align: baseline"},{}),children:[{label:a("page.env.table.action.sort.moveUp"),key:"sortMoveUp",icon:()=>s(m,{icon:"material-symbols:arrow-upward-rounded",style:"vertical-align: baseline"},{}),props:{onClick:$.bind(null,e,"up")}},{label:a("page.env.table.action.sort.moveDown"),key:"sortMoveDown",icon:()=>s(m,{icon:"material-symbols:arrow-downward-rounded",style:"vertical-align: baseline"},{}),props:{onClick:$.bind(null,e,"down")}},{label:a("page.env.table.action.sort.moveTop"),key:"sortMoveTop",icon:()=>s(m,{icon:"material-symbols:text-select-move-up-rounded",style:"vertical-align: baseline"},{}),props:{onClick:$.bind(null,e,"top")}}]},export:{label:a("page.env.table.action.export"),key:"export",icon:()=>s(m,{icon:"mdi:content-copy",style:"vertical-align: baseline"},{}),props:{iconProps:{size:"16"},onClick:ue.bind(null,e)}}};let c;return n?u.value?c={style:"button",actions:[],dropDownActions:[o.edit,o.manage,o.changeStatus,o.sort,o.delete]}:c={style:"button",actions:[E("edit",e),E("manage",e)],dropDownActions:[o.changeStatus,o.sort,o.delete]}:u.value?c={style:"button",actions:[],dropDownActions:[o.edit,o.changeStatus,o.export,o.sort,o.delete]}:c={style:"button",actions:[E("edit",e),E("changeStatus",e)],dropDownActions:[o.export,o.sort,o.delete]},s(xe,c)}},W=async e=>{R.value?.open(d.value,e)},pe=e=>{q.error({title:a("page.env.table.action.delete.title"),content:a("page.env.table.action.delete.confirm"),icon:()=>s(m,{icon:"fe:trash",style:"vertical-align: baseline"},{}),closable:!1,maskClosable:!1,autoFocus:!1,positiveText:a("page.env.table.action.delete.button"),onPositiveClick:async()=>{try{d.value==="composite"?await ne({id:e.id}):await oe({id:e.id}),_.success(a("page.env.table.message.delete.ok"))}catch{_.error(a("page.env.table.message.delete.fail"))}finally{k()}},negativeButtonProps:{ghost:!1,tertiary:!0}})},J=async e=>{try{const n=d.value==="composite",o=Object.assign({},e,{enable:e.enable===0?1:0});n?(delete o.envs,await Xe(o)):await Ye(o),_.success(e.enable===1?a("page.env.table.message.disable.ok"):a("page.env.table.message.enable.ok"),{duration:1500}),e.enable===0?e.enable=1:e.enable=0}catch{_.error(e.enable===1?a("page.env.table.message.disable.fail"):a("page.env.table.message.enable.fail"))}},ue=async e=>{Ee().copy(`export ${e.type}="${e.value}"`).then(()=>{_.success(a("common.copyOk"))}).catch(()=>{_.error(a("common.copyFail"))})},$=async(e,n)=>{const o=d.value==="composite",{id:c,sort:x}=e;try{let g;switch(n){case"up":g={id:c,order:x+1};break;case"down":g={id:c,order:x-1};break;case"top":g={id:c,moveToEnd:!0};break;default:return}o?await Ze(g):await ea(g),_.success(a("page.env.table.message.sort.ok")),k()}catch{}},de=()=>{q.error({title:a("page.env.table.action.delete.batchTitle"),content:a("page.env.table.action.delete.batchConfirm"),icon:()=>s(m,{icon:"fe:trash",size:24,style:"vertical-align: baseline"},{}),closable:!1,maskClosable:!1,autoFocus:!1,onPositiveClick:async()=>{try{const e=h.value.map(o=>Number(o));d.value==="composite"?await ne({id:e}):await oe({id:e}),_.success(a("page.env.table.message.delete.ok"))}catch{_.error(a("page.env.table.message.delete.fail"))}finally{k()}},negativeButtonProps:{ghost:!1,tertiary:!0}})},k=()=>{setTimeout(()=>{G.value?.reload()},250),h.value=[]},O=()=>{z.value=!0,k(),z.value=!1},I=()=>{C.value="",k()},be=e=>{P.value=e.enable},B=p(""),D=p(""),me=async e=>{switch(e.order){case"ascend":B.value=e.columnKey,D.value="0";break;case"descend":B.value=e.columnKey,D.value="1";break;case!1:B.value="",D.value="";break}k()},C=p(""),ve=async e=>{const n=d.value==="composite",o={page:e.page,size:e.size,search:C.value||"",enable:P.value.join(","),orderBy:B.value,order:D.value};return n?await ta(o):await na(o)},F=async e=>{switch(e){case"createEnv":R.value?.open(d.value);break;case"showSearchBar":j.value=!0,$e().then(()=>{H.value?.focus()});break}};return(e,n)=>{const o=Ge,c=Oe,x=Ae,g=Fe,S=Le,L=Se,Q=Ue,ge=Ve,X=ze,ye=Ke,fe=qe,_e=Me,he=Pe,ke=Ce;return b(),v(ke,{ref:"pageWrapper","content-full":"","no-header":""},{default:l(()=>[i(he,{id:"env-table-drawer-target",bordered:!t(u),style:{height:"100%"},"header-style":t(u)?"padding: 0 10px":"","content-style":t(u)?"padding: 10px":""},{header:l(()=>[t(u)?(b(),v(c,{key:0,value:t(d),"onUpdate:value":[n[0]||(n[0]=r=>A(d)?d.value=r:null),I],type:"segment",size:"small",animated:""},{default:l(()=>[(b(!0),Z(Be,null,Ie(t(se),r=>(b(),v(o,{key:r.type,name:r.type},{default:l(()=>[y(f(r.name),1)]),_:2},1032,["name"]))),128))]),_:1},8,["value"])):ee("",!0)]),default:l(()=>[i(t(we),{ref_key:"tableRef",ref:G,"checked-row-keys":t(h),"onUpdate:checkedRowKeys":n[7]||(n[7]=r=>A(h)?h.value=r:null),"table-id":"ENV","pagination-behavior-on-filter":"first",columns:re,request:ve,"row-key":r=>`${r.id}`,"action-column":ce,"onUpdate:filters":be,"onUpdate:sorter":me},De({tableTitle:l(()=>[i(t(V),{wrap:!1},{default:l(()=>[t(u)?(b(),v(t(w),{key:1,secondary:"",type:"primary",size:"small",style:{padding:"0 6px"},focusable:!1,onClick:n[2]||(n[2]=r=>F("createEnv"))},{icon:l(()=>[i(x)]),_:1})):(b(),v(t(w),{key:0,type:"primary",size:"small",style:{height:"32px"},focusable:!1,onClick:n[1]||(n[1]=r=>F("createEnv"))},{default:l(()=>[y(f(t(a)("page.env.table.new")),1)]),_:1})),t(u)?ee("",!0):(b(),v(S,{key:2,value:t(d),"onUpdate:value":n[3]||(n[3]=r=>A(d)?d.value=r:null),variant:"default-filled","on-change":I},{default:l(()=>[i(g,{value:"ordinary"},{default:l(()=>[y(f(t(a)("page.env.type.ordinary")),1)]),_:1}),i(g,{value:"composite"},{default:l(()=>[y(f(t(a)("page.env.type.composite")),1)]),_:1})]),_:1},8,["value"])),t(u)?(b(),v(Q,{key:4,value:t(C),"onUpdate:value":n[6]||(n[6]=r=>A(C)?C.value=r:null),loading:t(z)||void 0,size:"small",clearable:"",placeholder:t(a)("page.env.table.search.placeholder"),"on-clear":I,onKeyup:te(O,["enter"])},{prefix:l(()=>[i(L)]),_:1},8,["value","loading","placeholder"])):(b(),Z("div",la,[t(j)?(b(),v(ae,{key:1,name:t(M),mode:"default",appear:""},{default:l(()=>[i(ge,{style:{height:"32px"}},{default:l(()=>[i(Q,{ref_key:"searchBarInputRef",ref:H,value:t(C),"onUpdate:value":n[5]||(n[5]=r=>A(C)?C.value=r:null),disabled:t(z),loading:t(z)||void 0,size:"small",clearable:"",placeholder:t(a)("page.env.table.search.placeholder"),"on-clear":I,onKeyup:te(O,["enter"])},{prefix:l(()=>[i(L)]),_:1},8,["value","disabled","loading","placeholder"]),i(t(w),{strong:"",secondary:"",type:"primary",size:"small",style:{height:"32px"},onClick:O},{default:l(()=>[y(f(t(a)("common.searchText")),1)]),_:1})]),_:1})]),_:1},8,["name"])):(b(),v(t(w),{key:0,strong:"",secondary:"",size:"small",style:{padding:"0 8px",height:"32px"},focusable:!1,onClick:n[4]||(n[4]=r=>F("showSearchBar"))},{icon:l(()=>[i(L)]),_:1}))]))]),_:1})]),toolbar:l(()=>[Ne(i(ae,{name:"fade-slide-left",mode:"out-in",appear:""},{default:l(()=>[i(t(V),{wrap:!1},{default:l(()=>[i(_e,{size:"small",trigger:"click",options:t(ie)},{default:l(()=>[t(u)?(b(),v(fe,{key:1,trigger:"hover"},{trigger:l(()=>[K("div",sa,[i(ye,{size:"20"},{default:l(()=>[i(X)]),_:1})])]),default:l(()=>[K("span",null,f(t(a)("page.env.table.action.batchAction")),1)]),_:1})):(b(),v(t(w),{key:0,strong:"",secondary:"",size:"small",type:"primary",style:{padding:"0 8px","border-radius":"10px"},focusable:!1},{icon:l(()=>[i(X)]),default:l(()=>[y(" "+f(t(a)("page.env.table.action.batchAction")),1)]),_:1}))]),_:1},8,["options"])]),_:1})]),_:1},512),[[Re,t(h).length]])]),_:2},[t(h).length&&!t(u)?{name:"info",fn:l(()=>[i(t(N),null,{default:l(()=>[y(f(t(a)("common.selected")),1)]),_:1}),y("  "),K("span",ia,f(t(h).length),1),y("  "),i(t(N),null,{default:l(()=>[y(f(t(a)("common.item")),1)]),_:1})]),key:"0"}:void 0]),1032,["checked-row-keys","row-key"])]),_:1},8,["bordered","header-style","content-style"]),i(aa,{ref_key:"editEnv",ref:R,onOk:k},null,512),i(oa,{ref_key:"manageValue",ref:T,onOk:k},null,512)]),_:1},512)}}});export{Ta as default};
