import{_ as le,a as ae}from"./app-64262975.js";import{_ as se}from"./app-c16619b4.js";import{az as re,aq as ie,T as p,a5 as u,G as ue,A as R,r as ce,J as pe,S as f,F as t,bv as _e,a9 as J,at as z,V as e,W as o,b7 as fe,aN as C,as as c,aJ as ge,b4 as de,ar as O,bj as me,aY as ve,bi as ye,av as he,bB as we,ak as be,aw as xe,aL as ke,aQ as ze,bt as Ce,bu as Le,aW as G}from"./vendor-ca0e89fa.js";import{_ as Te,a as Fe}from"./app-4ba2ed38.js";import{g as Q,j as Ie,f as Ne}from"./app-2733701f.js";import{u as Be}from"./app-40fcbbd5.js";import{d as Re,b as Se}from"./app-dbd4b5f0.js";import{F as De}from"./app-f44d7ba5.js";const He={style:{display:"inline-block"},viewBox:"0 0 24 24",width:"1em",height:"1em"};function Me(Y,T){return p(),ie("svg",He,T[0]||(T[0]=[u("path",{fill:"currentColor",d:"M13.5 8H12v5l4.28 2.54l.72-1.21l-3.5-2.08zM13 3a9 9 0 0 0-9 9H1l3.96 4.03L9 12H6a7 7 0 0 1 7-7a7 7 0 0 1 7 7a7 7 0 0 1-7 7c-1.93 0-3.68-.79-4.94-2.06l-1.42 1.42A8.9 8.9 0 0 0 13 21a9 9 0 0 0 9-9a9 9 0 0 0-9-9"},null,-1)]))}const $e=re({name:"mdi-history",render:Me}),Je=ue({__name:"viewHistory",setup(Y,{expose:T}){const{message:S}=Re(),{t:i}=Se(),{getIsMobile:D}=Be(),N=R(null),_=R(D.value?14:16),F=R(null),Z=ce({show:!1,log:"",showFullScreen:!1,currentPath:"",selectData:[]}),{show:h,log:g,showFullScreen:x,currentPath:d,selectData:m}=pe(Z);async function K(a){let n="";try{n=typeof a.config=="object"&&a.config.log_directory?a.config.log_directory:a.log_path}catch{}if(!n)return;const w=a.is_running;try{if(await X(n),m.value.length){m.value.sort((s,y)=>{const b=s.name.replace(".log","").replace(/-/g,"");return y.name.replace(".log","").replace(/-/g,"")-b});const v=w&&m.value[1]?m.value[1]:m.value[0];d.value=v.path;const l=await Q({path:v.path});g.value=l,h.value=!0}else S.warning(i("page.cron.viewHistory.noLatestMsg"))}catch{S.warning(i("page.cron.viewHistory.noLatestMsg"))}}async function H(a,n){if(!n.disabled)try{const w=await Q({path:n.value});g.value=w,d.value=a}catch{}}async function X(a){const n=await Ie({path:a}),w=ee(n.children);m.value=w.slice().reverse()}function ee(a){return(v=>{v.length&&v.forEach(l=>{if(l.type===De.FILE){const s=l.name;if(s){const y=s.substring(s.lastIndexOf(".")+1),b=Ne[y]||{};Object.assign(l,{value:l.path,label:s.replace(/\.log$/,""),language:"plaintext",disabled:b.icon&&b.disabled||!1})}}})})(a),a=(v=>v.filter(l=>!l.disabled))(a),a}function L(a){switch(a){case"scrollToTop":G(()=>{F.value?.scrollTo({top:0,behavior:"smooth"})});break;case"scrollToBottom":G(()=>{const n=N.value?.$el?.clientHeight;F.value?.scrollTo({top:n,behavior:"smooth"})});break;case"fullScreen":x.value=!x.value;break}}function k(){h.value=!1,g.value="",x.value=!1,d.value="",m.value=[]}return T({open:K}),(a,n)=>{const w=Te,v=Fe,l=xe,s=be,y=ke,b=he,B=$e,M=me,$=se,I=fe,E=we,U=ye,j=le,A=ae,V=ve,W=ze,q=ge,P=de,oe=_e,ne=Le,te=Ce;return t(D)?(p(),f(te,{key:1,show:t(h),"onUpdate:show":n[10]||(n[10]=r=>z(h)?h.value=r:null),height:"calc(var(--vh) * 100)",width:"100vw",placement:"bottom","auto-focus":!1,"mask-closable":!1,onMaskClick:k,onAfterLeave:k},{default:e(()=>[o(ne,{"header-style":"height: 60px; padding: 16px 12px","body-content-style":"padding: 4px 0 4px 8px; overscroll-behavior: none","footer-style":"padding: 16px 24px 24px 24px"},{header:e(()=>[o(W,{style:{gap:"4px"}},{default:e(()=>[o(l,{size:28,color:"var(--app-primary-color)"},{default:e(()=>[o(B)]),_:1}),o(M,{value:t(d),"onUpdate:value":n[6]||(n[6]=r=>z(d)?d.value=r:null),class:"max-w-190px w-190px ml-1",size:"small","consistent-menu-width":!1,options:t(m),"on-update:value":H},null,8,["value","options"]),t(g)?(p(),f(V,{key:0,style:{"padding-left":"8px"}},{default:e(()=>[o(U,{"show-arrow":!1,trigger:"hover",placement:"bottom"},{trigger:e(()=>[o(s,{strong:"",secondary:"",size:"small",focusable:!1},{icon:e(()=>[o(l,null,{default:e(()=>[o($)]),_:1})]),_:1})]),default:e(()=>[o(b,null,{default:e(()=>[o(I,{strong:""},{default:e(()=>[C(c(t(_)),1)]),_:1}),o(E,{value:t(_),"onUpdate:value":n[7]||(n[7]=r=>z(_)?_.value=r:null),style:{width:"120px"},tooltip:!1,min:12,max:24,step:1},null,8,["value"])]),_:1})]),_:1}),o(y,{"show-arrow":!1,trigger:"click",delay:500},{trigger:e(()=>[o(s,{strong:"",secondary:"",size:"small",focusable:!1,onClick:n[8]||(n[8]=r=>L("scrollToTop"))},{icon:e(()=>[o(l,{size:18},{default:e(()=>[o(j)]),_:1})]),_:1})]),default:e(()=>[u("span",null,c(t(i)("file.top.button")),1)]),_:1}),o(y,{"show-arrow":!1,trigger:"click",delay:500},{trigger:e(()=>[o(s,{strong:"",secondary:"",size:"small",focusable:!1,onClick:n[9]||(n[9]=r=>L("scrollToBottom"))},{icon:e(()=>[o(l,{size:18},{default:e(()=>[o(A)]),_:1})]),_:1})]),default:e(()=>[u("span",null,c(t(i)("file.bottom.button")),1)]),_:1})]),_:1})):O("",!0)]),_:1})]),default:e(()=>[o(P,{ref_key:"logInstWrapRef",ref:F,"native-scrollbar":!0,style:{width:"100%",height:"100%","background-color":"transparent"}},{default:e(()=>[u("div",null,[t(g)?(p(),f(q,{key:1,ref_key:"logInstRef",ref:N,log:t(g),"line-height":1.5,"font-size":t(_),language:"naive-log",style:{width:"100%",height:"100%"}},null,8,["log","font-size"])):(p(),f(I,{key:0},{default:e(()=>[C(c(t(i)("common.noData")),1)]),_:1}))])]),_:1},512)]),footer:e(()=>[o(s,{block:"",strong:"",secondary:"",type:"primary",focusable:!1,onClick:k},{default:e(()=>[C(c(t(i)("component.modal.close")),1)]),_:1})]),_:1})]),_:1},8,["show"])):(p(),f(oe,{key:0,show:t(h),"onUpdate:show":n[5]||(n[5]=r=>z(h)?h.value=r:null),preset:"dialog","auto-focus":!1,style:J({width:t(x)?"calc(-20px + 100vw)":"600px"}),"on-close":k,"on-mask-click":k},{close:e(()=>[o(b,null,{default:e(()=>[o(y,{"show-arrow":!1,trigger:"hover",delay:500},{trigger:e(()=>[o(s,{size:"tiny",quaternary:"",focusable:!1,style:{padding:"4px"},onClick:n[0]||(n[0]=r=>L("fullScreen"))},{icon:e(()=>[o(l,{size:20,depth:2},{default:e(()=>[t(x)?(p(),f(v,{key:1})):(p(),f(w,{key:0}))]),_:1})]),_:1})]),default:e(()=>[u("span",null,c(t(x)?t(i)("layout.header.tooltipExitFull"):t(i)("layout.header.tooltipEntryFull")),1)]),_:1}),o(s,{size:"tiny",quaternary:"",focusable:!1,style:{padding:"4px"},onClick:k},{icon:e(()=>[o(l,{size:18,depth:2},{default:e(()=>n[11]||(n[11]=[u("svg",{viewBox:"0 0 12 12",version:"1.1",xmlns:"http://www.w3.org/2000/svg","aria-hidden":"true"},[u("g",{stroke:"none","stroke-width":"1",fill:"none","fill-rule":"evenodd"},[u("g",{fill:"currentColor","fill-rule":"nonzero"},[u("path",{d:"M2.08859116,2.2156945 L2.14644661,2.14644661 C2.32001296,1.97288026 2.58943736,1.95359511 2.7843055,2.08859116 L2.85355339,2.14644661 L6,5.293 L9.14644661,2.14644661 C9.34170876,1.95118446 9.65829124,1.95118446 9.85355339,2.14644661 C10.0488155,2.34170876 10.0488155,2.65829124 9.85355339,2.85355339 L6.707,6 L9.85355339,9.14644661 C10.0271197,9.32001296 10.0464049,9.58943736 9.91140884,9.7843055 L9.85355339,9.85355339 C9.67998704,10.0271197 9.41056264,10.0464049 9.2156945,9.91140884 L9.14644661,9.85355339 L6,6.707 L2.85355339,9.85355339 C2.65829124,10.0488155 2.34170876,10.0488155 2.14644661,9.85355339 C1.95118446,9.65829124 1.95118446,9.34170876 2.14644661,9.14644661 L5.293,6 L2.14644661,2.85355339 C1.97288026,2.67998704 1.95359511,2.41056264 2.08859116,2.2156945 L2.14644661,2.14644661 L2.08859116,2.2156945 Z"})])])],-1)])),_:1})]),_:1})]),_:1})]),icon:e(()=>[o(l,{size:24},{default:e(()=>[o(B)]),_:1})]),header:e(()=>[o(W,null,{default:e(()=>[C(c(t(i)("page.cron.table.history"))+" ",1),o(M,{value:t(d),"onUpdate:value":n[1]||(n[1]=r=>z(d)?d.value=r:null),class:"max-w-190px w-190px",size:"small","consistent-menu-width":!1,options:t(m),"on-update:value":H},null,8,["value","options"]),t(g)?(p(),f(V,{key:0},{default:e(()=>[o(U,{"show-arrow":!1,trigger:"hover",placement:"bottom"},{trigger:e(()=>[o(s,{strong:"",secondary:"",size:"small",focusable:!1},{icon:e(()=>[o(l,null,{default:e(()=>[o($)]),_:1})]),_:1})]),default:e(()=>[o(b,null,{default:e(()=>[o(I,{strong:""},{default:e(()=>[C(c(t(_)),1)]),_:1}),o(E,{value:t(_),"onUpdate:value":n[2]||(n[2]=r=>z(_)?_.value=r:null),style:{width:"120px"},tooltip:!1,min:12,max:24,step:1},null,8,["value"])]),_:1})]),_:1}),o(y,{"show-arrow":!1,trigger:"hover",delay:500},{trigger:e(()=>[o(s,{strong:"",secondary:"",size:"small",focusable:!1,onClick:n[3]||(n[3]=r=>L("scrollToTop"))},{icon:e(()=>[o(l,{size:18},{default:e(()=>[o(j)]),_:1})]),_:1})]),default:e(()=>[u("span",null,c(t(i)("file.top.button")),1)]),_:1}),o(y,{"show-arrow":!1,trigger:"hover",delay:500},{trigger:e(()=>[o(s,{strong:"",secondary:"",size:"small",focusable:!1,onClick:n[4]||(n[4]=r=>L("scrollToBottom"))},{icon:e(()=>[o(l,{size:18},{default:e(()=>[o(A)]),_:1})]),_:1})]),default:e(()=>[u("span",null,c(t(i)("file.bottom.button")),1)]),_:1})]),_:1})):O("",!0)]),_:1})]),default:e(()=>[o(P,{ref_key:"logInstWrapRef",ref:F,"native-scrollbar":!1,style:J({paddingTop:"1em",width:"100%",backgroundColor:"transparent",height:t(x)?"calc(-120px + 100vh)":"600px"})},{default:e(()=>[u("div",null,[t(g)?(p(),f(q,{key:1,ref_key:"logInstRef",ref:N,log:t(g),"line-height":1.5,"font-size":t(_),language:"naive-log",style:{width:"100%",height:"100%"}},null,8,["log","font-size"])):(p(),f(I,{key:0},{default:e(()=>[C(c(t(i)("common.noData")),1)]),_:1}))])]),_:1},8,["style"])]),_:1},8,["show","style"]))}}});export{$e as I,Je as _};
