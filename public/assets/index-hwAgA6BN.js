import{_ as Fe}from"./PageWrapper.vue_vue_type_style_index_0_lang-B-QjJlfz.js";import{_ as Pe,B as Me,a as Oe}from"./TableAction.vue_vue_type_script_setup_true_lang-BWypmYWy.js";import{_ as Ie}from"./search2-line-Cm_Nf99E.js";import{_ as $e}from"./plus-DJS6TPSC.js";import{I as Le,bp as Ue,bq as qe,A as u,am as o,b7 as T,br as Ke,bs as Ee,bt as Ve,bu as le,a7 as g,a8 as f,a9 as l,aa as s,u as n,aG as S,aK as ie,ax as Ge,aR as je,aF as se,ay as We,aw as He,aS as v,aL as h,av as I,aA as re,bv as ce,at as Je,au as Qe,B as Xe,a_ as Ye,ap as Ze,bw as et,bx as tt,bd as at,by as nt,aE as ot,aT as lt,b3 as it,ba as st,aM as rt,bz as ct}from"./vendor-CVUNLYN4.js";import{I as r}from"./Icon-ljQHnwJa.js";import{a as ut,c as pt,d as dt}from"./index-BW0Kz9QR.js";import{u as bt}from"./useAppInject-Dal6O7k8.js";import{u as mt}from"./useLocale-Dvvyb-u-.js";import{u as gt}from"./useRunLog-D2y-a3is.js";import{u as yt}from"./useTransition-CObelXI-.js";import{r as ft,s as _t,a as vt,e as $,d as ue,E as ht,g as kt,b as Ct}from"./editTask-Ca70bN2c.js";import{_ as zt}from"./viewHistory.vue_vue_type_script_setup_true_lang-BB0Jx0Uw.js";import{_ as xt}from"./viewSourceFile.vue_vue_type_script_setup_true_lang-CLIScSzV.js";import"./sharp-arrow-back-ios-DFVIULGe.js";import"./useDesign-DCKbhR-1.js";import"./clickOutside-JY6MVw26.js";import"./download-simple-bold-CPvWvumI.js";import"./question-circle-outlined-tr4rZkhQ.js";import"./propTypes-CYyueTg3.js";import"./more-horiz-C-LS9eeq.js";import"./cronVisualization.vue_vue_type_script_setup_true_lang-BuPFNNnp.js";import"./clock-plus-outline-COJJy2Z4.js";import"./zoom-out-line-D8IMBg4W.js";import"./fullscreen-CYCx4MyE.js";import"./file-BQviJjRi.js";import"./index-wCKpV3TT.js";import"./swap-outlined-B8GjjHN0.js";import"./fileUnknown-sxaemHPP.js";import"./file-question-outline-BVJPEVw9.js";const Tt={key:3},St={class:"table-toolbar-right-icon"},Rt={style:{color:"var(--app-primary-color)"}},At=Le({__name:"index",setup(Bt){const{getIsMobile:i}=bt(),{t}=ut(),{getLocale:L}=mt(),U=L.value==="zh_CN"?Ue:qe,{message:b,confirm:R}=pt(),{runLog:pe}=gt(),q=u("fade-slide");yt(q);const d=u("system"),de=u([{type:"system",name:t("page.cron.type.system")},{type:"user",name:t("page.cron.type.user")}]),K=u(),E=u([]),V=u([]),_=u([]),G=u(!1),z=u(!1),j=u(),N=u(),W=u(),H=u(),be=u([{label:()=>o(T,{style:{color:"var(--app-info-color)"}},{default:()=>t("page.cron.table.action.enable.button")}),key:"enable",icon:()=>o(r,{icon:"mdi:timer-check-outline",color:"var(--app-info-color)",style:"vertical-align: baseline"},{}),props:{onClick:()=>{Ce()}}},{label:t("page.cron.table.action.disable.button"),key:"disable",icon:()=>o(r,{icon:"mdi:alarm-off",style:"vertical-align: baseline"},{}),props:{onClick:()=>{ke()}}},{label:()=>o(T,{style:{color:"var(--app-error-color)"}},{default:()=>t("page.cron.table.action.delete.button")}),key:"delete",icon:()=>o(r,{icon:"fe:trash",color:"var(--app-error-color)",style:"vertical-align: baseline"},{}),props:{onClick:()=>{he()}}}]),J=u([]),me=[{type:"selection",key:"selection",width:"3%"},{title:t("page.cron.table.title.name"),key:"name",width:i.value?180:"10%",renderFilterIcon:()=>o(r,{icon:"ic:round-filter-list",style:"vertical-align: baseline"},{}),defaultFilterOptionValues:[],filterOptions:J,filter(){}},{title:t("page.cron.table.title.cron"),key:"cron",width:i.value?140:"8%",resizable:!0},{title:t("page.cron.table.title.shell"),key:"shell",width:i.value?360:"20%",resizable:!0,render(e){return d.value==="user"?o(Ke,{code:String(e.shell||""),language:"shell",inline:!0,trim:!0},{}):o("span",{style:{fontFamily:"var(--app-font-family-mono)"}},String(e.shell||""))}},{title:t("page.cron.table.title.remark"),key:"remark",width:i.value?void 0:"8%",resizable:!0},{title:t("page.cron.table.title.create_time"),key:"create_time",align:"center",width:i.value?void 0:"10%",sorter:!0,defaultSortOrder:!1},{title:t("page.cron.table.title.last_runtime"),key:"last_runtime",align:"center",width:i.value?void 0:"10%",render(e){return e.last_runtime?Date.now()-new Date(e.last_runtime).getTime()<1e3*60*60?Ee(new Date(e.last_runtime),{addSuffix:!0,locale:U}):e.last_runtime:t("page.cron.table.last_runtime.never")},sorter:!0,defaultSortOrder:!1},{title:t("page.cron.table.title.last_run_use"),key:"last_run_use",align:"right",titleAlign:"right",width:i.value?void 0:"7%",render(e){if(e.last_run_use===0)return t("page.cron.table.zeroSeconds");if(!e.last_run_use===null)return t("page.cron.table.none");const a=Math.ceil(Number(e.last_run_use)),p=Math.floor(a/86400),C=Math.floor((a-p*86400)/3600),m=Math.floor((a-p*86400-C*3600)/60),M=a-p*86400-C*3600-m*60;return Ve({days:p,hours:C,minutes:m,seconds:M},{locale:U})},sorter:!0,defaultSortOrder:!1},{title:t("page.cron.table.title.isRunning"),key:"isRunning",align:"center",width:i.value?void 0:"7%",render(e){return o(le,{type:e.isRunning?"success":"default",round:!!e.isRunning},{default:()=>e.isRunning?t("page.cron.table.status.running"):t("page.cron.table.status.idle"),icon:()=>o(r,{icon:e.isRunning?"svg-spinners:12-dots-scale-rotate":"mdi:sleep",style:"vertical-align: baseline"},{})})}},{title:t("page.cron.table.title.active"),key:"active",align:"center",width:i.value?void 0:"6%",renderFilterIcon:()=>o(r,{icon:"ic:round-filter-list",style:"vertical-align: baseline"},{}),render(e){return o(le,{type:e.active===1?"success":"error",bordered:!1,style:L.value==="zh_CN"?"":"width: 66px; line-height: 28px; display: block; text-align: center"},{default:()=>e.active===1?t("common.active"):t("common.inactive")})},defaultFilterOptionValues:[],filterOptions:[{label:t("common.active"),value:1},{label:t("common.inactive"),value:0}],filter(){}}],x=(e,a)=>{switch(e){case"edit":return{icon:"mdi:square-edit-outline",tooltip:t("page.cron.table.action.edit"),quaternary:!0,focusable:!1,onClick:Q.bind(null,a)};case"debug":return{icon:"mdi:bug-play-outline",tooltip:t("page.cron.table.action.debug"),quaternary:!0,focusable:!1,onClick:X.bind(null,a)};case"run":return{icon:"tabler:clock-play",iconProps:{size:18},tooltip:t("page.cron.table.action.run.button"),quaternary:!0,focusable:!1,loading:a?.is_operation===!0,onClick:Y.bind(null,a)};case"terminate":return{icon:"tabler:clock-stop",iconProps:{size:18},tooltip:t("page.cron.table.action.terminate.button"),quaternary:!0,focusable:!1,loading:a?.is_operation===!0,onClick:Z.bind(null,a)};case"history":return{icon:"mdi:history",iconProps:{size:21},tooltip:t("page.cron.table.action.history"),quaternary:!0,focusable:!1,disabled:!a.logPath,onClick:ee.bind(null,a)}}},ge={title:t("page.cron.table.title.action"),key:"action",titleAlign:i.value?"center":"left",width:i.value?68:void 0,fixed:i.value?"right":void 0,render(e){const a={edit:{label:t("page.cron.table.action.edit"),key:"edit",icon:()=>o(r,{icon:"mdi:square-edit-outline",size:18,style:"vertical-align: baseline"},{}),props:{onClick:Q.bind(null,e)}},history:{label:t("page.cron.table.action.history"),key:"history",disabled:!e.logPath,icon:()=>o(r,{icon:"mdi:history",size:20,style:"vertical-align: baseline"},{}),props:e.logPath?{onClick:ee.bind(null,e)}:{}},run:{label:t("page.cron.table.action.run.button"),key:"debug",icon:()=>o(r,{icon:"tabler:clock-play",size:18,style:"vertical-align: baseline"},{}),props:{onClick:Y.bind(null,e)}},terminate:{label:t("page.cron.table.action.terminate.button"),key:"debug",icon:()=>o(r,{icon:"tabler:clock-stop",size:18,style:"vertical-align: baseline"},{}),props:{onClick:Z.bind(null,e)}},debug:{label:t("page.cron.table.action.debug"),key:"debug",icon:()=>o(r,{icon:"mdi:bug-play-outline",size:20,style:"vertical-align: baseline"},{}),props:{onClick:X.bind(null,e)}},source:{label:t("page.cron.table.action.source"),key:"source",icon:()=>o(r,{icon:"mdi:file-eye-outline",size:18,style:"vertical-align: baseline"},{}),props:{onClick:ye.bind(null,e)}},changeStatus:{label:e.active===1?t("page.cron.table.action.disable.button"):t("page.cron.table.action.enable.button"),key:"changeStatus",icon:()=>o(r,{icon:e.active===1?"mdi:alarm-off":"mdi:timer-check-outline",size:18,style:"vertical-align: baseline"},{}),props:{onClick:_e.bind(null,e)}},delete:{label:()=>o(T,{style:{color:"var(--app-error-color)"}},{default:()=>t("page.cron.table.action.delete.button")}),key:"delete",icon:()=>o(r,{icon:"fe:trash",size:18,color:"var(--app-error-color)",style:"vertical-align: baseline"},{}),props:{onClick:ve.bind(null,e)}},sort:{label:t("page.cron.table.action.sort.title"),key:"sort",icon:()=>o(r,{icon:"mdi:sort",style:"vertical-align: baseline"},{}),children:[{label:t("page.cron.table.action.sort.moveUp"),key:"sortMoveUp",icon:()=>o(r,{icon:"material-symbols:arrow-upward-rounded",style:"vertical-align: baseline"},{}),props:{onClick:w.bind(null,e,"up")}},{label:t("page.cron.table.action.sort.moveDown"),key:"sortMoveDown",icon:()=>o(r,{icon:"material-symbols:arrow-downward-rounded",style:"vertical-align: baseline"},{}),props:{onClick:w.bind(null,e,"down")}},{label:t("page.cron.table.action.sort.moveTop"),key:"sortMoveTop",icon:()=>o(r,{icon:"material-symbols:text-select-move-up-rounded",style:"vertical-align: baseline"},{}),props:{onClick:w.bind(null,e,"top")}}]}};let p={};return d.value==="system"&&e.bind?i.value?p={style:"button",actions:[],dropDownActions:[a.edit,a[e?.isRunning?"terminate":"run"],a.history,a.debug,a.source,a.changeStatus,a.sort,a.delete]}:p={style:"button",actions:[x("edit",e),x(e?.isRunning?"terminate":"run",e),x("history",e)],dropDownActions:[a.debug,a.source,a.changeStatus,a.sort,a.delete]}:i.value?p={style:"button",actions:[],dropDownActions:[a.edit,a[e?.isRunning?"terminate":"run"],a.debug,a.changeStatus,a.sort,a.delete]}:p={style:"button",actions:[x("edit",e),x(e?.isRunning?"terminate":"run",e)],dropDownActions:[a.debug,a.changeStatus,a.sort,a.delete]},o(Pe,p)}},Q=async e=>{N.value?.open(e)},X=async e=>{pe.value?.open({title:`${e.name}`,cmd:e.shell})},Y=async e=>{e.is_operation=!0;try{await ft({id:e.id})}catch{b.error(t("page.cron.table.action.run.errorMsg"))}finally{e.is_operation=!1,y()}},Z=async e=>{e.is_operation=!0;const a=b.loading(t("page.cron.table.action.terminate.loadingMsg"),{duration:0});try{await _t({id:e.id}),a.type="success",a.content=t("page.cron.table.action.terminate.successMsg")}catch{a.type="error",a.content=t("page.cron.table.action.terminate.errorMsg")}finally{e.is_operation=!1,y(),setTimeout(()=>{a.destroy()},1e3)}},ee=async e=>{W.value?.open(e)},ye=async e=>{H.value?.open(e)},w=async(e,a)=>{const{id:p,sort:C}=e;try{let m;switch(a){case"up":m={id:p,order:C+1};break;case"down":m={id:p,order:C-1};break;case"top":m={id:p,moveToEnd:!0};break;default:return}await vt(m),b.success(t("page.cron.table.message.sort.ok")),y()}catch{}},fe=async()=>{const e=await Ct();J.value=e.filter(a=>a.bind).map(a=>({value:a.bind,label:a.bind}))},_e=async e=>{try{await $([{id:e.id,active:e.active===0?1:0}]),b.success(e.active===1?t("page.cron.table.message.disable.ok"):t("page.cron.table.message.enable.ok"),{duration:1500}),e.active===0?e.active=1:e.active=0}catch{b.error(e.active===1?t("page.cron.table.message.disable.fail"):t("page.cron.table.message.enable.fail"))}},ve=e=>{R.error({title:t("page.cron.table.action.delete.title"),content:t("page.cron.table.action.delete.confirm"),icon:()=>o(r,{icon:"fe:trash",style:"vertical-align: baseline"},{}),closable:!1,maskClosable:!1,autoFocus:!1,positiveText:t("page.cron.table.action.delete.button"),onPositiveClick:async()=>{try{await ue({id:e.id}),b.success(t("page.cron.table.message.delete.ok"))}catch{b.error(t("page.cron.table.message.delete.fail"))}finally{y()}},negativeButtonProps:{ghost:!1,tertiary:!0}})},he=()=>{R.error({title:t("page.cron.table.action.delete.batchTitle"),content:t("page.cron.table.action.delete.batchConfirm"),icon:()=>o(r,{icon:"fe:trash",size:24,style:"vertical-align: baseline"},{}),closable:!1,maskClosable:!1,autoFocus:!1,onPositiveClick:async()=>{try{await ue({id:_.value.map(e=>Number(e))}),b.success(t("page.cron.table.message.delete.ok"))}catch{b.error(t("page.cron.table.message.delete.fail"))}finally{y()}},negativeButtonProps:{ghost:!1,tertiary:!0}})},ke=()=>{R.info({title:t("page.cron.table.action.disable.batchTitle"),content:t("page.cron.table.action.disable.batchConfirm"),icon:()=>o(r,{icon:"mdi:alarm-off",size:24,style:"vertical-align: baseline"},{}),closable:!1,maskClosable:!1,autoFocus:!1,onPositiveClick:async()=>{try{await $(_.value.map(e=>({id:Number(e),active:0}))),b.success(t("page.cron.table.message.disable.ok"))}catch{b.error(t("page.cron.table.message.disable.fail"))}finally{y()}},negativeButtonProps:{ghost:!1,tertiary:!0}})},Ce=()=>{R.info({title:t("page.cron.table.action.enable.batchTitle"),content:t("page.cron.table.action.enable.batchConfirm"),icon:()=>o(r,{icon:"mdi:timer-check-outline",size:24,style:"vertical-align: baseline"},{}),closable:!1,maskClosable:!1,autoFocus:!1,onPositiveClick:async()=>{try{await $(_.value.map(e=>({id:Number(e),active:1}))),b.success(t("page.cron.table.message.enable.ok"))}catch{b.error(t("page.cron.table.message.enable.fail"))}finally{y()}},negativeButtonProps:{ghost:!1,tertiary:!0}})},y=()=>{setTimeout(()=>{K.value?.reload()},250),_.value=[]},F=()=>{z.value=!0,y(),z.value=!1},A=()=>{k.value="",y()},ze=e=>{E.value=e.active,V.value=e.name},B=u(""),D=u(""),xe=async e=>{switch(e.order){case"ascend":B.value=e.columnKey,D.value="0";break;case"descend":B.value=e.columnKey,D.value="1";break;case!1:B.value="",D.value="";break}y()},k=u(""),Te=async e=>{const a=d.value==="system";return a&&await fe(),await kt({page:e.page,size:e.size,type:d.value,search:k.value||"",active:E.value.join(","),tags:a?V.value.join(","):"",orderBy:B.value,order:D.value})},P=async e=>{switch(e){case"createTask":d.value!=="user"&&(d.value="user",y()),N.value?.open({type:d.value});break;case"showSearchBar":G.value=!0,Xe().then(()=>{j.value?.focus()});break}};return(e,a)=>{const p=ct,C=Ye,m=Ze,M=$e,te=et,Se=tt,O=Ie,ae=at,Re=nt,ne=ot,oe=Oe,Ae=lt,Be=it,De=st,Ne=rt,we=Fe;return g(),f(we,{ref:"pageWrapper","content-full":"","no-header":""},{default:l(()=>[s(Ne,{bordered:!n(i),style:{height:"100%"},"header-style":n(i)?"padding: 0 10px":"","content-style":n(i)?"padding: 10px":""},{header:l(()=>[n(i)?(g(),f(C,{key:0,value:n(d),"onUpdate:value":[a[0]||(a[0]=c=>S(d)?d.value=c:null),A],type:"segment",size:"small",animated:""},{default:l(()=>[(g(!0),ie(je,null,Ge(n(de),c=>(g(),f(p,{key:c.type,name:c.type},{default:l(()=>[v(h(c.name),1)]),_:2},1032,["name"]))),128))]),_:1},8,["value"])):se("",!0)]),default:l(()=>[s(n(Me),{ref_key:"tableRef",ref:K,"checked-row-keys":n(_),"onUpdate:checkedRowKeys":a[7]||(a[7]=c=>S(_)?_.value=c:null),"table-id":"CRON",class:We({"not-system-table":n(d)!=="system"}),"pagination-behavior-on-filter":"first",columns:me,"default-hide-keys":["create_time"],request:Te,"row-key":c=>`${c.id}`,"action-column":ge,"onUpdate:filters":ze,"onUpdate:sorter":xe},He({tableTitle:l(()=>[s(ne,{wrap:!1},{default:l(()=>[n(i)?(g(),f(m,{key:1,secondary:"",type:"primary",size:"small",style:{padding:"0 6px"},focusable:!1,onClick:a[2]||(a[2]=c=>P("createTask"))},{icon:l(()=>[s(M)]),_:1})):(g(),f(m,{key:0,type:"primary",size:"small",style:{height:"32px"},focusable:!1,onClick:a[1]||(a[1]=c=>P("createTask"))},{default:l(()=>[v(h(n(t)("page.cron.table.new")),1)]),_:1})),n(i)?se("",!0):(g(),f(Se,{key:2,value:n(d),"onUpdate:value":a[3]||(a[3]=c=>S(d)?d.value=c:null),variant:"default-filled",class:"t-radio-group","on-change":A},{default:l(()=>[s(te,{value:"system"},{default:l(()=>[v(h(n(t)("page.cron.type.system")),1)]),_:1}),s(te,{value:"user"},{default:l(()=>[v(h(n(t)("page.cron.type.user")),1)]),_:1})]),_:1},8,["value"])),n(i)?(g(),f(ae,{key:4,value:n(k),"onUpdate:value":a[6]||(a[6]=c=>S(k)?k.value=c:null),loading:n(z)||void 0,size:"small",clearable:"",placeholder:n(t)("page.cron.table.search.placeholder"),"on-clear":A,onKeyup:ce(F,["enter"])},{prefix:l(()=>[s(O)]),_:1},8,["value","loading","placeholder"])):(g(),ie("div",Tt,[n(G)?(g(),f(re,{key:1,name:n(q),mode:"default",appear:""},{default:l(()=>[s(Re,{style:{height:"32px"}},{default:l(()=>[s(ae,{ref_key:"searchBarInputRef",ref:j,value:n(k),"onUpdate:value":a[5]||(a[5]=c=>S(k)?k.value=c:null),disabled:n(z),loading:n(z)||void 0,size:"small",clearable:"",placeholder:n(t)("page.cron.table.search.placeholder"),"on-clear":A,onKeyup:ce(F,["enter"])},{prefix:l(()=>[s(O)]),_:1},8,["value","disabled","loading","placeholder"]),s(m,{strong:"",secondary:"",type:"primary",size:"small",style:{height:"32px"},onClick:F},{default:l(()=>[v(h(n(t)("common.searchText")),1)]),_:1})]),_:1})]),_:1},8,["name"])):(g(),f(m,{key:0,strong:"",secondary:"",size:"small",style:{padding:"0 8px",height:"32px"},focusable:!1,onClick:a[4]||(a[4]=c=>P("showSearchBar"))},{icon:l(()=>[s(O)]),_:1}))]))]),_:1})]),toolbar:l(()=>[Je(s(re,{name:"fade-slide-left",mode:"out-in",appear:""},{default:l(()=>[s(ne,{wrap:!1},{default:l(()=>[s(De,{size:"small",trigger:"click",options:n(be)},{default:l(()=>[n(i)?(g(),f(Be,{key:1,trigger:"hover"},{trigger:l(()=>[I("div",St,[s(Ae,{size:"20"},{default:l(()=>[s(oe)]),_:1})])]),default:l(()=>[I("span",null,h(n(t)("page.cron.table.action.batchAction")),1)]),_:1})):(g(),f(m,{key:0,strong:"",secondary:"",size:"small",type:"primary",style:{padding:"0 8px","border-radius":"10px"},focusable:!1},{icon:l(()=>[s(oe)]),default:l(()=>[v(" "+h(n(t)("page.cron.table.action.batchAction")),1)]),_:1}))]),_:1},8,["options"])]),_:1})]),_:1},512),[[Qe,n(_).length]])]),_:2},[n(_).length&&!n(i)?{name:"info",fn:l(()=>[s(n(T),null,{default:l(()=>[v(h(n(t)("common.selected")),1)]),_:1}),v("  "),I("span",Rt,h(n(_).length),1),v("  "),s(n(T),null,{default:l(()=>[v(h(n(t)("common.item")),1)]),_:1})]),key:"0"}:void 0]),1032,["checked-row-keys","class","row-key"])]),_:1},8,["bordered","header-style","content-style"]),s(ht,{ref_key:"editTask",ref:N,onOk:y},null,512),s(zt,{ref_key:"viewHistory",ref:W},null,512),s(xt,{ref_key:"viewSourceFile",ref:H},null,512)]),_:1},512)}}}),ia=dt(At,[["__scopeId","data-v-39837b05"]]);export{ia as default};
