import{_ as ee}from"./PageWrapper.vue_vue_type_style_index_0_lang-BziLynEE.js";import{a as ne,c as ae,_ as te}from"./index-C5WsbIcI.js";import{_ as oe,a as le}from"./sliders-horizontal-bold-TgXRItU8.js";import{_ as se,f as ie}from"./content-save-check-BNomzcHk.js";import{I as re,A as s,G as ce,aP as ue,aQ as pe,a7 as S,a8 as B,a9 as o,aa as a,u as n,aG as W,at as de,au as fe,aT as _,aS as x,aL as b,aF as me,aA as j,am as r,bk as _e,ap as ge,a$ as ve,aU as he,aE as ye,bb as we,aV as xe,aM as be}from"./vendor-DM0AKlTY.js";import{I as k}from"./Icon-xQFpegxF.js";import{_ as ke}from"./index.vue_vue_type_style_index_0_lang-BJ-5gekp.js";import{u as ze}from"./useAppInject-BpVc4Z3r.js";import{F as Ce}from"./fileTreeEnum-CTCrZDjg.js";import{s as Ie,a as Ee,g as Ne}from"./file-Clmaqfmx.js";import{a as A,b as Se,c as Be}from"./index-0xrZtL-6.js";import{f as Fe}from"./filePrefix-BscgWA3F.js";import"./sharp-arrow-back-ios-BQgkNRVH.js";import"./useDesign-CEKApMBV.js";import"./propTypes-BWpnk_hf.js";import"./useTextMate-3xo-dwm-.js";const Je=re({__name:"index",setup(Te){const{getIsMobile:F}=ze(),{t:i}=ne(),{message:T}=ae(),z=s([]),h=s({}),y=s(),C=s({content:"",language:""}),p=s(""),I=s(!0),E=s("on"),$=s(!1),O=s(!1),D=s(!1),N=s(F.value?13:15),L=s(!1),d=s(!1),w=async t=>{switch(t){case"findBox":L.value=!L.value,d.value=!1;break;case"wordWrap":E.value=E.value==="on"?"off":"on",d.value=!1;break;case"minimap":I.value=!I.value,d.value=!1;break;case"showEditorShortcutsInfo":y.value.showShortCuts();break;case"save":$.value=!0;const e=n(y).getValue();try{await Ie({content:e,path:h.value.path}),T.success(i("editor.main.savedSuccess"))}finally{$.value=!1,await P()}break}},P=async()=>{D.value=!0;const t=await Ee({type:Ce.CONFIG}),e=M(t);z.value=e,D.value=!1},M=t=>{const e=g=>{g.length&&g.forEach(l=>{if(l.type===0)Object.assign(l,{key:l.path,label:l.title,prefix:()=>r(_,null,{default:()=>r(A)})}),e(l.children),l.children.length||(Object.assign(l,{children:null}),l.prefix=()=>r(_,null,{default:()=>r(ie)}));else{const v=l.name;if(v){const f=v.substring(v.lastIndexOf(".")+1),m=Be[f]||{};Object.assign(l,{key:l.path,label:v,language:m.language||"plaintext",disabled:m.icon&&m.disabled||!1,prefix:()=>r(_,null,{default:()=>r(m.icon||Fe)})})}}})};e(t);const c=g=>g.filter(l=>l.children?(l.children=c(l.children),!0):!l.disabled);return t=c(t),t},U=(t,e,c)=>{if(c.node)switch(c.action){case"expand":c.node.prefix=()=>r(_,null,{default:()=>r(Se)});break;case"collapse":c.node.prefix=()=>r(_,null,{default:()=>r(A)});break}},G=({option:t})=>({async onClick(){!t.children&&!t.disabled&&(h.value=t,await V(t))}}),R=({option:t})=>t.children?"toggleExpand":"default";async function V(t){O.value=!0;const e=await Ne({path:encodeURI(t.key)});e?C.value={content:e,language:t.language}:(C.value={content:"",language:""},T.info(i("page.config.fileContentIsEmptyMsg"))),O.value=!1}async function q(){await P();let t={};if(z.value.length)for(const e of z.value)e.type===1&&e.name==="config.sh"&&(t=e);t.path?(h.value=t,V(h.value),p.value=h.value.path):T.error(i("page.config.mainConfigNotExistsMsg"),{keepAliveOnHover:!0})}return ce(p,t=>{t||(C.value={content:"",language:""})}),ue(()=>{q()}),pe(()=>{y.value&&y.value.dispose()}),(t,e)=>{const c=_e,g=oe,l=ge,v=ve,f=he,m=ye,H=we,Q=se,J=le,K=xe,X=te,Y=be,Z=ee;return S(),B(Z,{ref:"pageWrapper","content-full":""},{title:o(()=>[a(c,{value:n(p),"onUpdate:value":e[0]||(e[0]=u=>W(p)?p.value=u:null),size:"small",class:"min-w-190px",loading:n(D),"consistent-menu-width":!1,clearable:"",placeholder:n(i)("page.config.selectConfigFilePlaceholder"),options:n(z),"override-default-node-click-behavior":R,"node-props":G,"on-update:expanded-keys":U},null,8,["value","loading","placeholder","options"])]),extra:o(()=>[de(a(j,{name:"fade",mode:"out-in",appear:""},{default:o(()=>[a(m,{style:{width:"fix-content"}},{default:o(()=>[a(H,{trigger:"manual",style:{padding:"8px"},show:n(d),"show-arrow":!1,placement:"bottom"},{trigger:o(()=>[a(l,{strong:"",quaternary:"",size:"small",type:n(d)?"primary":"tertiary",style:{padding:"6px"},focusable:!1,onClick:e[1]||(e[1]=u=>d.value=!n(d))},{default:o(()=>[a(n(_),{size:"18"},{default:o(()=>[a(g,{style:{"vertical-align":"baseline"}})]),_:1})]),_:1},8,["type"])]),default:o(()=>[a(m,{vertical:""},{default:o(()=>[a(f,{size:"small"},{default:o(()=>[a(k,{size:20,icon:"ri:font-size",style:{"vertical-align":"-0.45em"}}),a(v,{value:n(N),"onUpdate:value":e[2]||(e[2]=u=>W(N)?N.value=u:null),min:12,max:40,"button-placement":"both",size:"small",style:{"text-align":"center",width:"116px"}},null,8,["value"])]),_:1}),a(f,{size:"small"},{default:o(()=>[a(k,{size:20,icon:"mdi:find-replace",style:{"vertical-align":"-0.45em"}}),a(l,{size:"small",strong:"",tertiary:"",style:{width:"116px"},onClick:e[3]||(e[3]=u=>w("findBox"))},{default:o(()=>[x(b(n(i)("editor.switch.findBtn")),1)]),_:1})]),_:1}),a(f,{size:"small"},{default:o(()=>[a(k,{size:20,color:n(E)==="on"?"var(--app-primary-color)":void 0,icon:"ant-design:swap-outlined",style:{"vertical-align":"-0.45em"}},null,8,["color"]),a(l,{size:"small",strong:"",tertiary:"",style:{width:"116px"},onClick:e[4]||(e[4]=u=>w("wordWrap"))},{default:o(()=>[x(b(n(i)("editor.switch.wordWrapBtn")),1)]),_:1})]),_:1}),a(f,{size:"small"},{default:o(()=>[a(k,{size:20,color:n(I)?"var(--app-primary-color)":void 0,icon:"mdi:map-outline",style:{"vertical-align":"-0.45em"}},null,8,["color"]),a(l,{size:"small",strong:"",tertiary:"",style:{width:"116px"},onClick:e[5]||(e[5]=u=>w("minimap"))},{default:o(()=>[x(b(n(i)("editor.switch.minimapBtn")),1)]),_:1})]),_:1}),n(F)?me("",!0):(S(),B(f,{key:0,size:"small"},{default:o(()=>[a(k,{size:20,icon:"gg:shortcut",style:{"vertical-align":"-0.45em"}}),a(l,{size:"small",strong:"",tertiary:"",style:{width:"116px"},onClick:e[6]||(e[6]=u=>w("showEditorShortcutsInfo"))},{default:o(()=>[x(b(n(i)("editor.switch.viewShortcuts")),1)]),_:1})]),_:1}))]),_:1})]),_:1},8,["show"]),a(l,{strong:"",type:"primary",size:"small",loading:n($),focusable:!1,onClick:e[7]||(e[7]=u=>w("save"))},{icon:o(()=>[a(Q)]),default:o(()=>[x(" "+b(n(i)("editor.main.saveButton")),1)]),_:1},8,["loading"])]),_:1})]),_:1},512),[[fe,n(p)]])]),default:o(()=>[a(Y,{bordered:!n(F),style:{height:"100%","word-break":"unset"},"content-style":"padding: 0"},{default:o(()=>[a(j,{name:"fade",mode:"out-in",appear:""},{default:o(()=>[n(p)?(S(),B(ke,{key:0,ref_key:"editor",ref:y,value:n(C),"word-wrap":n(E),minimap:n(I),"font-size":n(N),"find-box":n(L)},null,8,["value","word-wrap","minimap","font-size","find-box"])):(S(),B(K,{key:1,class:"min-h-200px flex-jc-ac h-full",size:"huge",description:n(i)("common.selectFileEmptyDesc")},{icon:o(()=>[a(n(_),null,{default:o(()=>[a(J)]),_:1})]),_:1},8,["description"]))]),_:1}),a(X,{show:n(O)},null,8,["show"])]),_:1},8,["bordered"])]),_:1},512)}}});export{Je as default};
