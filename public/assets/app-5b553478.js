import{az as I,aq as w,T as _,a5 as r,h as v,A as m,F as e,cD as P,G as Z,r as ee,aC as ne,a3 as te,a4 as ae,W as s,bw as se,bd as oe,V as l,bx as le,b0 as re,S as ie,ar as ce,aL as ue,as as h,cE as de,a9 as pe,aQ as ge,bo as me,at as _e,aN as S,ak as z,t as fe,ad as x,cF as he,aw as ve}from"./vendor-ca0e89fa.js";import{b as H,z as we,y as ye,a as be,ao as ke,d as xe,e as Ie}from"./app-dbd4b5f0.js";import"./vendor-6c6d1442.js";const Ce={style:{display:"inline-block"},viewBox:"0 0 24 24",width:"1em",height:"1em"};function Re(t,a){return _(),w("svg",Ce,a[0]||(a[0]=[r("g",{fill:"currentColor"},[r("path",{d:"M12 1.932l9 3.375V10c0 4.118-1.62 7.113-3.535 9.074a11.407 11.407 0 0 1-2.915 2.175c-.913.468-1.826.751-2.55.751c-.724 0-1.637-.283-2.55-.75a11.41 11.41 0 0 1-2.915-2.176C4.619 17.113 3 14.118 3 10V5.307l9-3.375zM5 6.693V10c0 3.549 1.38 6.054 2.965 7.676a9.411 9.411 0 0 0 2.397 1.793c.775.397 1.362.531 1.638.531c.276 0 .863-.134 1.638-.53a9.412 9.412 0 0 0 2.397-1.794C17.619 16.054 19 13.55 19 10V6.693l-7-2.625l-7 2.625z"}),r("path",{d:"M15.707 9.293a1 1 0 0 1 0 1.414l-4 4a1 1 0 0 1-1.414 0l-2-2a1 1 0 1 1 1.414-1.414L11 12.586l3.293-3.293a1 1 0 0 1 1.414 0z"})],-1)]))}const Le=I({name:"majesticons-shield-check-line",render:Re}),Se={style:{display:"inline-block"},viewBox:"0 0 24 24",width:"1em",height:"1em"};function ze(t,a){return _(),w("svg",Se,a[0]||(a[0]=[r("path",{fill:"currentColor",d:"M12 17a2 2 0 0 1-2-2c0-1.11.89-2 2-2a2 2 0 0 1 2 2a2 2 0 0 1-2 2m6 3V10H6v10zm0-12a2 2 0 0 1 2 2v10a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V10c0-1.11.89-2 2-2h1V6a5 5 0 0 1 5-5a5 5 0 0 1 5 5v2zm-6-5a3 3 0 0 0-3 3v2h6V6a3 3 0 0 0-3-3"},null,-1)]))}const Ve=I({name:"mdi-lock-outline",render:ze}),Me={style:{display:"inline-block"},viewBox:"0 0 24 24",width:"1em",height:"1em"};function Ue(t,a){return _(),w("svg",Me,a[0]||(a[0]=[r("path",{fill:"currentColor",d:"M12 4a4 4 0 0 1 4 4a4 4 0 0 1-4 4a4 4 0 0 1-4-4a4 4 0 0 1 4-4m0 2a2 2 0 0 0-2 2a2 2 0 0 0 2 2a2 2 0 0 0 2-2a2 2 0 0 0-2-2m0 7c2.67 0 8 1.33 8 4v3H4v-3c0-2.67 5.33-4 8-4m0 1.9c-2.97 0-6.1 1.46-6.1 2.1v1.1h12.2V17c0-.64-3.13-2.1-6.1-2.1"},null,-1)]))}const Fe=I({name:"mdi-account-outline",render:Ue}),$e={style:{display:"inline-block"},viewBox:"0 0 24 24",width:"1em",height:"1em"};function Ae(t,a){return _(),w("svg",$e,a[0]||(a[0]=[r("path",{fill:"currentColor",d:"M21 11c0 5.55-3.84 10.74-9 12c-5.16-1.26-9-6.45-9-12V5l9-4l9 4zm-9 10c3.75-1 7-5.46 7-9.78V6.3l-7-3.12L5 6.3v4.92C5 15.54 8.25 20 12 21M11 7h2v6h-2zm0 8h2v2h-2z"},null,-1)]))}const Be=I({name:"mdi-shield-alert-outline",render:Ae});var O=(t=>(t[t.LOGIN=0]="LOGIN",t[t.RESET_PASSWORD=1]="RESET_PASSWORD",t))(O||{});const M=m(0);function Te(){function t(c){M.value=c}const a=v(()=>M.value);function n(){t(0)}return{setLoginState:t,getLoginState:a,handleBackLogin:n}}function Ne(t){const a=e(t);if(!a)return;const n=P(),c=P();return a.validate(u=>{u?c.trigger(u):n.trigger(u)}),{onSuccess:n.on,onError:c.on}}function De(){const{t}=H(),a=t("sys.login.needInputUsername"),n=t("sys.login.needInputPassword"),c=t("sys.login.needInputCaptcha"),u=V(a),y=V(n),C=V(c);return{getFormRules:v(()=>{switch(e(M)){case 1:return{username:u};default:return{captcha:C,username:u,password:y}}})}}function V(t){return[{required:!0,message:t,trigger:"change"}]}const Pe=""+new URL("../images/logo-dark-sub.png",import.meta.url).href,He=""+new URL("../images/logo-light-sub.png",import.meta.url).href,Oe=["src"],Ee={class:"inline-container"},Ge={class:"left-content"},qe={class:"right-content"},je={class:"flex flex-col items-end gap-6"},We=Z({__name:"LoginForm",setup(t){const{apiUrl:a=""}=we(),{t:n}=H(),{notification:c,dialog:u,message:y}=xe(),C=ye(),{getLoginState:U}=Te(),{getFormRules:E}=De(),{getIsDarkMode:F}=be(),G=v(()=>e(U)===O.LOGIN),$=m(),d=m(!1),R=m(!0),b=m(!1),A=m(),i=ee({username:"",password:"",captcha:""}),q=v(()=>F.value?Pe:He),j=v(()=>F.value?"#ffffff14":"#f2f3f5");ne(async()=>{await B()});async function B(){const k=await ke();b.value=k.showCaptcha,b.value&&T()}function T(){A.value=`${a}/captcha?w=120&h=48&background=transparent&t=${new Date().getTime()}`}async function N(){if(!i.username||!i.password){y.warning(n("sys.login.needInputAuthentication"),{keepAliveOnHover:!0});return}else if(b.value&&!i.captcha){y.warning(n("sys.login.needInputVerification"),{keepAliveOnHover:!0});return}const{onSuccess:k}=Ne($);k(async()=>{try{d.value=!0;const o=await C.login(fe({username:i.username,password:i.password,captcha:i.captcha,mode:"none"}));if(o){const{lastLoginInfo:p}=o;p&&p.loginTime&&setTimeout(()=>{const f=c?.create({title:n("sys.login.lastLoginInfoTitle"),content:`${n("sys.login.lastLoginInfoIp")}${p.loginIp||"Unknown"}
${n("sys.login.lastLoginInfoAddress")}${p.loginAddress||"Unknown"}`,meta:p.loginTime||"Unknown",duration:void 0,closable:!1,avatar:()=>x(he,{size:"small",style:"background-color: transparent;"},{default:()=>x(ve,{color:"var(--app-primary-color)"},{default:()=>x(Be)})}),action:()=>x(z,{quaternary:!0,type:"primary",size:"small",focusable:!1,onClick:()=>{f.destroy()}},{default:()=>n("sys.login.lastLoginInfoRead")})})},1300)}}catch(o){u?.error({title:n("sys.login.failTitle"),content:o.message||n("sys.api.networkExceptionMsg"),autoFocus:!1}),await B()}finally{d.value=!1}})}return(k,o)=>{const p=Fe,f=re,L=le,W=Ve,K=Le,Q=de,D=ue,J=me,X=ge,Y=se;return te((_(),w("div",null,[r("img",{src:e(q),draggable:!1,title:"Logo",class:"select-none",style:{width:"40%",margin:"10px auto"}},null,8,Oe),s(Y,{ref_key:"formRef",ref:$,class:"p-6",model:e(i),rules:e(E),"show-label":!1,"label-placement":"left","show-require-mark":!0,onKeypress:oe(N,["enter"])},{default:l(()=>[s(L,{label:"username",path:"username"},{default:l(()=>[s(f,{value:e(i).username,"onUpdate:value":o[0]||(o[0]=g=>e(i).username=g),size:"large",placeholder:e(n)("sys.login.accountPlaceholder"),disabled:e(d)},{prefix:l(()=>[s(p)]),_:1},8,["value","placeholder","disabled"])]),_:1}),s(L,{label:"password",path:"password"},{default:l(()=>[s(f,{value:e(i).password,"onUpdate:value":o[1]||(o[1]=g=>e(i).password=g),size:"large",type:"password","show-password-on":"click",placeholder:e(n)("sys.login.passwordPlaceholder"),disabled:e(d)},{prefix:l(()=>[s(W)]),_:1},8,["value","placeholder","disabled"])]),_:1}),r("div",Ee,[e(b)?(_(),ie(L,{key:0,label:"captcha",path:"captcha",style:{width:"100%"}},{default:l(()=>[r("div",Ge,[s(f,{value:e(i).captcha,"onUpdate:value":o[2]||(o[2]=g=>e(i).captcha=g),size:"large",maxlength:"5",type:"text",disabled:e(d),placeholder:e(n)("sys.login.captchaPlaceholder")},{prefix:l(()=>[s(K)]),_:1},8,["value","disabled","placeholder"])]),o[4]||(o[4]=r("div",{style:{flex:"0 0 8px"}},null,-1)),r("div",qe,[s(D,{trigger:"hover"},{trigger:l(()=>[s(Q,{src:e(A),"preview-disabled":"",style:pe({backgroundColor:e(j),height:"40px",borderRadius:"3px",cursor:"pointer"}),onClick:T},null,8,["src","style"])]),default:l(()=>[r("span",null,h(e(n)("sys.login.captchaTips")),1)]),_:1})])]),_:1})):ce("",!0)]),r("div",je,[s(X,{justify:"space-between",style:{width:"100%"}},{default:l(()=>[s(J,{checked:e(R),"onUpdate:checked":o[3]||(o[3]=g=>_e(R)?R.value=g:null),size:"small",disabled:e(d)},{default:l(()=>[S(h(e(n)("sys.login.rememberMe")),1)]),_:1},8,["checked","disabled"]),s(D,{placement:"left",trigger:"hover",style:{"max-width":"200px"}},{trigger:l(()=>[s(e(z),{tag:"a",text:"",focusable:!1,size:"small"},{default:l(()=>[S(h(e(n)("sys.login.forgetPassword")),1)]),_:1})]),default:l(()=>[r("span",null,h(e(n)("sys.login.forgetPasswordTips")),1)]),_:1})]),_:1}),s(e(z),{type:"primary",size:"large",block:"",focusable:!1,style:{"border-radius":"5px"},loading:e(d),disabled:e(d),onClick:N},{default:l(()=>[S(h(e(n)("sys.login.loginButton")),1)]),_:1},8,["loading","disabled"])])]),_:1},8,["model","rules"])],512)),[[ae,e(G)]])}}}),Xe=Ie(We,[["__scopeId","data-v-bf8f93f9"]]);export{Xe as default};
