import{_ as se,a as ie,b as re}from"./app-702551de.js";import{aJ as ue,a3 as _,aC as ce,ah as u,G as _e,y as B,r as pe,J as fe,F as t,a4 as f,a5 as e,a6 as n,aD as c,aP as z,aF as C,aE as q,al as O,a_ as G,aQ as Q,aw as ge,b1 as de,aH as me,cp as ve,b5 as ye,bJ as he,bI as be,b8 as we,aR as xe,b2 as ke,be as ze,bD as Ce,bx as Le,by as Te}from"./vendor-d56b0496.js";import{_ as Ne,a as Fe}from"./app-c1db4c8f.js";import{g as Z,j as Ie,b as De}from"./app-651c98d4.js";import{u as Be}from"./app-3da0bfa2.js";import{d as Re,b as $e}from"./app-d0ea65e6.js";const He={style:{display:"inline-block"},viewBox:"0 0 24 24",width:"1em",height:"1em"};function Se(K,T){return _(),ce("svg",He,T[0]||(T[0]=[u("path",{fill:"currentColor",d:"M13.5 8H12v5l4.28 2.54l.72-1.21l-3.5-2.08zM13 3a9 9 0 0 0-9 9H1l3.96 4.03L9 12H6a7 7 0 0 1 7-7a7 7 0 0 1 7 7a7 7 0 0 1-7 7c-1.93 0-3.68-.79-4.94-2.06l-1.42 1.42A8.9 8.9 0 0 0 13 21a9 9 0 0 0 9-9a9 9 0 0 0-9-9"},null,-1)]))}const Me=ue({name:"mdi-history",render:Se}),Je=_e({__name:"viewHistory",setup(K,{expose:T}){const{message:R}=Re(),{t:r}=$e(),{getIsMobile:$}=Be(),I=B(null),p=B($.value?14:16),N=B(null),X=pe({show:!1,log:"",showFullScreen:!1,currentPath:"",selectData:[]}),{show:h,log:g,showFullScreen:x,currentPath:d,selectData:m}=fe(X);async function Y(a){let l="";try{l=typeof a.config=="object"&&a.config.log_directory?a.config.log_directory:a.log_path}catch{}if(!l)return;const b=a.is_running;try{if(await ee(l),m.value.length){m.value.sort((s,y)=>{const w=s.name.replace(".log","").replace(/-/g,"");return y.name.replace(".log","").replace(/-/g,"")-w});const v=b&&m.value[1]?m.value[1]:m.value[0];d.value=v.path;const o=await Z({path:v.path});g.value=o,h.value=!0}else R.warning(r("page.cron.viewHistory.noLatestMsg"))}catch{R.warning(r("page.cron.viewHistory.noLatestMsg"))}}async function H(a,l){if(!l.disabled)try{const b=await Z({path:l.value});g.value=b,d.value=a}catch{}}async function ee(a){const l=await Ie({path:a}),b=ne(l.children);m.value=b.slice().reverse()}function ne(a){return(v=>{v.length&&v.forEach(o=>{if(o.type===1){const s=o.name;if(s){const y=s.substring(s.lastIndexOf(".")+1),w=De[y]||{};Object.assign(o,{value:o.path,label:s.replace(/\.log$/,""),language:"plaintext",disabled:w.icon&&w.disabled||!1})}}})})(a),a=(v=>v.filter(o=>!o.disabled))(a),a}function L(a){switch(a){case"scrollToTop":G(()=>{N.value?.scrollTo({top:0,behavior:"smooth"})});break;case"scrollToBottom":G(()=>{const l=I.value?.$el?.clientHeight;N.value?.scrollTo({top:l,behavior:"smooth"})});break;case"fullScreen":x.value=!x.value;break}}function k(){h.value=!1,g.value="",x.value=!1,d.value="",m.value=[]}return T({open:Y}),(a,l)=>{const b=Ne,v=Fe,o=Q,s=ge,y=de,w=me,D=Me,S=ve,M=se,le=Q,F=ye,E=he,U=be,j=ie,A=re,P=we,V=xe,J=ke,W=ze,te=Ce,oe=Le,ae=Te;return t($)?(_(),f(ae,{key:1,show:t(h),"onUpdate:show":l[10]||(l[10]=i=>C(h)?h.value=i:null),height:"calc(var(--vh) * 100)",width:"100vw",placement:"bottom","auto-focus":!1,"mask-closable":!1,onMaskClick:k,onAfterLeave:k},{default:e(()=>[n(oe,{"header-style":"height: 60px; padding: 16px 12px","body-content-style":"padding: 4px 0 4px 8px; overscroll-behavior: none","footer-style":"padding: 16px 24px 24px 24px"},{header:e(()=>[n(V,{style:{gap:"4px"}},{default:e(()=>[n(o,{size:28,color:"var(--app-primary-color)"},{default:e(()=>[n(D,{style:{"vertical-align":"0"}})]),_:1}),n(S,{value:t(d),"onUpdate:value":l[6]||(l[6]=i=>C(d)?d.value=i:null),class:"max-w-190px w-190px ml-1",size:"small","consistent-menu-width":!1,options:t(m),"on-update:value":H},null,8,["value","options"]),t(g)?(_(),f(P,{key:0,style:{"padding-left":"8px"}},{default:e(()=>[n(U,{"show-arrow":!1,trigger:"hover",placement:"bottom"},{trigger:e(()=>[n(s,{strong:"",secondary:"",size:"small",focusable:!1},{icon:e(()=>[n(o,null,{default:e(()=>[n(M,{style:{"vertical-align":"baseline"}})]),_:1})]),_:1})]),default:e(()=>[n(w,null,{default:e(()=>[n(F,{strong:""},{default:e(()=>[z(c(t(p)),1)]),_:1}),n(E,{value:t(p),"onUpdate:value":l[7]||(l[7]=i=>C(p)?p.value=i:null),style:{width:"120px"},tooltip:!1,min:12,max:24,step:1},null,8,["value"])]),_:1})]),_:1}),n(y,{"show-arrow":!1,trigger:"click",delay:500},{trigger:e(()=>[n(s,{strong:"",secondary:"",size:"small",focusable:!1,onClick:l[8]||(l[8]=i=>L("scrollToTop"))},{icon:e(()=>[n(o,{size:18},{default:e(()=>[n(j,{style:{"vertical-align":"baseline"}})]),_:1})]),_:1})]),default:e(()=>[u("span",null,c(t(r)("file.top.button")),1)]),_:1}),n(y,{"show-arrow":!1,trigger:"click",delay:500},{trigger:e(()=>[n(s,{strong:"",secondary:"",size:"small",focusable:!1,onClick:l[9]||(l[9]=i=>L("scrollToBottom"))},{icon:e(()=>[n(o,{size:18},{default:e(()=>[n(A,{style:{"vertical-align":"baseline"}})]),_:1})]),_:1})]),default:e(()=>[u("span",null,c(t(r)("file.bottom.button")),1)]),_:1})]),_:1})):q("",!0)]),_:1})]),default:e(()=>[n(W,{ref_key:"logInstWrapRef",ref:N,"native-scrollbar":!0,style:{width:"100%",height:"100%","background-color":"transparent"}},{default:e(()=>[u("div",null,[t(g)?(_(),f(J,{key:1,ref_key:"logInstRef",ref:I,log:t(g),"line-height":1.5,"font-size":t(p),language:"naive-log",style:{width:"100%",height:"100%"}},null,8,["log","font-size"])):(_(),f(F,{key:0},{default:e(()=>[z(c(t(r)("common.noData")),1)]),_:1}))])]),_:1},512)]),footer:e(()=>[n(s,{block:"",strong:"",secondary:"",type:"primary",focusable:!1,onClick:k},{default:e(()=>[z(c(t(r)("component.modal.close")),1)]),_:1})]),_:1})]),_:1},8,["show"])):(_(),f(te,{key:0,show:t(h),"onUpdate:show":l[5]||(l[5]=i=>C(h)?h.value=i:null),preset:"dialog","auto-focus":!1,style:O({width:t(x)?"calc(-20px + 100vw)":"600px"}),"on-close":k,"on-mask-click":k},{close:e(()=>[n(w,null,{default:e(()=>[n(y,{"show-arrow":!1,trigger:"hover",delay:500},{trigger:e(()=>[n(s,{size:"tiny",quaternary:"",focusable:!1,style:{padding:"4px"},onClick:l[0]||(l[0]=i=>L("fullScreen"))},{icon:e(()=>[n(o,{size:20,depth:2},{default:e(()=>[t(x)?(_(),f(v,{key:1,style:{"vertical-align":"baseline"}})):(_(),f(b,{key:0,style:{"vertical-align":"baseline"}}))]),_:1})]),_:1})]),default:e(()=>[u("span",null,c(t(x)?t(r)("layout.header.tooltipExitFull"):t(r)("layout.header.tooltipEntryFull")),1)]),_:1}),n(s,{size:"tiny",quaternary:"",focusable:!1,style:{padding:"4px"},onClick:k},{icon:e(()=>[n(o,{size:18,depth:2},{default:e(()=>l[11]||(l[11]=[u("svg",{viewBox:"0 0 12 12",version:"1.1",xmlns:"http://www.w3.org/2000/svg","aria-hidden":"true"},[u("g",{stroke:"none","stroke-width":"1",fill:"none","fill-rule":"evenodd"},[u("g",{fill:"currentColor","fill-rule":"nonzero"},[u("path",{d:"M2.08859116,2.2156945 L2.14644661,2.14644661 C2.32001296,1.97288026 2.58943736,1.95359511 2.7843055,2.08859116 L2.85355339,2.14644661 L6,5.293 L9.14644661,2.14644661 C9.34170876,1.95118446 9.65829124,1.95118446 9.85355339,2.14644661 C10.0488155,2.34170876 10.0488155,2.65829124 9.85355339,2.85355339 L6.707,6 L9.85355339,9.14644661 C10.0271197,9.32001296 10.0464049,9.58943736 9.91140884,9.7843055 L9.85355339,9.85355339 C9.67998704,10.0271197 9.41056264,10.0464049 9.2156945,9.91140884 L9.14644661,9.85355339 L6,6.707 L2.85355339,9.85355339 C2.65829124,10.0488155 2.34170876,10.0488155 2.14644661,9.85355339 C1.95118446,9.65829124 1.95118446,9.34170876 2.14644661,9.14644661 L5.293,6 L2.14644661,2.85355339 C1.97288026,2.67998704 1.95359511,2.41056264 2.08859116,2.2156945 L2.14644661,2.14644661 L2.08859116,2.2156945 Z"})])])],-1)])),_:1})]),_:1})]),_:1})]),icon:e(()=>[n(o,{size:24},{default:e(()=>[n(D,{style:{"vertical-align":"0"}})]),_:1})]),header:e(()=>[n(V,null,{default:e(()=>[z(c(t(r)("page.cron.table.history"))+" ",1),n(S,{value:t(d),"onUpdate:value":l[1]||(l[1]=i=>C(d)?d.value=i:null),class:"max-w-190px w-190px",size:"small","consistent-menu-width":!1,options:t(m),"on-update:value":H},null,8,["value","options"]),t(g)?(_(),f(P,{key:0},{default:e(()=>[n(U,{"show-arrow":!1,trigger:"hover",placement:"bottom"},{trigger:e(()=>[n(s,{strong:"",secondary:"",size:"small",focusable:!1},{icon:e(()=>[n(le,null,{default:e(()=>[n(M,{style:{"vertical-align":"baseline"}})]),_:1})]),_:1})]),default:e(()=>[n(w,null,{default:e(()=>[n(F,{strong:""},{default:e(()=>[z(c(t(p)),1)]),_:1}),n(E,{value:t(p),"onUpdate:value":l[2]||(l[2]=i=>C(p)?p.value=i:null),style:{width:"120px"},tooltip:!1,min:12,max:24,step:1},null,8,["value"])]),_:1})]),_:1}),n(y,{"show-arrow":!1,trigger:"hover",delay:500},{trigger:e(()=>[n(s,{strong:"",secondary:"",size:"small",focusable:!1,onClick:l[3]||(l[3]=i=>L("scrollToTop"))},{icon:e(()=>[n(o,{size:18},{default:e(()=>[n(j,{style:{"vertical-align":"baseline"}})]),_:1})]),_:1})]),default:e(()=>[u("span",null,c(t(r)("file.top.button")),1)]),_:1}),n(y,{"show-arrow":!1,trigger:"hover",delay:500},{trigger:e(()=>[n(s,{strong:"",secondary:"",size:"small",focusable:!1,onClick:l[4]||(l[4]=i=>L("scrollToBottom"))},{icon:e(()=>[n(o,{size:18},{default:e(()=>[n(A,{style:{"vertical-align":"baseline"}})]),_:1})]),_:1})]),default:e(()=>[u("span",null,c(t(r)("file.bottom.button")),1)]),_:1})]),_:1})):q("",!0)]),_:1})]),default:e(()=>[n(W,{ref_key:"logInstWrapRef",ref:N,"native-scrollbar":!1,style:O({paddingTop:"1em",width:"100%",backgroundColor:"transparent",height:t(x)?"calc(-120px + 100vh)":"600px"})},{default:e(()=>[u("div",null,[t(g)?(_(),f(J,{key:1,ref_key:"logInstRef",ref:I,log:t(g),"line-height":1.5,"font-size":t(p),language:"naive-log",style:{width:"100%",height:"100%"}},null,8,["log","font-size"])):(_(),f(F,{key:0},{default:e(()=>[z(c(t(r)("common.noData")),1)]),_:1}))])]),_:1},8,["style"])]),_:1},8,["show","style"]))}}});export{Je as _};
