import{a7 as c,aK as J,av as v,I as O,r as F,K as X,am as w,bu as Z,ap as z,u as e,a8 as f,a9 as s,aa as o,aL as Q,aG as T,aF as S,az as E,aT as Y,b3 as ee,aE as te,cG as ne,cH as ae,bd as se,bD as le,bX as oe,aM as ie,bj as re}from"./vendor-CsvKI2kS.js";import{_ as ue,a as pe}from"./fullscreen-CDp7Z4mn.js";import{I as ce}from"./Icon-w75mFLja.js";import{u as _e}from"./useAppInject-BoZf51bk.js";import{a as de}from"./index-hO6mdrNR.js";import{k as me}from"./env-B-vNm9vX.js";const ge={style:{display:"inline-block"},viewBox:"0 0 24 24",width:"1em",height:"1em"},fe=v("path",{fill:"currentColor",d:"M21 2H3c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h18c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2m0 18H3V6h18zM16.6 8c1.5 1.3 2.4 3.1 2.4 5s-.9 3.7-2.4 5l-1.6-.6c1.3-1 2-2.7 2-4.4s-.7-3.4-2-4.4zM7.4 8l1.6.6c-1.3 1-2 2.7-2 4.4s.7 3.4 2 4.4l-1.6.6C5.9 16.7 5 14.9 5 13s.9-3.7 2.4-5m4.7 4l1.4-2H15l-2.2 3l1.3 3h-1.3l-.8-2l-1.4 2H9l2.3-3.1L10 10h1.3z"},null,-1),ve=[fe];function he(A,I){return c(),J("svg",ge,[...ve])}const xe={name:"mdi-application-variable-outline",render:he},ye=v("svg",{viewBox:"0 0 12 12",version:"1.1",xmlns:"http://www.w3.org/2000/svg","aria-hidden":"true"},[v("g",{stroke:"none","stroke-width":"1",fill:"none","fill-rule":"evenodd"},[v("g",{fill:"currentColor","fill-rule":"nonzero"},[v("path",{d:"M2.08859116,2.2156945 L2.14644661,2.14644661 C2.32001296,1.97288026 2.58943736,1.95359511 2.7843055,2.08859116 L2.85355339,2.14644661 L6,5.293 L9.14644661,2.14644661 C9.34170876,1.95118446 9.65829124,1.95118446 9.85355339,2.14644661 C10.0488155,2.34170876 10.0488155,2.65829124 9.85355339,2.85355339 L6.707,6 L9.85355339,9.14644661 C10.0271197,9.32001296 10.0464049,9.58943736 9.91140884,9.7843055 L9.85355339,9.85355339 C9.67998704,10.0271197 9.41056264,10.0464049 9.2156945,9.91140884 L9.14644661,9.85355339 L6,6.707 L2.85355339,9.85355339 C2.65829124,10.0488155 2.34170876,10.0488155 2.14644661,9.85355339 C1.95118446,9.65829124 1.95118446,9.34170876 2.14644661,9.14644661 L5.293,6 L2.14644661,2.85355339 C1.97288026,2.67998704 1.95359511,2.41056264 2.08859116,2.2156945 L2.14644661,2.14644661 L2.08859116,2.2156945 Z"})])])],-1),Ee=O({__name:"importEnv",emits:["ok"],setup(A,{expose:I,emit:$}){const M=$,{getIsMobile:B}=_e(),{t:l}=de(),t=F({show:!1,showFullScreen:!1,currentStepIndex:1,currentStepStatus:"process",inputValue:"",group_id:null,result:null,submitLoading:!1,data:[]}),{show:h,showFullScreen:_,currentStepIndex:d,currentStepStatus:N,inputValue:m,result:V,submitLoading:H,data:D}=X(t),P=[{title:l("page.env.importEnv.table.index"),key:"index",align:"center",titleAlign:"center",width:88,render(n){return w(Z,{size:"small",bordered:!1,style:"font-weight: 600"},{default:()=>n.index})}},{title:l("page.env.table.title.value"),key:"value",titleAlign:"center",render(n){return w("span",{style:{fontFamily:"var(--app-font-family-mono)"}},String(n.value||""))}},{title:l("page.env.table.title.action"),key:"actions",align:"center",titleAlign:"center",fixed:"right",width:80,render(n){return w(z,{strong:!0,tertiary:!0,focusable:!1,size:"small",type:"error",style:"padding: 0 4px",onClick:()=>q(n.index)},{icon:()=>w(ce,{icon:"fe:trash",style:"vertical-align: baseline"},{})})}}],y=F({page:1,pageSize:10,showSizePicker:!0,pageSizes:[5,10,20,100,200,500,1e3],onChange:n=>{y.page=n},onUpdatePageSize:n=>{y.pageSize=n,y.page=1}}),U=async()=>{if(t.currentStepIndex===3)M("ok"),B&&(h.value=!1);else{if(t.currentStepIndex===1){t.currentStepIndex++;let n=[],a=[],b=!1;try{n=JSON.parse(m.value),Array.isArray(n)&&(b=!0,a=n.filter(r=>r.trim()!==""))}catch{n=m.value.split(`
`)}if(!b){const r=/^(?:export\s+)?\w+=('([^']*)'|"([^"]*)")/,u=/'([^']*)'|"([^"]*)"/,k=/^[^#]*/,C=/([^#]*)/;n.forEach(L=>{const i=L.trim();if(i.startsWith("#")||i.startsWith("//"))return;let p;if(r.test(i)){p=u.exec(i);const g=p[1]||p[2];a.push(g)}else if(k.test(i)){p=C.exec(i);const g=p[1].trim();g&&a.push(g)}else a.push(i)})}t.data=a.map((r,u)=>({index:u+1,value:r}))}else if(t.currentStepIndex===2){const n=t.data.map(a=>({group_id:t.group_id,type:"",value:a.value}));t.submitLoading=!0;try{await me(n),t.result=!0,t.currentStepStatus="finish"}catch{t.result=!1,t.currentStepStatus="error"}finally{t.submitLoading=!1,t.currentStepIndex++}}return!1}},j=n=>{switch(n){case"fullScreen":t.showFullScreen=!t.showFullScreen;break}},q=n=>{t.data=t.data.filter(a=>a.index!==n)};return I({open:n=>{t.showFullScreen=!1,t.inputValue="",t.currentStepIndex=1,t.currentStepStatus="process",t.group_id=n,t.show=!0}}),(n,a)=>{const b=ue,r=pe,u=Y,k=ee,C=te,L=xe,i=ne,p=ae,g=se,G=le,K=oe,R=ie,W=re;return e(B)?S("",!0):(c(),f(W,{key:0,show:e(h),"onUpdate:show":a[3]||(a[3]=x=>T(h)?h.value=x:null),preset:"dialog","auto-focus":!1,"mask-closable":!1,"positive-text":e(d)===2?e(l)("page.env.importEnv.submitButton"):e(d)===3?e(l)("page.env.importEnv.finishButton"):e(l)("page.env.importEnv.nextButton"),"positive-button-props":{disabled:e(m).trim()==="",loading:e(H)},"negative-text":e(l)("common.cancelText"),"negative-button-props":{ghost:!1,tertiary:!0},style:E({width:e(_)?"calc(-20px + 100vw)":"860px"}),onPositiveClick:U},{close:s(()=>[o(C,null,{default:s(()=>[o(k,{"show-arrow":!1,trigger:"hover",delay:500},{trigger:s(()=>[o(e(z),{size:"tiny",quaternary:"",focusable:!1,style:{padding:"4px"},onClick:a[0]||(a[0]=x=>j("fullScreen"))},{icon:s(()=>[o(u,{size:20,depth:2},{default:s(()=>[e(_)?(c(),f(r,{key:1,style:{"vertical-align":"baseline"}})):(c(),f(b,{key:0,style:{"vertical-align":"baseline"}}))]),_:1})]),_:1})]),default:s(()=>[v("span",null,Q(e(_)?e(l)("layout.header.tooltipExitFull"):e(l)("layout.header.tooltipEntryFull")),1)]),_:1}),o(e(z),{size:"tiny",quaternary:"",focusable:!1,style:{padding:"4px"},onClick:a[1]||(a[1]=x=>h.value=!1)},{icon:s(()=>[o(u,{size:18,depth:2},{default:s(()=>[ye]),_:1})]),_:1})]),_:1})]),icon:s(()=>[o(u,{size:28},{default:s(()=>[o(L,{style:{"vertical-align":"0"}})]),_:1})]),header:s(()=>[o(p,{size:"small",style:{"padding-left":"20px",width:"calc(100% - 60px)"},current:e(d),status:e(N)},{default:s(()=>[o(i,{title:e(l)("page.env.importEnv.step.input")},null,8,["title"]),o(i,{title:e(l)("page.env.importEnv.step.check")},null,8,["title"]),o(i,{title:e(l)("page.env.importEnv.step.submit")},null,8,["title"])]),_:1},8,["current","status"])]),default:s(()=>[o(R,{bordered:!1,style:E({paddingTop:"10px",height:e(_)?"calc(-140px + 100vh)":"600px",wordBreak:"unset"}),"content-style":"height: 100%; padding: 0"},{default:s(()=>[e(d)===1?(c(),f(g,{key:0,value:e(m),"onUpdate:value":a[2]||(a[2]=x=>T(m)?m.value=x:null),rows:25,type:"textarea",style:{"font-family":"var(--app-font-family-mono)"}},null,8,["value"])):S("",!0),e(d)===2?(c(),f(G,{key:1,columns:P,data:e(D),"max-height":e(_)?"calc(100vh - 240px)":"500px",pagination:e(y)},null,8,["columns","data","max-height","pagination"])):S("",!0),e(d)===3?(c(),f(K,{key:2,status:e(V)?"success":"error",size:"huge",style:E({paddingTop:e(_)?"30vh":"180px"}),title:e(l)(`page.env.importEnv.${e(V)?"success":"error"}`)},null,8,["status","style","title"])):S("",!0)]),_:1},8,["style"])]),_:1},8,["show","positive-text","positive-button-props","negative-text","style"]))}}});export{Ee as _};
