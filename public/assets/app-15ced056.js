import{I as be}from"./app-5d8356b8.js";import{az as ue,aq as V,T as s,a5 as B,G as ye,A as le,r as he,J as ke,S as i,F as e,bv as xe,at as U,V as l,W as t,bw as we,ar as N,bx as Ce,b0 as ze,bf as Ue,bg as Te,aT as $e,be as Ee,aN as m,as as p,av as Pe,a7 as te,b9 as Ne,aG as ae,bi as Ve,bc as Ie,cv as Le,ak as Se,aw as Ae,ax as Re,bt as Be,aQ as Me,b6 as Oe,bu as qe,n as q,ag as je}from"./vendor-ca0e89fa.js";import{i as ne,j as oe}from"./app-7cf80934.js";import{d as De,a as Fe,b as Ge,ai as se}from"./app-dbd4b5f0.js";import{u as He}from"./app-40fcbbd5.js";const Je={style:{display:"inline-block"},viewBox:"0 0 24 24",width:"1em",height:"1em"};function Qe(j,T){return s(),V("svg",Je,T[0]||(T[0]=[B("path",{fill:"currentColor",d:"M17 14h2v3h3v2h-3v3h-2v-3h-3v-2h3zm-6 2L2 9l9-7l9 7zm0 2.54l1-.79V18c0 .71.12 1.39.35 2L11 21.07l-9-7l1.62-1.26z"},null,-1)]))}const We=ue({name:"mdi-layers-plus",render:Qe}),Ke={style:{display:"inline-block"},viewBox:"0 0 24 24",width:"1em",height:"1em"};function Xe(j,T){return s(),V("svg",Ke,T[0]||(T[0]=[B("path",{fill:"currentColor",d:"M4.63 10.27L3 9l9-7l7.94 6.17l-7.44 7.44l-.5.39zM10 18.94v-.83l.59-.58l.04-.03l-6.01-4.69L3 14.07l7 5.43zm11.7-6.36l-1.28-1.28a.55.55 0 0 0-.77 0l-1 1l2.05 2.05l1-1a.55.55 0 0 0 0-.77M12 21h2.06l6.05-6.07l-2.05-2.05L12 18.94z"},null,-1)]))}const Ye=ue({name:"mdi-layers-edit",render:Xe}),Ze={style:{"vertical-align":"-5px",padding:"0 2px"}},ol=ye({__name:"editEnv",emits:["ok"],setup(j,{expose:T,emit:ie}){const pe=ie,{getIsMobile:D}=He(),{message:I}=De(),{getThemeColor:re}=Fe(),{t:o}=Ge(),f=le([]),M=le(null),v=he({title:"",type:"ordinary",show:!1,model:{},rules:{type:{required:!0,message:o("page.env.table.form.message.no_type"),trigger:["input","blur"]},enable:{required:!0},separator:{required:!1},value:{message:o("page.env.table.form.message.no_value"),trigger:["input","blur"]}},tagLabel:"",tagColor:re.value,showAddTagPopover:!1,isCompositeEnvValue:!1}),{title:O,type:h,show:k,model:u,rules:F,tagLabel:c,tagColor:x,showAddTagPopover:y,isCompositeEnvValue:E}=ke(v),S={onkeydown(r){if(r.key==="Enter")return I.warning(o("page.env.table.form.message.no_enter")),!1}};function G(){return new Promise(r=>{M.value?.validate(async a=>{if(!a)try{const d=v.model,w=v.type==="composite",C=v.type==="composite_value";delete d.update_time,d.id||delete d.id,w&&delete d.envs,C?d.tag_list="":d.tag_list=f.value.length>0?JSON.stringify(f.value):"",d.id?(w?await ne(d):await oe(d),I.success(o("page.env.table.message.edit.ok"))):(w?await ne(d):await oe(d),I.success(o("page.env.table.message.new.ok"))),pe("ok"),r(!0),D&&(k.value=!1)}catch(d){throw new Error(d)}r(!1)}).catch(()=>{})})}function H(){if(!c.value||!x.value){I.warning(o("page.env.editEnv.needInputTagContentMsg"));return}if(f.value.length>0){for(const r of f.value)if(r.label===c.value){I.warning(o("page.env.editEnv.tagExistedMsg"));return}}f.value.push({label:c.value,color:x.value}),c.value="",y.value=!1}function J(r){f.value.splice(r,1)}function Q(r){return{color:q(r).setAlpha(.12).toHex8String(),borderColor:q(r).toHexString(),textColor:q(r).toHexString()}}function de(r,a={},d=0){const w=r==="composite";E.value=r==="composite_value",E.value?v.title=o(`page.env.table.${a?.id?"editValue":"newValue"}`):v.title=o(`page.env.table.${a?.id?"edit":"new"}`);const C=Object.assign({id:null,type:"",description:"",update_time:"",tag_list:"",enable:1},w?{separator:"",envs:0}:{group_id:r==="composite_value"?d:0,remark:"",value:"",sort:0});v.model=je(C),Object.assign(v.model,a);try{f.value=[];const $=JSON.parse(v.model.tag_list||"['']");Array.isArray($)&&$.forEach(b=>{!b.label||!b.color||f.value.push(b)})}catch{v.model.tag_list=""}v.type=r,v.show=!0}return T({open:de}),(r,a)=>{const d=Ye,w=We,C=Ae,$=Ne,b=Pe,g=ze,_=Ce,z=Ee,A=$e,R=Te,W=Ue,K=be,P=Se,X=Le,Y=Ie,Z=Ve,ee=we,me=Re,_e=xe,ve=Oe,ge=Me,fe=qe,ce=Be;return e(D)?(s(),i(ce,{key:1,show:e(k),"onUpdate:show":a[24]||(a[24]=n=>U(k)?k.value=n:null),height:"calc(var(--vh) * 100)",width:"100vw",placement:"right","auto-focus":!1,"mask-closable":!1},{default:l(()=>[t(fe,{closable:"","header-style":"height: 60px; padding: 16px 12px","body-content-style":"padding: 4px 12px","footer-style":"padding: 16px 24px"},{header:l(()=>[t(ge,{style:{gap:"4px"}},{default:l(()=>[t(C,{size:26,color:"var(--app-primary-color)"},{default:l(()=>[e(u).id?(s(),i(d,{key:0})):(s(),i(w,{key:1}))]),_:1}),t(ve,{style:{height:"100%","max-width":"260px"}},{tooltip:l(()=>[B("span",null,p(e(O)),1)]),default:l(()=>[B("span",Ze,p(e(O)),1)]),_:1}),t($,{size:"small",bordered:!1,style:{"margin-top":"2px"}},{default:l(()=>[m(p(e(h)==="ordinary"?e(o)("page.env.type.ordinary"):e(o)("page.env.type.composite")),1)]),_:1})]),_:1})]),footer:l(()=>[t(b,null,{default:l(()=>[t(P,{tertiary:"",focusable:!1,onClick:a[23]||(a[23]=n=>k.value=!1)},{default:l(()=>[m(p(e(o)("common.cancelText")),1)]),_:1}),t(P,{type:"primary",focusable:!1,onClick:G},{default:l(()=>[m(p(e(o)("common.okText")),1)]),_:1})]),_:1})]),default:l(()=>[t(ee,{ref_key:"formRef",ref:M,model:e(u),rules:e(F),style:{"padding-top":"1em"}},{default:l(()=>[e(E)?N("",!0):(s(),i(_,{key:0,label:e(o)("page.env.table.title.type"),path:"type"},{default:l(()=>[t(g,{value:e(u).type,"onUpdate:value":a[12]||(a[12]=n=>e(u).type=n),maxlength:"200",clearable:""},null,8,["value"])]),_:1},8,["label"])),e(h)==="composite"?(s(),i(W,{key:1,"x-gap":"12",cols:3},{default:l(()=>[t(R,{span:2},{default:l(()=>[t(_,{label:e(o)("page.env.table.title.enable"),path:"enable"},{default:l(()=>[t(A,{value:e(u).enable,"onUpdate:value":a[13]||(a[13]=n=>e(u).enable=n),animated:"",type:"segment",size:"small",style:{height:"34px"}},{default:l(()=>[(s(),i(z,{key:1,name:1},{default:l(()=>[m(p(e(o)("common.active")),1)]),_:1})),(s(),i(z,{key:0,name:0},{default:l(()=>[m(p(e(o)("common.inactive")),1)]),_:1}))]),_:1},8,["value"])]),_:1},8,["label"])]),_:1}),t(R,{span:1},{default:l(()=>[t(_,{label:e(o)("page.env.table.title.separator"),path:"separator"},{default:l(()=>[t(g,{value:e(u).separator,"onUpdate:value":a[14]||(a[14]=n=>e(u).separator=n),placeholder:e(o)("page.env.table.none"),style:{width:"100%"},"input-props":S},null,8,["value","placeholder"])]),_:1},8,["label"])]),_:1})]),_:1})):(s(),i(_,{key:2,label:e(o)("page.env.table.title.enable"),path:"enable"},{default:l(()=>[t(A,{value:e(u).enable,"onUpdate:value":a[15]||(a[15]=n=>e(u).enable=n),animated:"",type:"segment",size:"small",style:{height:"34px"}},{default:l(()=>[(s(),i(z,{key:1,name:1},{default:l(()=>[m(p(e(o)("common.active")),1)]),_:1})),(s(),i(z,{key:0,name:0},{default:l(()=>[m(p(e(o)("common.inactive")),1)]),_:1}))]),_:1},8,["value"])]),_:1},8,["label"])),e(h)!=="composite"?(s(),i(_,{key:3,label:e(o)("page.env.table.title.value"),path:"value"},{default:l(()=>[t(g,{value:e(u).value,"onUpdate:value":a[16]||(a[16]=n=>e(u).value=n),type:"textarea","input-props":S},null,8,["value"])]),_:1},8,["label"])):N("",!0),e(E)?(s(),i(_,{key:5,label:e(o)("page.env.table.title.remark"),path:"remark"},{default:l(()=>[t(g,{value:e(u).remark,"onUpdate:value":a[18]||(a[18]=n=>e(u).remark=n)},null,8,["value"])]),_:1},8,["label"])):(s(),i(_,{key:4,label:e(o)("page.env.table.title.description"),path:"description"},{default:l(()=>[t(g,{value:e(u).description,"onUpdate:value":a[17]||(a[17]=n=>e(u).description=n)},null,8,["value"])]),_:1},8,["label"])),e(h)!=="composite_value"?(s(),i(_,{key:6,label:e(o)("page.env.table.title.tag_list"),path:"tag_list"},{default:l(()=>[t(b,null,{default:l(()=>[(s(!0),V(ae,null,te(e(f),(n,L)=>(s(),V("div",{key:L,class:"tag-item"},[t($,{color:Q(n.color),bordered:!1,closable:"",onClose:()=>J(L)},{default:l(()=>[m(p(n.label),1)]),_:2},1032,["color","onClose"])]))),128)),t(Z,{show:e(y),"onUpdate:show":a[22]||(a[22]=n=>U(y)?y.value=n:null),trigger:"click"},{trigger:l(()=>[t(P,{dashed:"",focusable:!1,style:{height:"28px",padding:"0 6px"},onClick:a[19]||(a[19]=n=>y.value=!0)},{icon:l(()=>[t(C,{depth:3},{default:l(()=>[t(K)]),_:1})]),_:1})]),default:l(()=>[t(b,{wrap:!1},{default:l(()=>[t(Y,{size:"small"},{default:l(()=>[t(X,{value:e(x),"onUpdate:value":a[20]||(a[20]=n=>U(x)?x.value=n:null),size:"small",swatches:e(se),"render-label":()=>null,modes:["hex"],"show-alpha":!1,style:{width:"28px",height:"100%"}},null,8,["value","swatches"]),t(g,{value:e(c),"onUpdate:value":a[21]||(a[21]=n=>U(c)?c.value=n:null),size:"small",style:{width:"120px"}},null,8,["value"])]),_:1}),t(P,{size:"small",focusable:!1,onClick:H},{default:l(()=>[m(p(e(o)("component.modal.okText")),1)]),_:1})]),_:1})]),_:1},8,["show"])]),_:1})]),_:1},8,["label"])):N("",!0)]),_:1},8,["model","rules"])]),_:1})]),_:1},8,["show"])):(s(),i(_e,{key:0,show:e(k),"onUpdate:show":a[11]||(a[11]=n=>U(k)?k.value=n:null),preset:"dialog","auto-focus":!1,"mask-closable":!1,"positive-text":e(o)("common.okText"),"negative-text":e(o)("common.cancelText"),"negative-button-props":{ghost:!1,tertiary:!0},style:{width:"460px"},onPositiveClick:G},{icon:l(()=>[t(C,{size:28},{default:l(()=>[e(u).id?(s(),i(d,{key:0})):(s(),i(w,{key:1}))]),_:1})]),header:l(()=>[t(b,null,{default:l(()=>[m(p(e(O))+" ",1),t($,{size:"small",bordered:!1,style:{"margin-top":"3px"}},{default:l(()=>[m(p(e(h)==="ordinary"?e(o)("page.env.type.ordinary"):e(o)("page.env.type.composite")),1)]),_:1})]),_:1})]),default:l(()=>[t(me,{bordered:!1,style:{height:"100%","word-break":"unset"},"content-style":"padding: 0"},{default:l(()=>[t(ee,{ref_key:"formRef",ref:M,model:e(u),rules:e(F),"label-width":"auto","require-mark-placement":"right-hanging",style:{"padding-top":"1em"}},{default:l(()=>[e(E)?N("",!0):(s(),i(_,{key:0,label:e(o)("page.env.table.title.type"),path:"type"},{default:l(()=>[t(g,{value:e(u).type,"onUpdate:value":a[0]||(a[0]=n=>e(u).type=n),maxlength:"200",clearable:""},null,8,["value"])]),_:1},8,["label"])),e(h)==="composite"?(s(),i(W,{key:1,"x-gap":"12",cols:3},{default:l(()=>[t(R,{span:2},{default:l(()=>[t(_,{label:e(o)("page.env.table.title.enable"),path:"enable"},{default:l(()=>[t(A,{value:e(u).enable,"onUpdate:value":a[1]||(a[1]=n=>e(u).enable=n),animated:"",type:"segment",size:"small",style:{height:"34px"}},{default:l(()=>[(s(),i(z,{key:1,name:1},{default:l(()=>[m(p(e(o)("common.active")),1)]),_:1})),(s(),i(z,{key:0,name:0},{default:l(()=>[m(p(e(o)("common.inactive")),1)]),_:1}))]),_:1},8,["value"])]),_:1},8,["label"])]),_:1}),t(R,{span:1},{default:l(()=>[t(_,{label:e(o)("page.env.table.title.separator"),path:"separator"},{default:l(()=>[t(g,{value:e(u).separator,"onUpdate:value":a[2]||(a[2]=n=>e(u).separator=n),placeholder:e(o)("page.env.table.none"),style:{width:"100%"},"input-props":S},null,8,["value","placeholder"])]),_:1},8,["label"])]),_:1})]),_:1})):(s(),i(_,{key:2,label:e(o)("page.env.table.title.enable"),path:"enable"},{default:l(()=>[t(A,{value:e(u).enable,"onUpdate:value":a[3]||(a[3]=n=>e(u).enable=n),animated:"",type:"segment",size:"small",style:{height:"34px"}},{default:l(()=>[(s(),i(z,{key:1,name:1},{default:l(()=>[m(p(e(o)("common.active")),1)]),_:1})),(s(),i(z,{key:0,name:0},{default:l(()=>[m(p(e(o)("common.inactive")),1)]),_:1}))]),_:1},8,["value"])]),_:1},8,["label"])),e(h)!=="composite"?(s(),i(_,{key:3,label:e(o)("page.env.table.title.value"),path:"value"},{default:l(()=>[t(g,{value:e(u).value,"onUpdate:value":a[4]||(a[4]=n=>e(u).value=n),type:"textarea","input-props":S},null,8,["value"])]),_:1},8,["label"])):N("",!0),e(E)?(s(),i(_,{key:5,label:e(o)("page.env.table.title.remark"),path:"remark"},{default:l(()=>[t(g,{value:e(u).remark,"onUpdate:value":a[6]||(a[6]=n=>e(u).remark=n)},null,8,["value"])]),_:1},8,["label"])):(s(),i(_,{key:4,label:e(o)("page.env.table.title.description"),path:"description"},{default:l(()=>[t(g,{value:e(u).description,"onUpdate:value":a[5]||(a[5]=n=>e(u).description=n)},null,8,["value"])]),_:1},8,["label"])),e(h)!=="composite_value"?(s(),i(_,{key:6,label:e(o)("page.env.table.title.tag_list"),path:"tag_list"},{default:l(()=>[t(b,null,{default:l(()=>[(s(!0),V(ae,null,te(e(f),(n,L)=>(s(),V("div",{key:L,class:"tag-item"},[t($,{color:Q(n.color),bordered:!1,closable:"",onClose:()=>J(L)},{default:l(()=>[m(p(n.label),1)]),_:2},1032,["color","onClose"])]))),128)),t(Z,{show:e(y),"onUpdate:show":a[10]||(a[10]=n=>U(y)?y.value=n:null),trigger:"click"},{trigger:l(()=>[t(P,{dashed:"",style:{height:"28px",padding:"0 6px"},onClick:a[7]||(a[7]=n=>y.value=!0)},{icon:l(()=>[t(C,{depth:3},{default:l(()=>[t(K)]),_:1})]),_:1})]),default:l(()=>[t(b,{wrap:!1},{default:l(()=>[t(Y,{size:"small"},{default:l(()=>[t(X,{value:e(x),"onUpdate:value":a[8]||(a[8]=n=>U(x)?x.value=n:null),size:"small",swatches:e(se),"render-label":()=>null,modes:["hex"],"show-alpha":!1,style:{width:"28px",height:"100%"}},null,8,["value","swatches"]),t(g,{value:e(c),"onUpdate:value":a[9]||(a[9]=n=>U(c)?c.value=n:null),size:"small",style:{width:"120px"}},null,8,["value"])]),_:1}),t(P,{size:"small",focusable:!1,onClick:H},{default:l(()=>[m(p(e(o)("component.modal.okText")),1)]),_:1})]),_:1})]),_:1},8,["show"])]),_:1})]),_:1},8,["label"])):N("",!0)]),_:1},8,["model","rules"])]),_:1})]),_:1},8,["show","positive-text","negative-text"]))}}});export{ol as _};
