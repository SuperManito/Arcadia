import{_ as se,a as ie,b as re}from"./app-30b5c2e2.js";import{aN as ue,a6 as p,aG as ce,al as u,G as pe,y as R,r as _e,J as fe,F as t,a7 as f,a8 as e,a9 as n,aH as c,aT as z,aJ as C,aI as G,ap as J,b2 as O,aU as K,aA as ge,b5 as de,aL as me,br as ve,b9 as ye,bP as he,bs as be,bc as we,aV as xe,b6 as ke,bi as ze,bK as Ce,bE as Le,bF as Fe}from"./vendor-f4e37609.js";import{_ as Te,a as Ne}from"./app-3378d39a.js";import{g as Z,j as Ie,b as Be}from"./app-84e2d10f.js";import{u as Re}from"./app-34fc42c0.js";import{d as De,b as Ee}from"./app-516cf0fd.js";import{F as He}from"./app-30b30e0d.js";const Se={style:{display:"inline-block"},viewBox:"0 0 24 24",width:"1em",height:"1em"};function $e(Q,F){return p(),ce("svg",Se,F[0]||(F[0]=[u("path",{fill:"currentColor",d:"M13.5 8H12v5l4.28 2.54l.72-1.21l-3.5-2.08zM13 3a9 9 0 0 0-9 9H1l3.96 4.03L9 12H6a7 7 0 0 1 7-7a7 7 0 0 1 7 7a7 7 0 0 1-7 7c-1.93 0-3.68-.79-4.94-2.06l-1.42 1.42A8.9 8.9 0 0 0 13 21a9 9 0 0 0 9-9a9 9 0 0 0-9-9"},null,-1)]))}const Me=ue({name:"mdi-history",render:$e}),Ge=pe({__name:"viewHistory",setup(Q,{expose:F}){const{message:D}=De(),{t:r}=Ee(),{getIsMobile:E}=Re(),I=R(null),_=R(E.value?14:16),T=R(null),X=_e({show:!1,log:"",showFullScreen:!1,currentPath:"",selectData:[]}),{show:h,log:g,showFullScreen:x,currentPath:d,selectData:m}=fe(X);async function Y(a){let l="";try{l=typeof a.config=="object"&&a.config.log_directory?a.config.log_directory:a.log_path}catch{}if(!l)return;const b=a.is_running;try{if(await ee(l),m.value.length){m.value.sort((s,y)=>{const w=s.name.replace(".log","").replace(/-/g,"");return y.name.replace(".log","").replace(/-/g,"")-w});const v=b&&m.value[1]?m.value[1]:m.value[0];d.value=v.path;const o=await Z({path:v.path});g.value=o,h.value=!0}else D.warning(r("page.cron.viewHistory.noLatestMsg"))}catch{D.warning(r("page.cron.viewHistory.noLatestMsg"))}}async function H(a,l){if(!l.disabled)try{const b=await Z({path:l.value});g.value=b,d.value=a}catch{}}async function ee(a){const l=await Ie({path:a}),b=ne(l.children);m.value=b.slice().reverse()}function ne(a){return(v=>{v.length&&v.forEach(o=>{if(o.type===He.FILE){const s=o.name;if(s){const y=s.substring(s.lastIndexOf(".")+1),w=Be[y]||{};Object.assign(o,{value:o.path,label:s.replace(/\.log$/,""),language:"plaintext",disabled:w.icon&&w.disabled||!1})}}})})(a),a=(v=>v.filter(o=>!o.disabled))(a),a}function L(a){switch(a){case"scrollToTop":O(()=>{T.value?.scrollTo({top:0,behavior:"smooth"})});break;case"scrollToBottom":O(()=>{const l=I.value?.$el?.clientHeight;T.value?.scrollTo({top:l,behavior:"smooth"})});break;case"fullScreen":x.value=!x.value;break}}function k(){h.value=!1,g.value="",x.value=!1,d.value="",m.value=[]}return F({open:Y}),(a,l)=>{const b=Te,v=Ne,o=K,s=ge,y=de,w=me,B=Me,S=ve,$=se,le=K,N=ye,M=he,U=be,A=ie,V=re,j=we,P=xe,W=ke,q=ze,te=Ce,oe=Le,ae=Fe;return t(E)?(p(),f(ae,{key:1,show:t(h),"onUpdate:show":l[10]||(l[10]=i=>C(h)?h.value=i:null),height:"calc(var(--vh) * 100)",width:"100vw",placement:"bottom","auto-focus":!1,"mask-closable":!1,onMaskClick:k,onAfterLeave:k},{default:e(()=>[n(oe,{"header-style":"height: 60px; padding: 16px 12px","body-content-style":"padding: 4px 0 4px 8px; overscroll-behavior: none","footer-style":"padding: 16px 24px 24px 24px"},{header:e(()=>[n(P,{style:{gap:"4px"}},{default:e(()=>[n(o,{size:28,color:"var(--app-primary-color)"},{default:e(()=>[n(B,{style:{"vertical-align":"0"}})]),_:1}),n(S,{value:t(d),"onUpdate:value":l[6]||(l[6]=i=>C(d)?d.value=i:null),class:"max-w-190px w-190px ml-1",size:"small","consistent-menu-width":!1,options:t(m),"on-update:value":H},null,8,["value","options"]),t(g)?(p(),f(j,{key:0,style:{"padding-left":"8px"}},{default:e(()=>[n(U,{"show-arrow":!1,trigger:"hover",placement:"bottom"},{trigger:e(()=>[n(s,{strong:"",secondary:"",size:"small",focusable:!1},{icon:e(()=>[n(o,null,{default:e(()=>[n($,{style:{"vertical-align":"baseline"}})]),_:1})]),_:1})]),default:e(()=>[n(w,null,{default:e(()=>[n(N,{strong:""},{default:e(()=>[z(c(t(_)),1)]),_:1}),n(M,{value:t(_),"onUpdate:value":l[7]||(l[7]=i=>C(_)?_.value=i:null),style:{width:"120px"},tooltip:!1,min:12,max:24,step:1},null,8,["value"])]),_:1})]),_:1}),n(y,{"show-arrow":!1,trigger:"click",delay:500},{trigger:e(()=>[n(s,{strong:"",secondary:"",size:"small",focusable:!1,onClick:l[8]||(l[8]=i=>L("scrollToTop"))},{icon:e(()=>[n(o,{size:18},{default:e(()=>[n(A,{style:{"vertical-align":"baseline"}})]),_:1})]),_:1})]),default:e(()=>[u("span",null,c(t(r)("file.top.button")),1)]),_:1}),n(y,{"show-arrow":!1,trigger:"click",delay:500},{trigger:e(()=>[n(s,{strong:"",secondary:"",size:"small",focusable:!1,onClick:l[9]||(l[9]=i=>L("scrollToBottom"))},{icon:e(()=>[n(o,{size:18},{default:e(()=>[n(V,{style:{"vertical-align":"baseline"}})]),_:1})]),_:1})]),default:e(()=>[u("span",null,c(t(r)("file.bottom.button")),1)]),_:1})]),_:1})):G("",!0)]),_:1})]),default:e(()=>[n(q,{ref_key:"logInstWrapRef",ref:T,"native-scrollbar":!0,style:{width:"100%",height:"100%","background-color":"transparent"}},{default:e(()=>[u("div",null,[t(g)?(p(),f(W,{key:1,ref_key:"logInstRef",ref:I,log:t(g),"line-height":1.5,"font-size":t(_),language:"naive-log",style:{width:"100%",height:"100%"}},null,8,["log","font-size"])):(p(),f(N,{key:0},{default:e(()=>[z(c(t(r)("common.noData")),1)]),_:1}))])]),_:1},512)]),footer:e(()=>[n(s,{block:"",strong:"",secondary:"",type:"primary",focusable:!1,onClick:k},{default:e(()=>[z(c(t(r)("component.modal.close")),1)]),_:1})]),_:1})]),_:1},8,["show"])):(p(),f(te,{key:0,show:t(h),"onUpdate:show":l[5]||(l[5]=i=>C(h)?h.value=i:null),preset:"dialog","auto-focus":!1,style:J({width:t(x)?"calc(-20px + 100vw)":"600px"}),"on-close":k,"on-mask-click":k},{close:e(()=>[n(w,null,{default:e(()=>[n(y,{"show-arrow":!1,trigger:"hover",delay:500},{trigger:e(()=>[n(s,{size:"tiny",quaternary:"",focusable:!1,style:{padding:"4px"},onClick:l[0]||(l[0]=i=>L("fullScreen"))},{icon:e(()=>[n(o,{size:20,depth:2},{default:e(()=>[t(x)?(p(),f(v,{key:1,style:{"vertical-align":"baseline"}})):(p(),f(b,{key:0,style:{"vertical-align":"baseline"}}))]),_:1})]),_:1})]),default:e(()=>[u("span",null,c(t(x)?t(r)("layout.header.tooltipExitFull"):t(r)("layout.header.tooltipEntryFull")),1)]),_:1}),n(s,{size:"tiny",quaternary:"",focusable:!1,style:{padding:"4px"},onClick:k},{icon:e(()=>[n(o,{size:18,depth:2},{default:e(()=>l[11]||(l[11]=[u("svg",{viewBox:"0 0 12 12",version:"1.1",xmlns:"http://www.w3.org/2000/svg","aria-hidden":"true"},[u("g",{stroke:"none","stroke-width":"1",fill:"none","fill-rule":"evenodd"},[u("g",{fill:"currentColor","fill-rule":"nonzero"},[u("path",{d:"M2.08859116,2.2156945 L2.14644661,2.14644661 C2.32001296,1.97288026 2.58943736,1.95359511 2.7843055,2.08859116 L2.85355339,2.14644661 L6,5.293 L9.14644661,2.14644661 C9.34170876,1.95118446 9.65829124,1.95118446 9.85355339,2.14644661 C10.0488155,2.34170876 10.0488155,2.65829124 9.85355339,2.85355339 L6.707,6 L9.85355339,9.14644661 C10.0271197,9.32001296 10.0464049,9.58943736 9.91140884,9.7843055 L9.85355339,9.85355339 C9.67998704,10.0271197 9.41056264,10.0464049 9.2156945,9.91140884 L9.14644661,9.85355339 L6,6.707 L2.85355339,9.85355339 C2.65829124,10.0488155 2.34170876,10.0488155 2.14644661,9.85355339 C1.95118446,9.65829124 1.95118446,9.34170876 2.14644661,9.14644661 L5.293,6 L2.14644661,2.85355339 C1.97288026,2.67998704 1.95359511,2.41056264 2.08859116,2.2156945 L2.14644661,2.14644661 L2.08859116,2.2156945 Z"})])])],-1)])),_:1})]),_:1})]),_:1})]),icon:e(()=>[n(o,{size:24},{default:e(()=>[n(B,{style:{"vertical-align":"0"}})]),_:1})]),header:e(()=>[n(P,null,{default:e(()=>[z(c(t(r)("page.cron.table.history"))+" ",1),n(S,{value:t(d),"onUpdate:value":l[1]||(l[1]=i=>C(d)?d.value=i:null),class:"max-w-190px w-190px",size:"small","consistent-menu-width":!1,options:t(m),"on-update:value":H},null,8,["value","options"]),t(g)?(p(),f(j,{key:0},{default:e(()=>[n(U,{"show-arrow":!1,trigger:"hover",placement:"bottom"},{trigger:e(()=>[n(s,{strong:"",secondary:"",size:"small",focusable:!1},{icon:e(()=>[n(le,null,{default:e(()=>[n($,{style:{"vertical-align":"baseline"}})]),_:1})]),_:1})]),default:e(()=>[n(w,null,{default:e(()=>[n(N,{strong:""},{default:e(()=>[z(c(t(_)),1)]),_:1}),n(M,{value:t(_),"onUpdate:value":l[2]||(l[2]=i=>C(_)?_.value=i:null),style:{width:"120px"},tooltip:!1,min:12,max:24,step:1},null,8,["value"])]),_:1})]),_:1}),n(y,{"show-arrow":!1,trigger:"hover",delay:500},{trigger:e(()=>[n(s,{strong:"",secondary:"",size:"small",focusable:!1,onClick:l[3]||(l[3]=i=>L("scrollToTop"))},{icon:e(()=>[n(o,{size:18},{default:e(()=>[n(A,{style:{"vertical-align":"baseline"}})]),_:1})]),_:1})]),default:e(()=>[u("span",null,c(t(r)("file.top.button")),1)]),_:1}),n(y,{"show-arrow":!1,trigger:"hover",delay:500},{trigger:e(()=>[n(s,{strong:"",secondary:"",size:"small",focusable:!1,onClick:l[4]||(l[4]=i=>L("scrollToBottom"))},{icon:e(()=>[n(o,{size:18},{default:e(()=>[n(V,{style:{"vertical-align":"baseline"}})]),_:1})]),_:1})]),default:e(()=>[u("span",null,c(t(r)("file.bottom.button")),1)]),_:1})]),_:1})):G("",!0)]),_:1})]),default:e(()=>[n(q,{ref_key:"logInstWrapRef",ref:T,"native-scrollbar":!1,style:J({paddingTop:"1em",width:"100%",backgroundColor:"transparent",height:t(x)?"calc(-120px + 100vh)":"600px"})},{default:e(()=>[u("div",null,[t(g)?(p(),f(W,{key:1,ref_key:"logInstRef",ref:I,log:t(g),"line-height":1.5,"font-size":t(_),language:"naive-log",style:{width:"100%",height:"100%"}},null,8,["log","font-size"])):(p(),f(N,{key:0},{default:e(()=>[z(c(t(r)("common.noData")),1)]),_:1}))])]),_:1},8,["style"])]),_:1},8,["show","style"]))}}});export{Ge as _,Me as a};
