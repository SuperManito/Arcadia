import{a7 as v,aK as x,av as l,A as u,h as A,u as e,cZ as O,I as te,r as ne,G as oe,aP as se,at as ae,au as ce,aa as s,a9 as a,a8 as le,az as re,aL as f,aF as ie,aG as ue,aS as C,ap as $,bv as de,t as pe,am as L,c_ as _e,bd as me,bn as ge,c$ as he,b3 as fe,bI as ve,aU as ye,bo as be,bM as we,bN as ke}from"./vendor-CVUNLYN4.js";import{I as xe}from"./Icon-ljQHnwJa.js";import{a as K,r as Ie,c as Se,q as Re,T as k,at as Ce,d as $e}from"./index-BW0Kz9QR.js";import"./propTypes-CYyueTg3.js";const Le={style:{display:"inline-block"},viewBox:"0 0 24 24",width:"1em",height:"1em"},Me=l("g",{fill:"currentColor"},[l("path",{d:"M12 1.932l9 3.375V10c0 4.118-1.62 7.113-3.535 9.074a11.407 11.407 0 0 1-2.915 2.175c-.913.468-1.826.751-2.55.751c-.724 0-1.637-.283-2.55-.75a11.41 11.41 0 0 1-2.915-2.176C4.619 17.113 3 14.118 3 10V5.307l9-3.375zM5 6.693V10c0 3.549 1.38 6.054 2.965 7.676a9.411 9.411 0 0 0 2.397 1.793c.775.397 1.362.531 1.638.531c.276 0 .863-.134 1.638-.53a9.412 9.412 0 0 0 2.397-1.794C17.619 16.054 19 13.55 19 10V6.693l-7-2.625l-7 2.625z"}),l("path",{d:"M15.707 9.293a1 1 0 0 1 0 1.414l-4 4a1 1 0 0 1-1.414 0l-2-2a1 1 0 1 1 1.414-1.414L11 12.586l3.293-3.293a1 1 0 0 1 1.414 0z"})],-1),ze=[Me];function Ae(t,r){return v(),x("svg",Le,[...ze])}const Ue={name:"majesticons-shield-check-line",render:Ae},Te={style:{display:"inline-block"},viewBox:"0 0 1024 1024",width:"1em",height:"1em"},Fe=l("path",{fill:"currentColor",d:"M832 464h-68V240c0-70.7-57.3-128-128-128H388c-70.7 0-128 57.3-128 128v224h-68c-17.7 0-32 14.3-32 32v384c0 17.7 14.3 32 32 32h640c17.7 0 32-14.3 32-32V496c0-17.7-14.3-32-32-32M332 240c0-30.9 25.1-56 56-56h248c30.9 0 56 25.1 56 56v224H332zm460 600H232V536h560zM484 701v53c0 4.4 3.6 8 8 8h40c4.4 0 8-3.6 8-8v-53a48.01 48.01 0 1 0-56 0"},null,-1),Ve=[Fe];function Be(t,r){return v(),x("svg",Te,[...Ve])}const De={name:"ant-design-lock-outlined",render:Be},Ne={style:{display:"inline-block"},viewBox:"0 0 1024 1024",width:"1em",height:"1em"},Pe=l("path",{fill:"currentColor",d:"M858.5 763.6a374 374 0 0 0-80.6-119.5a375.6 375.6 0 0 0-119.5-80.6c-.4-.2-.8-.3-1.2-.5C719.5 518 760 444.7 760 362c0-137-111-248-248-248S264 225 264 362c0 82.7 40.5 156 102.8 201.1c-.4.2-.8.3-1.2.5c-44.8 18.9-85 46-119.5 80.6a375.6 375.6 0 0 0-80.6 119.5A371.7 371.7 0 0 0 136 901.8a8 8 0 0 0 8 8.2h60c4.4 0 7.9-3.5 8-7.8c2-77.2 33-149.5 87.8-204.3c56.7-56.7 132-87.9 212.2-87.9s155.5 31.2 212.2 87.9C779 752.7 810 825 812 902.2c.1 4.4 3.6 7.8 8 7.8h60a8 8 0 0 0 8-8.2c-1-47.8-10.9-94.3-29.5-138.2M512 534c-45.9 0-89.1-17.9-121.6-50.4S340 407.9 340 362s17.9-89.1 50.4-121.6S466.1 190 512 190s89.1 17.9 121.6 50.4S684 316.1 684 362s-17.9 89.1-50.4 121.6S557.9 534 512 534"},null,-1),He=[Pe];function Oe(t,r){return v(),x("svg",Ne,[...He])}const qe={name:"ant-design-user-outlined",render:Oe},q=""+new URL("logo-light-sub-nvN6hGWp.png",import.meta.url).href,G=""+new URL("logo-dark-sub-CawnpqyB.png",import.meta.url).href;var E=(t=>(t[t.LOGIN=0]="LOGIN",t[t.RESET_PASSWORD=1]="RESET_PASSWORD",t))(E||{});const z=u(0);function Ge(){function t(d){z.value=d}const r=A(()=>z.value);function n(){t(0)}return{setLoginState:t,getLoginState:r,handleBackLogin:n}}function Ke(t){const r=e(t);if(!r)return;const n=O(),d=O();return r.validate(p=>{p?d.trigger(p):n.trigger(p)}),{onSuccess:n.on,onError:d.on}}function Ee(){const{t}=K(),r=t("sys.login.needInputUsername"),n=t("sys.login.needInputPassword"),d=t("sys.login.needInputCaptcha"),p=M(r),y=M(n),I=M(d);return{getFormRules:A(()=>{switch(e(z)){case 1:return{username:p};default:return{captcha:I,username:p,password:y}}})}}function M(t){return[{required:!0,message:t,trigger:"change"}]}const je=t=>(we("data-v-b1b18aa3"),t=t(),ke(),t),We=["src"],Ze={class:"inline-container"},Je={class:"left-content"},Qe=je(()=>l("div",{style:{flex:"0 0 8px"}},null,-1)),Xe={class:"right-content"},Ye={class:"flex flex-col items-end gap-6"},et=te({__name:"LoginForm",setup(t){const{apiUrl:r=""}=Ie(),{t:n}=K(),{notification:d,dialog:p,message:y}=Se(),I=Re(),{getLoginState:U}=Ge(),{getFormRules:j}=Ee(),W=A(()=>e(U)===E.LOGIN),T=u(),_=u(!1),S=u(!0),b=u(!1),F=u(),c=ne({username:"",password:"",captcha:""}),w=u(document.querySelector('meta[name="theme-mode"]').content),V=u(w.value===k.DARK?G:q),B=u(w.value===k.DARK?"#ffffff14":"#f2f3f5");new MutationObserver(i=>{for(const o of i)o.type==="attributes"&&o.attributeName==="content"&&(w.value=o.target.content)}).observe(document.querySelector('meta[name="theme-mode"]'),{attributes:!0}),oe(w,i=>{V.value=i===k.DARK?G:q,B.value=i===k.DARK?"#ffffff14":"#f2f3f5"}),se(async()=>{await D()});async function D(){const i=await Ce();b.value=i.showCaptcha,b.value&&N()}function N(){F.value=`${r}/captcha?w=120&h=48&background=transparent&t=${new Date().getTime()}`}async function P(){if(!c.username||!c.password){y.error(n("sys.login.needInputAuthentication"),{keepAliveOnHover:!0});return}else if(b.value&&!c.captcha){y.error(n("sys.login.needInputVerification"),{keepAliveOnHover:!0});return}const{onSuccess:i}=Ke(T);i(async()=>{try{_.value=!0;const o=await I.login(pe({username:c.username,password:c.password,captcha:c.captcha,mode:"none"}));if(o){const{lastLoginInfo:m}=o;m&&m.loginTime&&setTimeout(()=>{const h=d?.create({title:n("sys.login.lastLoginInfoTitle"),content:`${n("sys.login.lastLoginInfoIp")}${m.loginIp||"Unknown"}
${n("sys.login.lastLoginInfoAddress")}${m.loginAddress||"Unknown"}`,meta:m.loginTime||"Unknown",duration:void 0,closable:!1,avatar:()=>L(_e,{size:"small",style:"background-color: transparent;"},{default:()=>L(xe,{icon:"mdi:shield-alert-outline",color:"var(--app-primary-color)",style:"vertical-align: baseline"},{})}),action:()=>L($,{quaternary:!0,type:"primary",size:"small",focusable:!1,onClick:()=>{h.destroy()}},{default:()=>n("sys.login.lastLoginInfoRead")})})},1300)}}catch(o){p?.error({title:n("sys.login.failTitle"),content:o.message||n("sys.api.networkExceptionMsg"),autoFocus:!1}),await D()}finally{_.value=!1}})}return(i,o)=>{const m=qe,h=me,R=ge,Z=De,J=Ue,Q=he,H=fe,X=ve,Y=ye,ee=be;return ae((v(),x("div",null,[l("img",{src:e(V),draggable:!1,title:"Logo",style:{width:"40%",margin:"10px auto","-webkit-user-select":"none","user-select":"none"}},null,8,We),s(ee,{ref_key:"formRef",ref:T,class:"p-6",model:e(c),rules:e(j),"show-label":!1,"label-placement":"left","show-require-mark":!0,onKeypress:de(P,["enter"])},{default:a(()=>[s(R,{label:"username",path:"username"},{default:a(()=>[s(h,{value:e(c).username,"onUpdate:value":o[0]||(o[0]=g=>e(c).username=g),size:"large",placeholder:e(n)("sys.login.accountPlaceholder"),disabled:e(_)},{prefix:a(()=>[s(m)]),_:1},8,["value","placeholder","disabled"])]),_:1}),s(R,{label:"password",path:"password"},{default:a(()=>[s(h,{value:e(c).password,"onUpdate:value":o[1]||(o[1]=g=>e(c).password=g),size:"large",type:"password","show-password-on":"click",placeholder:e(n)("sys.login.passwordPlaceholder"),disabled:e(_)},{prefix:a(()=>[s(Z)]),_:1},8,["value","placeholder","disabled"])]),_:1}),l("div",Ze,[e(b)?(v(),le(R,{key:0,label:"captcha",path:"captcha",style:{width:"100%"}},{default:a(()=>[l("div",Je,[s(h,{value:e(c).captcha,"onUpdate:value":o[2]||(o[2]=g=>e(c).captcha=g),size:"large",maxlength:"5",type:"text",disabled:e(_),placeholder:e(n)("sys.login.captchaPlaceholder")},{prefix:a(()=>[s(J)]),_:1},8,["value","disabled","placeholder"])]),Qe,l("div",Xe,[s(H,{trigger:"hover"},{trigger:a(()=>[s(Q,{src:e(F),"preview-disabled":"",style:re({backgroundColor:e(B),height:"40px",borderRadius:"3px",cursor:"pointer"}),onClick:N},null,8,["src","style"])]),default:a(()=>[l("span",null,f(e(n)("sys.login.captchaTips")),1)]),_:1})])]),_:1})):ie("",!0)]),l("div",Ye,[s(Y,{justify:"space-between",style:{width:"100%"}},{default:a(()=>[s(X,{checked:e(S),"onUpdate:checked":o[3]||(o[3]=g=>ue(S)?S.value=g:null),size:"small",disabled:e(_)},{default:a(()=>[C(f(e(n)("sys.login.rememberMe")),1)]),_:1},8,["checked","disabled"]),s(H,{placement:"left",trigger:"hover",style:{"max-width":"200px"}},{trigger:a(()=>[s(e($),{tag:"a",text:"",focusable:!1,size:"small"},{default:a(()=>[C(f(e(n)("sys.login.forgetPassword")),1)]),_:1})]),default:a(()=>[l("span",null,f(e(n)("sys.login.forgetPasswordTips")),1)]),_:1})]),_:1}),s(e($),{type:"primary",size:"large",block:"",focusable:!1,style:{"border-radius":"5px"},loading:e(_),disabled:e(_),onClick:P},{default:a(()=>[C(f(e(n)("sys.login.loginButton")),1)]),_:1},8,["loading","disabled"])])]),_:1},8,["model","rules"])],512)),[[ce,e(W)]])}}}),ct=$e(et,[["__scopeId","data-v-b1b18aa3"]]);export{ct as default};
