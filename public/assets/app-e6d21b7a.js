import{_ as Pe}from"./app-dc510135.js";import{_ as qe,B as Ue,a as je}from"./app-f6c9c850.js";import{_ as Ke}from"./app-53e95917.js";import{_ as Ve}from"./app-1ce042f8.js";import{G as ke,J as Ge,y as d,h as pe,aM as Ee,B as We,a3 as m,aC as J,al as Je,F as n,bh as Qe,bi as Ye,ap as i,b5 as P,bj as Xe,bk as Ze,bl as de,a4 as h,a5 as l,a6 as c,aF as R,aj as et,aO as tt,aE as ge,ak as at,ai as nt,aP as k,aD as C,ah as W,am as be,bm as me,af as ot,ag as lt,a_ as it,aY as st,aw as rt,bn as ct,bo as ut,ba as pt,bp as dt,aH as gt,aQ as bt,b1 as mt,b7 as ft,aI as yt,bq as _t}from"./vendor-d56b0496.js";import vt from"./app-32da6ac6.js";import{_ as ht}from"./app-4383c4dd.js";import{_ as kt}from"./app-5a3fd447.js";import{r as fe,t as ye,s as Ct,e as _e,d as ve,g as Tt,a as xt}from"./app-3c7ac208.js";import{I as u}from"./app-f86637c3.js";import{t as zt,D as St,g as Dt}from"./app-1e1d021d.js";import{a as At,f as wt,T as he,b as Mt,d as Ot,e as Bt}from"./app-d0ea65e6.js";import{p as T}from"./app-75cf128a.js";import{u as Rt}from"./app-3da0bfa2.js";import{u as Nt}from"./app-343881cd.js";import{u as $t}from"./app-cb007e5b.js";import{u as It}from"./app-0163ddbf.js";import"./app-3427e114.js";import"./app-bef774e2.js";import"./app-935e368a.js";import"./app-bac6581e.js";import"./app-e3f07554.js";import"./app-dd5767c3.js";import"./app-651c98d4.js";import"./app-b7ab00eb.js";import"./app-477705b9.js";import"./app-58940cda.js";import"./app-702551de.js";import"./app-c1db4c8f.js";import"./vendor-2a285eec.js";const Ft=["innerHTML"],Lt=ke({__name:"InlineCode",props:{code:T.string.def(""),language:T.oneOf(zt).def("shell"),highlighter:T.oneOfType([T.object,T.string]).def(void 0),background:T.string.def("transparent"),size:T.oneOfType([T.number,T.string]).def(14)},setup(Q){const s=Q,{code:a,language:S,highlighter:N,background:f,size:D}=Ge(s),{getIsDarkMode:q}=At(),$=wt().getProjectConfig;let p=null;const A=d(""),w=pe(()=>{const r=q.value?he.DARK:he.LIGHT;return $?.editorSetting.theme[r]||St[r]}),I=pe(()=>{let r=D.value;return typeof r=="number"&&(r=`${r}px`),r||(r="14px"),r});function M(r,z){const x=p?.codeToHtml(r.trim(),z),v=document.createElement("div");v.innerHTML=x;const O=v.querySelector("pre");return O?O.innerHTML:x}return Ee(async()=>{p=N.value,p||(p=await Dt()),A.value=M(a.value,{lang:S.value,theme:w.value}),We([a,w],([r,z])=>{A.value=M(r,{lang:S.value,theme:z})})}),(r,z)=>(m(),J("span",{style:Je({fontSize:n(I),background:n(f)}),innerHTML:n(A)},null,12,Ft))}}),Ht={key:3},Pt={class:"table-toolbar-right-icon"},qt={style:{color:"var(--app-primary-color)"}},Ut=ke({__name:"index",setup(Q){const{getIsMobile:s}=Rt(),{t:a}=Mt(),{getLocale:S}=It(),N=S.value==="zh_CN"?Qe:Ye,{message:f,confirm:D}=Ot(),{runLog:q}=Nt(),$=d("fade-slide");$t($);const p=d("system"),A=d([{type:"system",name:a("page.cron.type.system")},{type:"user",name:a("page.cron.type.user")}]),w=d(),I=d([]),M=d([]),r=d([]),z=d(!1),x=d(!1),v=d(""),O=d(),F=d(""),L=d(""),U=d(),Y=d(),X=d(),Ce=d([{label:()=>a("page.cron.table.action.enable.button"),key:"enable",icon:()=>i(u,{icon:"mdi:timer-check-outline",style:"vertical-align: baseline"},{}),props:{onClick:()=>{ie(!0)}}},{label:a("page.cron.table.action.disable.button"),key:"disable",icon:()=>i(u,{icon:"mdi:alarm-off",style:"vertical-align: baseline"},{}),props:{onClick:()=>{ie(!1)}}},{label:()=>a("page.cron.table.action.run.button"),key:"run",icon:()=>i(u,{icon:"tabler:clock-play",style:"vertical-align: baseline"},{}),props:{onClick:()=>{le(!0)}}},{label:()=>a("page.cron.table.action.terminate.button"),key:"terminate",icon:()=>i(u,{icon:"tabler:clock-stop",style:"vertical-align: baseline"},{}),props:{onClick:()=>{le(!1)}}},{label:()=>i(P,{style:{color:"var(--app-error-color)"}},{default:()=>a("page.cron.table.action.delete.button")}),key:"delete",icon:()=>i(u,{icon:"fe:trash",color:"var(--app-error-color)",style:"vertical-align: baseline"},{}),props:{onClick:()=>{we()}}}]),Z=d([]),Te=[{type:"selection",key:"selection",width:"3%"},{title:a("page.cron.table.title.name"),key:"name",width:s.value?180:"10%",renderFilterIcon:()=>i(u,{icon:"ic:round-filter-list",style:"vertical-align: baseline"},{}),defaultFilterOptionValues:[],filterOptions:Z,filter(){}},{title:a("page.cron.table.title.cron"),key:"cron",width:s.value?140:"8%",resizable:!0},{title:a("page.cron.table.title.shell"),key:"shell",width:s.value?360:"20%",resizable:!0,ellipsis:{tooltip:{trigger:s.value?"click":"hover",style:{backgroundColor:"var(--app-popup-background)",padding:"8px 14px"},contentStyle:{maxWidth:s.value?"300px":"800px"},arrowStyle:{backgroundColor:"var(--app-popup-background)"},placement:s.value?"bottom":void 0}},render(e){return e.shell?i(Lt,{code:String(e.shell||""),language:"shell"}):a("page.cron.table.none")}},{title:a("page.cron.table.title.remark"),key:"remark",width:s.value?void 0:"8%",resizable:!0},{title:a("page.cron.table.title.create_time"),key:"create_time",align:"center",width:s.value?void 0:"10%",sorter:!0,defaultSortOrder:!1},{title:a("page.cron.table.title.last_runtime"),key:"last_runtime",align:"center",width:s.value?void 0:"10%",render(e){return e.last_runtime?Date.now()-new Date(e.last_runtime).getTime()<1e3*60*60?Xe(new Date(e.last_runtime),{addSuffix:!0,locale:N}):e.last_runtime:a("page.cron.table.last_runtime.never")},sorter:!0,defaultSortOrder:!1},{title:a("page.cron.table.title.last_run_use"),key:"last_run_use",align:"right",titleAlign:"right",width:s.value?void 0:"7%",render(e){if(e.last_run_use===0)return a("page.cron.table.lessOneSecond");if(e.last_run_use===null)return a("page.cron.table.none");const t=Math.ceil(Number(e.last_run_use)),o=Math.floor(t/86400),b=Math.floor((t-o*86400)/3600),y=Math.floor((t-o*86400-b*3600)/60),G=t-o*86400-b*3600-y*60;return Ze({days:o,hours:b,minutes:y,seconds:G},{locale:N})},sorter:!0,defaultSortOrder:!1},{title:a("page.cron.table.title.is_running"),key:"is_running",align:"center",width:s.value?void 0:"7%",render(e){return i(de,{type:e.is_running?"success":"default",round:e.is_running},{default:()=>e.is_running?a("page.cron.table.status.running"):a("page.cron.table.status.idle"),icon:()=>i(u,{icon:e.is_running?"svg-spinners:12-dots-scale-rotate":"mdi:sleep",style:"vertical-align: baseline"},{})})}},{title:a("page.cron.table.title.active"),key:"active",align:"center",width:s.value?void 0:"6%",renderFilterIcon:()=>i(u,{icon:"ic:round-filter-list",style:"vertical-align: baseline"},{}),render(e){return i(de,{type:e.active===1?"success":"error",bordered:!1,style:S.value==="zh_CN"?"":"width: 66px; line-height: 28px; display: block; text-align: center"},{default:()=>e.active===1?a("common.active"):a("common.inactive")})},defaultFilterOptionValues:[],filterOptions:[{label:a("common.active"),value:1},{label:a("common.inactive"),value:0}],filter(){}}];function B(e,t){switch(e){case"edit":return{icon:"mdi:square-edit-outline",tooltip:a("page.cron.table.action.edit"),quaternary:!0,focusable:!1,onClick:ee.bind(null,t)};case"debug":return{icon:"mdi:bug-play-outline",tooltip:a("page.cron.table.action.debug"),quaternary:!0,focusable:!1,onClick:te.bind(null,t)};case"run":return{icon:"tabler:clock-play",iconProps:{size:18},tooltip:a("page.cron.table.action.run.button"),quaternary:!0,focusable:!1,loading:t?.is_operation===!0,onClick:ae.bind(null,t)};case"terminate":return{icon:"tabler:clock-stop",iconProps:{size:18},tooltip:a("page.cron.table.action.terminate.button"),quaternary:!0,focusable:!1,loading:t?.is_operation===!0,onClick:ne.bind(null,t)};case"history":return{icon:"mdi:history",iconProps:{size:21},tooltip:a("page.cron.table.action.history"),quaternary:!0,focusable:!1,disabled:p.value==="system"?!t.log_path:!1,onClick:oe.bind(null,t)}}}const xe={title:a("page.cron.table.title.action"),key:"action",titleAlign:s.value?"center":"left",width:s.value?68:void 0,fixed:s.value?"right":void 0,render(e){const t={edit:{label:a("page.cron.table.action.edit"),key:"edit",icon:()=>i(u,{icon:"mdi:square-edit-outline",size:18,style:"vertical-align: baseline"},{}),props:{onClick:ee.bind(null,e)}},history:{label:a("page.cron.table.action.history"),key:"history",disabled:p.value==="system"?!e.log_path:!1,icon:()=>i(u,{icon:"mdi:history",size:20,style:"vertical-align: baseline"},{}),props:{onClick:oe.bind(null,e)}},run:{label:a("page.cron.table.action.run.button"),key:"run",icon:()=>i(u,{icon:"tabler:clock-play",size:18,style:"vertical-align: baseline"},{}),props:{onClick:ae.bind(null,e)}},terminate:{label:a("page.cron.table.action.terminate.button"),key:"terminate",icon:()=>i(u,{icon:"tabler:clock-stop",size:18,style:"vertical-align: baseline"},{}),props:{onClick:ne.bind(null,e)}},debug:{label:a("page.cron.table.action.debug"),key:"debug",icon:()=>i(u,{icon:"mdi:bug-play-outline",size:20,style:"vertical-align: baseline"},{}),props:{onClick:te.bind(null,e)}},source:{label:a("page.cron.table.action.source"),key:"source",icon:()=>i(u,{icon:"tabler:code",size:18,style:"vertical-align: baseline"},{}),props:{onClick:ze.bind(null,e)}},changeStatus:{label:e.active===1?a("page.cron.table.action.disable.button"):a("page.cron.table.action.enable.button"),key:"changeStatus",icon:()=>i(u,{icon:e.active===1?"mdi:alarm-off":"mdi:timer-check-outline",size:18,style:"vertical-align: baseline"},{}),props:{onClick:De.bind(null,e)}},delete:{label:()=>i(P,{style:{color:"var(--app-error-color)"}},{default:()=>a("page.cron.table.action.delete.button")}),key:"delete",icon:()=>i(u,{icon:"fe:trash",size:18,color:"var(--app-error-color)",style:"vertical-align: baseline"},{}),props:{onClick:Ae.bind(null,e)}},sort:{label:a("page.cron.table.action.sort.title"),key:"sort",icon:()=>i(u,{icon:"mdi:sort",style:"vertical-align: baseline"},{}),children:[{label:a("page.cron.table.action.sort.moveUp"),key:"sortMoveUp",icon:()=>i(u,{icon:"material-symbols:arrow-upward-rounded",style:"vertical-align: baseline"},{}),props:{onClick:j.bind(null,e,"up")}},{label:a("page.cron.table.action.sort.moveDown"),key:"sortMoveDown",icon:()=>i(u,{icon:"material-symbols:arrow-downward-rounded",style:"vertical-align: baseline"},{}),props:{onClick:j.bind(null,e,"down")}},{label:a("page.cron.table.action.sort.moveTop"),key:"sortMoveTop",icon:()=>i(u,{icon:"material-symbols:text-select-move-up-rounded",style:"vertical-align: baseline"},{}),props:{onClick:j.bind(null,e,"top")}}]}};let o;return p.value==="system"&&e.bind?s.value?o={style:"button",actions:[],dropDownActions:[t.edit,t[e?.is_running?"terminate":"run"],t.history,t.debug,t.source,t.changeStatus,t.sort,t.delete]}:o={style:"button",actions:[B("edit",e),B(e?.is_running?"terminate":"run",e),B("history",e)],dropDownActions:[t.debug,t.source,t.changeStatus,t.sort,t.delete]}:s.value?(o={style:"button",actions:[],dropDownActions:[t.edit,t[e?.is_running?"terminate":"run"]]},e.config&&(e.config.log_directory&&o.dropDownActions.push(t.history),e.config.source_file&&o.dropDownActions.push(t.source)),o.dropDownActions=[...o.dropDownActions,t.debug,t.changeStatus,t.sort,t.delete]):(o={style:"button",actions:[B("edit",e),B(e?.is_running?"terminate":"run",e)],dropDownActions:[]},e.config&&(e.config.log_directory&&o.dropDownActions.push(t.history),e.config.source_file&&o.dropDownActions.push(t.source)),o.dropDownActions=[...o.dropDownActions,t.debug,t.changeStatus,t.sort,t.delete]),i(qe,o)}};async function ee(e){U.value?.open(e)}async function te(e){q.value?.open({title:`${e.name}`,cmd:e.shell})}async function ae(e){e.is_operation=!0;try{await fe({id:e.id})}catch{f.error(a("page.cron.table.action.run.errorMsg"))}finally{e.is_operation=!1,_()}}async function ne(e){e.is_operation=!0;const t=f.loading(a("page.cron.table.action.terminate.loadingMsg"),{duration:0});try{await ye({id:e.id}),t.type="success",t.content=a("page.cron.table.action.terminate.successMsg")}catch{t.type="error",t.content=a("page.cron.table.action.terminate.errorMsg")}finally{e.is_operation=!1,_(),setTimeout(()=>{t.destroy()},1e3)}}async function oe(e){Y.value?.open(e)}async function ze(e){X.value?.open(e)}async function j(e,t){const{id:o,sort:b}=e;try{let y;switch(t){case"up":y={id:o,order:b+1};break;case"down":y={id:o,order:b-1};break;case"top":y={id:o,moveToEnd:!0};break;default:return}await Ct(y),f.success(a("page.cron.table.message.sort.ok")),_()}catch{}}async function Se(){const e=await xt();Z.value=e.filter(t=>t.bind).map(t=>({value:t.bind,label:t.bind}))}async function De(e){try{await _e([{id:e.id,active:e.active===0?1:0}]),f.success(e.active===1?a("page.cron.table.message.disable.ok"):a("page.cron.table.message.enable.ok"),{duration:1500}),e.active=e.active===0?1:0}catch{f.error(e.active===1?a("page.cron.table.message.disable.fail"):a("page.cron.table.message.enable.fail"))}}function Ae(e){D.error({title:a("page.cron.table.action.delete.title"),content:a("page.cron.table.action.delete.confirm"),icon:()=>i(u,{icon:"fe:trash",style:"vertical-align: baseline"},{}),closable:!1,maskClosable:!1,autoFocus:!1,positiveText:a("page.cron.table.action.delete.button"),onPositiveClick:async()=>{try{await ve({id:e.id}),f.success(a("page.cron.table.message.delete.ok"))}catch{f.error(a("page.cron.table.message.delete.fail"))}finally{_()}},negativeButtonProps:{ghost:!1,tertiary:!0}})}async function le(e){try{const t={id:r.value.map(o=>Number(o))};e?await fe(t):await ye(t)}catch{}finally{_()}}function ie(e){D.info({title:a(`page.cron.table.action.${e?"enable":"disable"}.batchTitle`),content:a(`page.cron.table.action.${e?"enable":"disable"}.batchConfirm`),icon:()=>i(u,{icon:e?"mdi:timer-check-outline":"mdi:alarm-off",size:24,style:"vertical-align: baseline"},{}),closable:!1,maskClosable:!1,autoFocus:!1,onPositiveClick:async()=>{try{await _e(r.value.map(t=>({id:Number(t),active:e?1:0}))),f.success(a(`page.cron.table.message.${e?"enable":"disable"}.ok`))}catch{f.error(a(`page.cron.table.message.${e?"enable":"disable"}.fail`))}finally{_()}},negativeButtonProps:{ghost:!1,tertiary:!0}})}function we(){D.error({title:a("page.cron.table.action.delete.batchTitle"),content:a("page.cron.table.action.delete.batchConfirm"),icon:()=>i(u,{icon:"fe:trash",size:24,style:"vertical-align: baseline"},{}),closable:!1,maskClosable:!1,autoFocus:!1,onPositiveClick:async()=>{try{await ve({id:r.value.map(e=>Number(e))}),f.success(a("page.cron.table.message.delete.ok"))}catch{f.error(a("page.cron.table.message.delete.fail"))}finally{_()}},negativeButtonProps:{ghost:!1,tertiary:!0}})}function _(){setTimeout(()=>{w.value?.reload()},250),r.value=[]}function K(){x.value=!0,_(),x.value=!1}function H(){v.value="",_()}function Me(e){I.value=e.active,M.value=e.name}async function Oe(e){switch(e.order){case"ascend":F.value=e.columnKey,L.value="0";break;case"descend":F.value=e.columnKey,L.value="1";break;case!1:F.value="",L.value="";break}_()}async function Be(e){const t=p.value==="system";t&&await Se();const o=await Tt({page:e.page,size:e.size,type:p.value,search:v.value||"",active:I.value.join(","),tags:t?M.value.join(","):"",orderBy:F.value,order:L.value});return o.data=o.data.map(b=>{if(b.config)try{b.config=JSON.parse(b.config)}catch{b.config=""}return b}),o}async function V(e){switch(e){case"createTask":p.value!=="user"&&(p.value="user",_()),U.value?.open({type:p.value});break;case"showSearchBar":z.value=!0,it().then(()=>{O.value?.focus()});break}}return(e,t)=>{const o=_t,b=st,y=rt,G=Ve,se=ct,Re=ut,E=Ke,re=pt,Ne=dt,ce=gt,ue=je,$e=bt,Ie=mt,Fe=ft,Le=yt,He=Pe;return m(),h(He,{"content-full":"","no-header":""},{default:l(()=>[c(Le,{bordered:!n(s),style:{height:"100%"},"header-style":n(s)?{padding:"0 10px"}:{},"content-style":{padding:n(s)?"10px":"12px 18px"}},{header:l(()=>[n(s)?(m(),h(b,{key:0,value:n(p),"onUpdate:value":[t[0]||(t[0]=g=>R(p)?p.value=g:null),H],type:"segment",size:"small",animated:""},{default:l(()=>[(m(!0),J(tt,null,et(n(A),g=>(m(),h(o,{key:g.type,name:g.type},{default:l(()=>[k(C(g.name),1)]),_:2},1032,["name"]))),128))]),_:1},8,["value"])):ge("",!0)]),default:l(()=>[c(n(Ue),{ref_key:"tableRef",ref:w,"checked-row-keys":n(r),"onUpdate:checkedRowKeys":t[7]||(t[7]=g=>R(r)?r.value=g:null),"table-id":"CRON",class:at({"not-system-table":n(p)!=="system"}),"pagination-behavior-on-filter":"first",columns:Te,"default-hide-keys":["create_time"],request:Be,"row-key":g=>`${g.id}`,"action-column":xe,"onUpdate:filters":Me,"onUpdate:sorter":Oe},nt({tableTitle:l(()=>[c(ce,{wrap:!1},{default:l(()=>[n(s)?(m(),h(y,{key:1,secondary:"",type:"primary",size:"small",style:{padding:"0 6px"},focusable:!1,onClick:t[2]||(t[2]=g=>V("createTask"))},{icon:l(()=>[c(G)]),_:1})):(m(),h(y,{key:0,type:"primary",size:"small",style:{height:"32px"},focusable:!1,onClick:t[1]||(t[1]=g=>V("createTask"))},{default:l(()=>[k(C(n(a)("page.cron.table.new")),1)]),_:1})),n(s)?ge("",!0):(m(),h(Re,{key:2,value:n(p),"onUpdate:value":t[3]||(t[3]=g=>R(p)?p.value=g:null),variant:"default-filled",class:"t-radio-group","on-change":H},{default:l(()=>[c(se,{value:"system"},{default:l(()=>[k(C(n(a)("page.cron.type.system")),1)]),_:1}),c(se,{value:"user"},{default:l(()=>[k(C(n(a)("page.cron.type.user")),1)]),_:1})]),_:1},8,["value"])),n(s)?(m(),h(re,{key:4,value:n(v),"onUpdate:value":t[6]||(t[6]=g=>R(v)?v.value=g:null),loading:n(x)||void 0,size:"small",clearable:"",placeholder:n(a)("page.cron.table.search.placeholder"),"on-clear":H,onKeyup:me(K,["enter"])},{prefix:l(()=>[c(E)]),_:1},8,["value","loading","placeholder"])):(m(),J("div",Ht,[n(z)?(m(),h(be,{key:1,name:n($),mode:"default",appear:""},{default:l(()=>[c(Ne,{style:{height:"32px"}},{default:l(()=>[c(re,{ref_key:"searchBarInputRef",ref:O,value:n(v),"onUpdate:value":t[5]||(t[5]=g=>R(v)?v.value=g:null),disabled:n(x),loading:n(x)||void 0,size:"small",clearable:"",placeholder:n(a)("page.cron.table.search.placeholder"),"on-clear":H,onKeyup:me(K,["enter"])},{prefix:l(()=>[c(E)]),_:1},8,["value","disabled","loading","placeholder"]),c(y,{strong:"",secondary:"",type:"primary",size:"small",style:{height:"32px"},onClick:K},{default:l(()=>[k(C(n(a)("common.searchText")),1)]),_:1})]),_:1})]),_:1},8,["name"])):(m(),h(y,{key:0,strong:"",secondary:"",size:"small",style:{padding:"0 8px",height:"32px"},focusable:!1,onClick:t[4]||(t[4]=g=>V("showSearchBar"))},{icon:l(()=>[c(E)]),_:1}))]))]),_:1})]),toolbar:l(()=>[ot(c(be,{name:"fade-slide-left",mode:"out-in",appear:""},{default:l(()=>[c(ce,{wrap:!1},{default:l(()=>[c(Fe,{size:"small",trigger:"click",options:n(Ce)},{default:l(()=>[n(s)?(m(),h(Ie,{key:1,trigger:"hover"},{trigger:l(()=>[W("div",Pt,[c($e,{size:"20"},{default:l(()=>[c(ue)]),_:1})])]),default:l(()=>[W("span",null,C(n(a)("page.cron.table.action.batchAction")),1)]),_:1})):(m(),h(y,{key:0,strong:"",secondary:"",size:"small",type:"primary",style:{padding:"0 8px"},focusable:!1},{icon:l(()=>[c(ue)]),default:l(()=>[k(" "+C(n(a)("page.cron.table.action.batchAction")),1)]),_:1}))]),_:1},8,["options"])]),_:1})]),_:1},512),[[lt,n(r).length]])]),_:2},[n(r).length&&!n(s)?{name:"info",fn:l(()=>[c(n(P),null,{default:l(()=>[k(C(n(a)("common.selected")),1)]),_:1}),t[8]||(t[8]=k("  ")),W("span",qt,C(n(r).length),1),t[9]||(t[9]=k("  ")),c(n(P),null,{default:l(()=>[k(C(n(a)("common.item")),1)]),_:1})]),key:"0"}:void 0]),1032,["checked-row-keys","class","row-key"])]),_:1},8,["bordered","header-style","content-style"]),c(vt,{ref_key:"editTask",ref:U,onOk:_},null,512),c(ht,{ref_key:"viewHistory",ref:Y},null,512),c(kt,{ref_key:"viewSourceFile",ref:X},null,512)]),_:1})}}}),va=Bt(Ut,[["__scopeId","data-v-b75f83c1"]]);export{va as default};
