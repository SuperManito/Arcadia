import{_ as we}from"./PageWrapper.vue_vue_type_style_index_0_lang-DleleeUi.js";import{_ as Se,B as ze,a as Te}from"./TableAction.vue_vue_type_script_setup_true_lang-DOnW1aZm.js";import{_ as Ae}from"./search2-line-C7V4Mle5.js";import{_ as Ie}from"./plus-B-AkAw1V.js";import{I as De,bp as Be,bq as Ne,A as d,am as s,b7 as T,ap as w,bu as ee,n as V,aE as q,bs as $e,b8 as Ee,a7 as m,a8 as g,a9 as o,aa as i,u as t,aG as A,aK as ae,ax as Oe,aR as Fe,aF as te,aw as Re,aS as _,aL as h,av as K,aA as ne,bv as le,at as Le,au as Ue,B as Ve,a_ as qe,bw as Ke,bx as Pe,bd as Ge,by as Me,aT as je,b3 as He,ba as We,aM as Je,bz as Qe}from"./vendor-CsvKI2kS.js";import{I as c}from"./Icon-w75mFLja.js";import{a as Xe,c as Ye}from"./index-hO6mdrNR.js";import{u as Ze}from"./useAppInject-BoZf51bk.js";import{u as ea}from"./useLocale-CiQ9eAn6.js";import{u as aa}from"./useTransition-66F1_su1.js";import{_ as ta}from"./editEnv.vue_vue_type_script_setup_true_lang-CUCGjp99.js";import na from"./manageValue-DzTecS8y.js";import{d as oe,a as se,s as la,b as oa,c as sa,e as ia,f as ra,g as ca,h as pa,i as ua}from"./env-B-vNm9vX.js";import"./sharp-arrow-back-ios-DPZSNare.js";import"./useDesign-7pXfWKnw.js";import"./clickOutside-DGRBMUUq.js";import"./download-simple-bold-CrGQmHNY.js";import"./question-circle-outlined-BBN51sNn.js";import"./propTypes-C3nnPquf.js";import"./more-horiz-pnQhQE51.js";import"./importEnv.vue_vue_type_script_setup_true_lang-AMgpSIA0.js";import"./fullscreen-CDp7Z4mn.js";const da={key:3},ba={class:"table-toolbar-right-icon"},ma={style:{color:"var(--app-primary-color)"}},La=De({__name:"index",setup(va){const{getIsMobile:b}=Ze(),{t:a}=Xe(),{getLocale:P}=ea(),ie=P.value==="zh_CN"?Be:Ne,{message:v,confirm:E}=Ye(),G=d("fade-slide");aa(G);const p=d("ordinary"),re=d([{type:"ordinary",name:a("page.env.type.ordinary")},{type:"composite",name:a("page.env.type.composite")}]),M=d([]),j=d(),f=d([]),H=d(!1),S=d(!1),W=d(),O=d(),I=d(),ce=d([{label:()=>s(T,{style:{color:"var(--app-info-color)"}},{default:()=>a("page.env.table.action.enable.button")}),key:"enable",icon:()=>s(c,{icon:"tabler:variable",color:"var(--app-info-color)",style:"vertical-align: baseline"},{}),props:{onClick:()=>{X(!0)}}},{label:a("page.env.table.action.disable.button"),key:"disable",icon:()=>s(c,{icon:"tabler:variable-off",style:"vertical-align: baseline"},{}),props:{onClick:()=>{X(!1)}}},{label:()=>s(T,{style:{color:"var(--app-error-color)"}},{default:()=>a("page.env.table.action.delete.button")}),key:"delete",icon:()=>s(c,{icon:"fe:trash",color:"var(--app-error-color)",style:"vertical-align: baseline"},{}),props:{onClick:()=>{me()}}}]),pe=[{type:"selection",key:"selection",width:54},{title:a("page.env.table.title.type"),key:"type",resizable:!0,width:280,render(e){return e.type?s("span",{style:{fontFamily:"var(--app-font-family-mono)"}},e.type):""}},{title:a("page.env.table.title.value"),key:"value",resizable:!0,render(e){if(e.envs===void 0)return e.value?s("span",{style:{fontFamily:"var(--app-font-family-mono)"}},e.value):"";const n=e.envs;return s(w,{strong:!0,secondary:!0,size:"small",focusable:!0,onClick:()=>I.value?.open(e)},{default:()=>a("page.env.table.manageItems",[n])})}},{title:a("page.env.table.title.tag_list"),key:"tag_list",resizable:!0,width:200,render(e){try{const n=e.tag_list;if(!n)return"";const l=JSON.parse(n||"['']");if(!Array.isArray(l))return"";const u=[];if(l.forEach(x=>{const{label:y,color:z}=x;u.push(s(ee,{bordered:!1,color:{color:V(z).setAlpha(.12).toHex8String(),borderColor:V(z).toHexString(),textColor:V(z).toHexString()}},{default:()=>y}))}),u.length>0)return s(q,{style:"gap: 4px"},{default:()=>u})}catch{}return""}},{title:a("page.env.table.title.description"),key:"description",resizable:!0,width:200},{title:a("page.env.table.title.update_time"),key:"update_time",align:"center",width:170,render(e){return e.update_time?Date.now()-new Date(e.update_time).getTime()<1e3*60*60?$e(new Date(e.update_time),{addSuffix:!0,locale:ie}):e.update_time:a("page.env.table.update_time.never")},sorter:!0,defaultSortOrder:!1},{title:a("page.env.table.title.enable"),key:"enable",align:"center",width:120,fixed:b.value?void 0:"right",renderFilterIcon:()=>s(c,{icon:"ic:round-filter-list",style:"vertical-align: baseline"},{}),render(e){return s(ee,{type:e.enable===1?"success":"error",bordered:!1,style:P.value==="zh_CN"?"":"width: 66px; line-height: 28px; display: block; text-align: center"},{default:()=>e.enable===1?a("common.active"):a("common.inactive")})},defaultFilterOptionValues:[],filterOptions:[{label:a("common.active"),value:1},{label:a("common.inactive"),value:0}],filter(){}}],D=(e,n)=>{switch(e){case"edit":return{icon:"mdi-square-edit-outline",tooltip:a("page.env.table.action.edit"),quaternary:!0,focusable:!1,onClick:J.bind(null,n)};case"changeStatus":return{icon:n.enable===1?"tabler-variable-off":"tabler-variable",tooltip:n.enable===1?a("page.env.table.action.disable.button"):a("page.env.table.action.enable.button"),quaternary:!0,focusable:!1,onClick:Q.bind(null,n)};case"manage":return{icon:"mdi-database-cog-outline",tooltip:a("page.env.table.action.manage"),quaternary:!0,focusable:!1,onClick:()=>I.value?.open(n)}}},ue={title:a("page.env.table.title.action"),key:"action",titleAlign:b.value?"center":"left",width:b.value?68:140,fixed:"right",render(e){const n=p.value==="composite",l={edit:{label:a("page.env.table.action.edit"),key:"edit",icon:()=>s(c,{icon:"mdi:square-edit-outline",style:"vertical-align: baseline"},{}),props:{onClick:J.bind(null,e)}},delete:{label:()=>s(T,{style:{color:"var(--app-error-color)"}},{default:()=>a("page.env.table.action.delete.button")}),key:"delete",icon:()=>s(c,{icon:"fe:trash",color:"var(--app-error-color)",style:"vertical-align: baseline"},{}),props:{onClick:de.bind(null,e)}},changeStatus:{label:e.enable===1?a("page.env.table.action.disable.button"):a("page.env.table.action.enable.button"),key:"changeStatus",icon:()=>s(c,{icon:e.enable===1?"tabler:variable-off":"tabler:variable",style:"vertical-align: baseline"},{}),props:{onClick:Q.bind(null,e)}},manage:{label:a("page.env.table.action.manage"),key:"manage",icon:()=>s(c,{icon:"mdi:database-cog-outline",style:"vertical-align: baseline"},{}),props:{onClick:()=>I.value?.open(e)}},sort:{label:a("page.env.table.action.sort.title"),key:"sort",icon:()=>s(c,{icon:"mdi:sort",style:"vertical-align: baseline"},{}),children:[{label:a("page.env.table.action.sort.moveUp"),key:"sortMoveUp",icon:()=>s(c,{icon:"material-symbols:arrow-upward-rounded",style:"vertical-align: baseline"},{}),props:{onClick:F.bind(null,e,"up")}},{label:a("page.env.table.action.sort.moveDown"),key:"sortMoveDown",icon:()=>s(c,{icon:"material-symbols:arrow-downward-rounded",style:"vertical-align: baseline"},{}),props:{onClick:F.bind(null,e,"down")}},{label:a("page.env.table.action.sort.moveTop"),key:"sortMoveTop",icon:()=>s(c,{icon:"material-symbols:text-select-move-up-rounded",style:"vertical-align: baseline"},{}),props:{onClick:F.bind(null,e,"top")}}]},export:{label:a("page.env.table.action.export"),key:"export",icon:()=>s(c,{icon:"mdi:content-copy",style:"vertical-align: baseline"},{}),props:{iconProps:{size:"16"},onClick:be.bind(null,e)}}};let u;return n?b.value?u={style:"button",actions:[],dropDownActions:[l.edit,l.manage,l.changeStatus,l.sort,l.delete]}:u={style:"button",actions:[D("edit",e),D("manage",e)],dropDownActions:[l.changeStatus,l.sort,l.delete]}:b.value?u={style:"button",actions:[],dropDownActions:[l.edit,l.changeStatus,l.export,l.sort,l.delete]}:u={style:"button",actions:[D("edit",e),D("changeStatus",e)],dropDownActions:[l.export,l.sort,l.delete]},s(Se,u)}},J=async e=>{O.value?.open(p.value,e)},de=e=>{E.error({title:a("page.env.table.action.delete.title"),content:a("page.env.table.action.delete.confirm"),icon:()=>s(c,{icon:"fe:trash",style:"vertical-align: baseline"},{}),closable:!1,maskClosable:!1,autoFocus:!1,positiveText:a("page.env.table.action.delete.button"),onPositiveClick:async()=>{try{p.value==="composite"?await oe({id:e.id}):await se({id:e.id}),v.success(a("page.env.table.message.delete.ok"))}catch{v.error(a("page.env.table.message.delete.fail"))}finally{k()}},negativeButtonProps:{ghost:!1,tertiary:!0}})},Q=async e=>{try{const n=p.value==="composite",l=Object.assign({},e,{enable:e.enable===0?1:0});delete l.update_time,n?(delete l.envs,await la(l)):await oa(l),v.success(e.enable===1?a("page.env.table.message.disable.ok"):a("page.env.table.message.enable.ok"),{duration:1500}),e.enable===0?e.enable=1:e.enable=0}catch{v.error(e.enable===1?a("page.env.table.message.disable.fail"):a("page.env.table.message.enable.fail"))}},be=async e=>{Ee().copy(`export ${e.type}="${e.value}"`).then(()=>{v.success(a("common.copyOk"))}).catch(()=>{v.error(a("common.copyFail"))})},F=async(e,n)=>{const l=p.value==="composite",{id:u,sort:x}=e;try{let y;switch(n){case"up":y={id:u,order:x+1};break;case"down":y={id:u,order:x-1};break;case"top":y={id:u,moveToEnd:!0};break;default:return}l?await sa(y):await ia(y),v.success(a("page.env.table.message.sort.ok")),k()}catch{}},me=()=>{E.error({title:a("page.env.table.action.delete.batchTitle"),content:a("page.env.table.action.delete.batchConfirm"),icon:()=>s(c,{icon:"fe:trash",size:24,style:"vertical-align: baseline"},{}),closable:!1,maskClosable:!1,autoFocus:!1,onPositiveClick:async()=>{try{const e=f.value.map(l=>Number(l));p.value==="composite"?await oe({id:e}):await se({id:e}),v.success(a("page.env.table.message.delete.ok"))}catch{v.error(a("page.env.table.message.delete.fail"))}finally{k()}},negativeButtonProps:{ghost:!1,tertiary:!0}})},X=e=>{E.info({title:a(`page.env.table.action.${e?"enable":"disable"}.batchTitle`),content:a(`page.env.table.action.${e?"enable":"disable"}.batchConfirm`),icon:()=>s(c,{icon:e?"tabler:variable":"tabler:variable-off",size:24,style:"vertical-align: baseline"},{}),closable:!1,maskClosable:!1,autoFocus:!1,onPositiveClick:async()=>{try{p.value==="composite"?await ra({id:f.value.map(l=>Number(l)),enable:e?1:0}):await ca({id:f.value.map(l=>Number(l)),enable:e?1:0}),v.success(a(`page.env.table.message.${e?"enable":"disable"}.ok`))}catch{v.error(a(`page.env.table.message.${e?"enable":"disable"}.fail`))}finally{k()}},negativeButtonProps:{ghost:!1,tertiary:!0}})},k=()=>{setTimeout(()=>{j.value?.reload()},250),f.value=[]},R=()=>{S.value=!0,k(),S.value=!1},B=()=>{C.value="",k()},ve=e=>{M.value=e.enable},N=d(""),$=d(""),ge=async e=>{switch(e.order){case"ascend":N.value=e.columnKey,$.value="0";break;case"descend":N.value=e.columnKey,$.value="1";break;case!1:N.value="",$.value="";break}k()},C=d(""),fe=async e=>{const n=p.value==="composite",l={page:e.page,size:e.size,search:C.value||"",enable:M.value.join(","),orderBy:N.value,order:$.value};return n?await pa(l):await ua(l)},L=async e=>{switch(e){case"createEnv":O.value?.open(p.value);break;case"showSearchBar":H.value=!0,Ve().then(()=>{W.value?.focus()});break}};return(e,n)=>{const l=Qe,u=qe,x=Ie,y=Ke,z=Pe,U=Ae,Y=Ge,ye=Me,Z=Te,_e=je,he=He,ke=We,Ce=Je,xe=we;return m(),g(xe,{ref:"pageWrapper","content-full":"","no-header":""},{default:o(()=>[i(Ce,{id:"env-table-drawer-target",bordered:!t(b),style:{height:"100%"},"header-style":t(b)?"padding: 0 10px":"","content-style":t(b)?"padding: 10px":""},{header:o(()=>[t(b)?(m(),g(u,{key:0,value:t(p),"onUpdate:value":[n[0]||(n[0]=r=>A(p)?p.value=r:null),B],type:"segment",size:"small",animated:""},{default:o(()=>[(m(!0),ae(Fe,null,Oe(t(re),r=>(m(),g(l,{key:r.type,name:r.type},{default:o(()=>[_(h(r.name),1)]),_:2},1032,["name"]))),128))]),_:1},8,["value"])):te("",!0)]),default:o(()=>[i(t(ze),{ref_key:"tableRef",ref:j,"checked-row-keys":t(f),"onUpdate:checkedRowKeys":n[7]||(n[7]=r=>A(f)?f.value=r:null),"table-id":"ENV","pagination-behavior-on-filter":"first",columns:pe,request:fe,"row-key":r=>`${r.id}`,"action-column":ue,"onUpdate:filters":ve,"onUpdate:sorter":ge},Re({tableTitle:o(()=>[i(t(q),{wrap:!1},{default:o(()=>[t(b)?(m(),g(t(w),{key:1,secondary:"",type:"primary",size:"small",style:{padding:"0 6px"},focusable:!1,onClick:n[2]||(n[2]=r=>L("createEnv"))},{icon:o(()=>[i(x)]),_:1})):(m(),g(t(w),{key:0,type:"primary",size:"small",style:{height:"32px"},focusable:!1,onClick:n[1]||(n[1]=r=>L("createEnv"))},{default:o(()=>[_(h(t(a)("page.env.table.new")),1)]),_:1})),t(b)?te("",!0):(m(),g(z,{key:2,value:t(p),"onUpdate:value":n[3]||(n[3]=r=>A(p)?p.value=r:null),variant:"default-filled","on-change":B},{default:o(()=>[i(y,{value:"ordinary"},{default:o(()=>[_(h(t(a)("page.env.type.ordinary")),1)]),_:1}),i(y,{value:"composite"},{default:o(()=>[_(h(t(a)("page.env.type.composite")),1)]),_:1})]),_:1},8,["value"])),t(b)?(m(),g(Y,{key:4,value:t(C),"onUpdate:value":n[6]||(n[6]=r=>A(C)?C.value=r:null),loading:t(S)||void 0,size:"small",clearable:"",placeholder:t(a)("page.env.table.search.placeholder"),"on-clear":B,onKeyup:le(R,["enter"])},{prefix:o(()=>[i(U)]),_:1},8,["value","loading","placeholder"])):(m(),ae("div",da,[t(H)?(m(),g(ne,{key:1,name:t(G),mode:"default",appear:""},{default:o(()=>[i(ye,{style:{height:"32px"}},{default:o(()=>[i(Y,{ref_key:"searchBarInputRef",ref:W,value:t(C),"onUpdate:value":n[5]||(n[5]=r=>A(C)?C.value=r:null),disabled:t(S),loading:t(S)||void 0,size:"small",clearable:"",placeholder:t(a)("page.env.table.search.placeholder"),"on-clear":B,onKeyup:le(R,["enter"])},{prefix:o(()=>[i(U)]),_:1},8,["value","disabled","loading","placeholder"]),i(t(w),{strong:"",secondary:"",type:"primary",size:"small",style:{height:"32px"},onClick:R},{default:o(()=>[_(h(t(a)("common.searchText")),1)]),_:1})]),_:1})]),_:1},8,["name"])):(m(),g(t(w),{key:0,strong:"",secondary:"",size:"small",style:{padding:"0 8px",height:"32px"},focusable:!1,onClick:n[4]||(n[4]=r=>L("showSearchBar"))},{icon:o(()=>[i(U)]),_:1}))]))]),_:1})]),toolbar:o(()=>[Le(i(ne,{name:"fade-slide-left",mode:"out-in",appear:""},{default:o(()=>[i(t(q),{wrap:!1},{default:o(()=>[i(ke,{size:"small",trigger:"click",options:t(ce)},{default:o(()=>[t(b)?(m(),g(he,{key:1,trigger:"hover"},{trigger:o(()=>[K("div",ba,[i(_e,{size:"20"},{default:o(()=>[i(Z)]),_:1})])]),default:o(()=>[K("span",null,h(t(a)("page.env.table.action.batchAction")),1)]),_:1})):(m(),g(t(w),{key:0,strong:"",secondary:"",size:"small",type:"primary",style:{padding:"0 8px"},focusable:!1},{icon:o(()=>[i(Z)]),default:o(()=>[_(" "+h(t(a)("page.env.table.action.batchAction")),1)]),_:1}))]),_:1},8,["options"])]),_:1})]),_:1},512),[[Ue,t(f).length]])]),_:2},[t(f).length&&!t(b)?{name:"info",fn:o(()=>[i(t(T),null,{default:o(()=>[_(h(t(a)("common.selected")),1)]),_:1}),_("  "),K("span",ma,h(t(f).length),1),_("  "),i(t(T),null,{default:o(()=>[_(h(t(a)("common.item")),1)]),_:1})]),key:"0"}:void 0]),1032,["checked-row-keys","row-key"])]),_:1},8,["bordered","header-style","content-style"]),i(ta,{ref_key:"editEnv",ref:O,onOk:k},null,512),i(na,{ref_key:"manageValue",ref:I,onOk:k},null,512)]),_:1},512)}}});export{La as default};
