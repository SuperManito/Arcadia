import{aN as Z,a6 as c,aG as K,al as v,G as Q,r as F,J as X,at as S,F as e,a7 as f,a8 as l,a9 as o,aA as E,aH as Y,aJ as N,aI as k,ap as I,aU as ee,b6 as te,aL as ne,cM as ae,cN as le,be as se,bE as oe,c1 as ie,aM as re,bL as ue,bn as pe}from"./vendor-c495fdf6.js";import{_ as ce,a as _e}from"./app-0713c32c.js";import{k as de}from"./app-1402ce5e.js";import{I as me}from"./app-f217d8bf.js";import{u as ge}from"./app-25ce29fa.js";import{b as fe}from"./app-b60428ff.js";const ve={style:{display:"inline-block"},viewBox:"0 0 24 24",width:"1em",height:"1em"};function he(A,y){return c(),K("svg",ve,y[0]||(y[0]=[v("path",{fill:"currentColor",d:"M21 2H3c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h18c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2m0 18H3V6h18zM16.6 8c1.5 1.3 2.4 3.1 2.4 5s-.9 3.7-2.4 5l-1.6-.6c1.3-1 2-2.7 2-4.4s-.7-3.4-2-4.4zM7.4 8l1.6.6c-1.3 1-2 2.7-2 4.4s.7 3.4 2 4.4l-1.6.6C5.9 16.7 5 14.9 5 13s.9-3.7 2.4-5m4.7 4l1.4-2H15l-2.2 3l1.3 3h-1.3l-.8-2l-1.4 2H9l2.3-3.1L10 10h1.3z"},null,-1)]))}const xe=Z({name:"mdi-application-variable-outline",render:he}),Ce=Q({__name:"importEnv",emits:["ok"],setup(A,{expose:y,emit:T}){const M=T,{getIsMobile:B}=ge(),{t:s}=fe(),t=F({show:!1,showFullScreen:!1,currentStepIndex:1,currentStepStatus:"process",inputValue:"",group_id:null,result:null,submitLoading:!1,data:[]}),{show:h,showFullScreen:_,currentStepIndex:d,currentStepStatus:H,inputValue:m,result:V,submitLoading:$,data:P}=X(t),U=[{title:s("page.env.importEnv.table.index"),key:"index",align:"center",titleAlign:"center",width:88,render(n){return S(pe,{size:"small",bordered:!1,style:"font-weight: 600"},{default:()=>n.index})}},{title:s("page.env.table.title.value"),key:"value",titleAlign:"center",render(n){return S("span",{style:{fontFamily:"var(--app-font-family-mono)"}},String(n.value||""))}},{title:s("page.env.table.title.action"),key:"actions",align:"center",titleAlign:"center",fixed:"right",width:80,render(n){return S(E,{strong:!0,tertiary:!0,focusable:!1,size:"small",type:"error",style:"padding: 0 4px",onClick:()=>R(n.index)},{icon:()=>S(me,{icon:"fe:trash",style:"vertical-align: baseline"},{})})}}],w=F({page:1,pageSize:10,showSizePicker:!0,pageSizes:[5,10,20,100,200,500,1e3],onChange:n=>{w.page=n},onUpdatePageSize:n=>{w.pageSize=n,w.page=1}});async function D(){if(t.currentStepIndex===3)M("ok"),B&&(h.value=!1);else{if(t.currentStepIndex===1){t.currentStepIndex++;let n=[],a=[],b=!1;try{n=JSON.parse(m.value),Array.isArray(n)&&(b=!0,a=n.filter(r=>r.trim()!==""))}catch{n=m.value.split(`
`)}if(!b){const r=/^(?:export\s+)?\w+=('([^']*)'|"([^"]*)")/,u=/'([^']*)'|"([^"]*)"/,L=/^[^#]*/,C=/([^#]*)/;n.forEach(z=>{const i=z.trim();if(i.startsWith("#")||i.startsWith("//"))return;let p;if(r.test(i)){p=u.exec(i);const g=p[1]||p[2];a.push(g)}else if(L.test(i)){p=C.exec(i);const g=p[1].trim();g&&a.push(g)}else a.push(i)})}t.data=a.map((r,u)=>({index:u+1,value:r}))}else if(t.currentStepIndex===2){const n=t.data.map(a=>({group_id:t.group_id,type:"",value:a.value}));t.submitLoading=!0;try{await de(n),t.result=!0,t.currentStepStatus="finish"}catch{t.result=!1,t.currentStepStatus="error"}finally{t.submitLoading=!1,t.currentStepIndex++}}return!1}}function J(n){switch(n){case"fullScreen":t.showFullScreen=!t.showFullScreen;break}}function R(n){t.data=t.data.filter(a=>a.index!==n)}function q(n){t.showFullScreen=!1,t.inputValue="",t.currentStepIndex=1,t.currentStepStatus="process",t.group_id=n,t.show=!0}return y({open:q}),(n,a)=>{const b=ce,r=_e,u=ee,L=te,C=ne,z=xe,i=ae,p=le,g=se,G=oe,W=ie,j=re,O=ue;return e(B)?k("",!0):(c(),f(O,{key:0,show:e(h),"onUpdate:show":a[3]||(a[3]=x=>N(h)?h.value=x:null),preset:"dialog","auto-focus":!1,"mask-closable":!1,"positive-text":e(d)===2?e(s)("page.env.importEnv.submitButton"):e(d)===3?e(s)("page.env.importEnv.finishButton"):e(s)("page.env.importEnv.nextButton"),"positive-button-props":{disabled:e(m).trim()==="",loading:e($)},"negative-text":e(s)("common.cancelText"),"negative-button-props":{ghost:!1,tertiary:!0},style:I({width:e(_)?"calc(-20px + 100vw)":"860px"}),onPositiveClick:D},{close:l(()=>[o(C,null,{default:l(()=>[o(L,{"show-arrow":!1,trigger:"hover",delay:500},{trigger:l(()=>[o(e(E),{size:"tiny",quaternary:"",focusable:!1,style:{padding:"4px"},onClick:a[0]||(a[0]=x=>J("fullScreen"))},{icon:l(()=>[o(u,{size:20,depth:2},{default:l(()=>[e(_)?(c(),f(r,{key:1,style:{"vertical-align":"baseline"}})):(c(),f(b,{key:0,style:{"vertical-align":"baseline"}}))]),_:1})]),_:1})]),default:l(()=>[v("span",null,Y(e(_)?e(s)("layout.header.tooltipExitFull"):e(s)("layout.header.tooltipEntryFull")),1)]),_:1}),o(e(E),{size:"tiny",quaternary:"",focusable:!1,style:{padding:"4px"},onClick:a[1]||(a[1]=x=>h.value=!1)},{icon:l(()=>[o(u,{size:18,depth:2},{default:l(()=>a[4]||(a[4]=[v("svg",{viewBox:"0 0 12 12",version:"1.1",xmlns:"http://www.w3.org/2000/svg","aria-hidden":"true"},[v("g",{stroke:"none","stroke-width":"1",fill:"none","fill-rule":"evenodd"},[v("g",{fill:"currentColor","fill-rule":"nonzero"},[v("path",{d:"M2.08859116,2.2156945 L2.14644661,2.14644661 C2.32001296,1.97288026 2.58943736,1.95359511 2.7843055,2.08859116 L2.85355339,2.14644661 L6,5.293 L9.14644661,2.14644661 C9.34170876,1.95118446 9.65829124,1.95118446 9.85355339,2.14644661 C10.0488155,2.34170876 10.0488155,2.65829124 9.85355339,2.85355339 L6.707,6 L9.85355339,9.14644661 C10.0271197,9.32001296 10.0464049,9.58943736 9.91140884,9.7843055 L9.85355339,9.85355339 C9.67998704,10.0271197 9.41056264,10.0464049 9.2156945,9.91140884 L9.14644661,9.85355339 L6,6.707 L2.85355339,9.85355339 C2.65829124,10.0488155 2.34170876,10.0488155 2.14644661,9.85355339 C1.95118446,9.65829124 1.95118446,9.34170876 2.14644661,9.14644661 L5.293,6 L2.14644661,2.85355339 C1.97288026,2.67998704 1.95359511,2.41056264 2.08859116,2.2156945 L2.14644661,2.14644661 L2.08859116,2.2156945 Z"})])])],-1)])),_:1})]),_:1})]),_:1})]),icon:l(()=>[o(u,{size:28},{default:l(()=>[o(z,{style:{"vertical-align":"0"}})]),_:1})]),header:l(()=>[o(p,{size:"small",style:{"padding-left":"20px",width:"calc(100% - 60px)"},current:e(d),status:e(H)},{default:l(()=>[o(i,{title:e(s)("page.env.importEnv.step.input")},null,8,["title"]),o(i,{title:e(s)("page.env.importEnv.step.check")},null,8,["title"]),o(i,{title:e(s)("page.env.importEnv.step.submit")},null,8,["title"])]),_:1},8,["current","status"])]),default:l(()=>[o(j,{bordered:!1,style:I({paddingTop:"10px",height:e(_)?"calc(-140px + 100vh)":"600px",wordBreak:"unset"}),"content-style":"height: 100%; padding: 0"},{default:l(()=>[e(d)===1?(c(),f(g,{key:0,value:e(m),"onUpdate:value":a[2]||(a[2]=x=>N(m)?m.value=x:null),rows:25,type:"textarea",style:{"font-family":"var(--app-font-family-mono)"}},null,8,["value"])):k("",!0),e(d)===2?(c(),f(G,{key:1,columns:U,data:e(P),"max-height":e(_)?"calc(100vh - 240px)":"500px",pagination:e(w)},null,8,["columns","data","max-height","pagination"])):k("",!0),e(d)===3?(c(),f(W,{key:2,status:e(V)?"success":"error",size:"huge",style:I({paddingTop:e(_)?"30vh":"180px"}),title:e(s)(`page.env.importEnv.${e(V)?"success":"error"}`)},null,8,["status","style","title"])):k("",!0)]),_:1},8,["style"])]),_:1},8,["show","positive-text","positive-button-props","negative-text","style"]))}}});export{Ce as _};
