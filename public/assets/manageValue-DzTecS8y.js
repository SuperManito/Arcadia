import{a7 as p,aK as N,av as $,I as Re,bp as Ue,bq as Me,A as c,am as s,b7 as D,r as Ke,K as Le,bu as se,bs as Pe,b8 as je,aa as o,a9 as l,u as n,a8 as m,ap as T,aF as L,aL as v,aG as z,aw as Ge,aS as x,aE as ie,bv as re,aA as ce,at as He,au as We,aR as Je,ai as Qe,B as Xe,aT as Ye,b9 as Ze,aU as et,bd as tt,by as at,b3 as nt,ba as lt,aM as ot,bE as st,ct as it,bF as rt,a$ as ct,bj as pt}from"./vendor-CsvKI2kS.js";import{_ as ut,B as dt,a as bt}from"./TableAction.vue_vue_type_script_setup_true_lang-DOnW1aZm.js";import{_ as mt}from"./search2-line-C7V4Mle5.js";import{_ as vt}from"./plus-B-AkAw1V.js";import{I as r}from"./Icon-w75mFLja.js";import{u as _t}from"./useLocale-CiQ9eAn6.js";import{u as ft}from"./useTransition-66F1_su1.js";import{c as gt,a as yt,d as ht}from"./index-hO6mdrNR.js";import{u as kt}from"./useAppInject-BoZf51bk.js";import{_ as xt}from"./editEnv.vue_vue_type_script_setup_true_lang-CUCGjp99.js";import{_ as wt}from"./importEnv.vue_vue_type_script_setup_true_lang-AMgpSIA0.js";import{a as pe,b as Ct,e as ue,g as Tt,j as $t}from"./env-B-vNm9vX.js";import"./clickOutside-DGRBMUUq.js";import"./download-simple-bold-CrGQmHNY.js";import"./question-circle-outlined-BBN51sNn.js";import"./propTypes-C3nnPquf.js";import"./more-horiz-pnQhQE51.js";import"./fullscreen-CDp7Z4mn.js";const St={style:{display:"inline-block"},viewBox:"0 0 24 24",width:"1em",height:"1em"},zt=$("path",{fill:"currentColor",d:"m7.825 13l4.9 4.9q.3.3.288.7t-.313.7q-.3.275-.7.288t-.7-.288l-6.6-6.6q-.15-.15-.213-.325T4.426 12t.063-.375t.212-.325l6.6-6.6q.275-.275.688-.275t.712.275q.3.3.3.713t-.3.712L7.825 11H19q.425 0 .713.288T20 12t-.288.713T19 13z"},null,-1),Bt=[zt];function It(P,V){return p(),N("svg",St,[...Bt])}const Ot={name:"material-symbols-arrow-back-rounded",render:It},Dt={style:{display:"inline-block"},viewBox:"0 0 24 24",width:"1em",height:"1em"},Nt=$("path",{fill:"currentColor",d:"m10.8 12l3.9 3.9q.275.275.275.7t-.275.7t-.7.275t-.7-.275l-4.6-4.6q-.15-.15-.212-.325T8.425 12t.063-.375t.212-.325l4.6-4.6q.275-.275.7-.275t.7.275t.275.7t-.275.7z"},null,-1),Et=[Nt];function qt(P,V){return p(),N("svg",Dt,[...Et])}const At={name:"material-symbols-chevron-left-rounded",render:qt},Vt={key:1,style:{"text-align":"center","font-weight":"600"}},Ft={style:{"vertical-align":"-5px",padding:"0 2px"}},Rt={style:{"text-align":"center","font-weight":"600"}},Ut={key:3},Mt={class:"table-toolbar-right-icon"},Kt={style:{color:"var(--app-primary-color)"}},Lt=Re({__name:"manageValue",emits:["ok"],setup(P,{expose:V,emit:de}){const be=de,{getIsMobile:u}=kt(),{getLocale:j}=_t(),me=j.value==="zh_CN"?Ue:Me,{message:d,confirm:F}=gt(),{t}=yt(),G=c("fade-slide");ft(G);const R=c(),H=c(),W=c(),J=c([]),g=c([]),Q=c(!1),B=c(!1),X=c(),ve=c([{label:()=>s(D,{style:{color:"var(--app-info-color)"}},{default:()=>t("page.env.table.action.enable.button")}),key:"enable",icon:()=>s(r,{icon:"tabler:variable",color:"var(--app-info-color)",style:"vertical-align: baseline"},{}),props:{onClick:()=>{ae(!0)}}},{label:t("page.env.table.action.disable.button"),key:"disable",icon:()=>s(r,{icon:"tabler:variable-off",style:"vertical-align: baseline"},{}),props:{onClick:()=>{ae(!1)}}},{label:()=>s(D,{style:{color:"var(--app-error-color)"}},{default:()=>t("page.env.table.action.delete.button")}),key:"delete",icon:()=>s(r,{icon:"fe:trash",color:"var(--app-error-color)",style:"vertical-align: baseline"},{}),props:{onClick:()=>{xe()}}}]),_=Ke({title:"",show:!1,model:{}}),{show:E,title:U}=Le(_),_e=[{type:"selection",key:"selection",width:46},{title:t("page.env.table.title.sort"),key:"sort",align:"center",titleAlign:"center",width:88,sorter:!0,defaultSortOrder:!1,render(e){return s(se,{size:"small",bordered:!1,style:"font-weight: 600"},{default:()=>e.sort})}},{title:t("page.env.table.title.value"),key:"value",resizable:!0,render(e){return s("span",{style:{fontFamily:"var(--app-font-family-mono)"}},String(e.value||""))}},{title:t("page.env.table.title.remark"),key:"remark",resizable:!0,width:200},{title:t("page.env.table.title.update_time"),key:"update_time",align:"center",width:170,render(e){return e.update_time?Date.now()-new Date(e.update_time).getTime()<1e3*60*60?Pe(new Date(e.update_time),{addSuffix:!0,locale:me}):e.update_time:t("page.env.table.update_time.never")},sorter:!0,defaultSortOrder:!1},{title:t("page.env.table.title.enable"),key:"enable",align:"center",width:120,fixed:u.value?void 0:"right",renderFilterIcon:()=>s(r,{icon:"ic:round-filter-list",style:"vertical-align: baseline"},{}),render(e){return s(se,{type:e.enable===1?"success":"error",bordered:!1,style:j.value==="zh_CN"?"":"width: 66px; line-height: 28px; display: block; text-align: center"},{default:()=>e.enable===1?t("common.active"):t("common.inactive")})},defaultFilterOptionValues:[],filterOptions:[{label:t("common.active"),value:1},{label:t("common.inactive"),value:0}],filter(){}}],Y=(e,a)=>{switch(e){case"edit":return{icon:"mdi-square-edit-outline",tooltip:t("page.env.table.action.edit"),quaternary:!0,focusable:!1,onClick:Z.bind(null,a)};case"changeStatus":return{icon:a.enable===1?"tabler-variable-off":"tabler-variable",tooltip:a.enable===1?t("page.env.table.action.disable.button"):t("page.env.table.action.enable.button"),quaternary:!0,focusable:!1,onClick:ee.bind(null,a)}}},fe={title:t("page.env.table.title.action"),key:"action",titleAlign:u.value?"center":"left",width:u.value?68:140,fixed:"right",render(e){const a={edit:{label:t("page.env.table.action.edit"),key:"edit",icon:()=>s(r,{icon:"mdi:square-edit-outline",style:"vertical-align: baseline"},{}),props:{onClick:Z.bind(null,e)}},delete:{label:()=>s(D,{style:{color:"var(--app-error-color)"}},{default:()=>t("page.env.table.action.delete.button")}),key:"delete",icon:()=>s(r,{icon:"fe:trash",color:"var(--app-error-color)",style:"vertical-align: baseline"},{}),props:{onClick:ge.bind(null,e)}},changeStatus:{label:e.enable===1?t("page.env.table.action.disable.button"):t("page.env.table.action.enable.button"),key:"changeStatus",icon:()=>s(r,{icon:e.enable===1?"tabler:variable-off":"tabler:variable",style:"vertical-align: baseline"},{}),props:{onClick:ee.bind(null,e)}},sort:{label:t("page.env.table.action.sort.title"),key:"sort",icon:()=>s(r,{icon:"mdi:sort",style:"vertical-align: baseline"},{}),children:[{label:t("page.env.table.action.sort.moveUp"),key:"sortMoveUp",icon:()=>s(r,{icon:"material-symbols:arrow-upward-rounded",style:"vertical-align: baseline"},{}),props:{onClick:I.bind(null,e,"up")}},{label:t("page.env.table.action.sort.moveDown"),key:"sortMoveDown",icon:()=>s(r,{icon:"material-symbols:arrow-downward-rounded",style:"vertical-align: baseline"},{}),props:{onClick:I.bind(null,e,"down")}},{label:t("page.env.table.action.sort.moveTop"),key:"sortMoveTop",icon:()=>s(r,{icon:"material-symbols:text-select-move-up-rounded",style:"vertical-align: baseline"},{}),props:{onClick:I.bind(null,e,"top")}},{label:t("page.env.table.action.sort.moveBottom"),key:"sortMoveBottom",icon:()=>s(r,{icon:"material-symbols:text-select-move-down-rounded",style:"vertical-align: baseline"},{}),props:{onClick:I.bind(null,e,"bottom")}},{label:t("page.env.table.action.sort.moveSpecify"),key:"sortMoveSpecify",icon:()=>s(r,{icon:"ic:round-numbers",style:"vertical-align: baseline"},{}),props:{onClick:I.bind(null,e,"specify")}}]},export:{label:t("page.env.table.action.export"),key:"export",icon:()=>s(r,{icon:"mdi:content-copy",style:"vertical-align: baseline"},{}),props:{iconProps:{size:"16"},onClick:ye.bind(null,e)}}};let b;return u.value?b={style:"button",actions:[],dropDownActions:[a.edit,a.changeStatus,a.export,a.sort,a.delete]}:b={style:"button",actions:[Y("edit",e),Y("changeStatus",e)],dropDownActions:[a.export,a.sort,a.delete]},s(ut,b)}},Z=async e=>{R.value?.open("composite_value",e)},ge=e=>{F.error({title:t("page.env.table.action.delete.title"),content:t("page.env.table.action.delete.confirm"),icon:()=>s(r,{icon:"fe:trash",style:"vertical-align: baseline"},{}),closable:!1,maskClosable:!1,autoFocus:!1,positiveText:t("page.env.table.action.delete.button"),onPositiveClick:async()=>{try{await pe({id:e.id}),d.success(t("page.env.table.message.delete.ok"))}catch{d.error(t("page.env.table.message.delete.fail"))}finally{f()}},negativeButtonProps:{ghost:!1,tertiary:!0}})},ee=async e=>{try{const a=Object.assign({},e,{enable:e.enable===0?1:0});delete a.update_time,await Ct(a),d.success(e.enable===1?t("page.env.table.message.disable.ok"):t("page.env.table.message.enable.ok"),{duration:1500}),e.enable===0?e.enable=1:e.enable=0}catch{d.error(e.enable===1?t("page.env.table.message.disable.fail"):t("page.env.table.message.enable.fail"))}},I=async(e,a)=>{const{id:b,sort:w}=e;try{let C;switch(a){case"up":C={id:b,order:w+(h.value==="0"?-1:1)};break;case"down":C={id:b,order:w+(h.value==="0"?1:-1)};break;case"top":C=Object.assign({id:b},h.value==="0"?{order:1}:{moveToEnd:!0});break;case"bottom":C=Object.assign({id:b},h.value==="0"?{moveToEnd:!0}:{order:1});break;case"specify":O.value=!0,q.value=b,y.value=w;return;default:return}await ue(C),d.success(t("page.env.table.message.sort.ok")),f()}catch{}},ye=async e=>{je().copy(`export ${_.title}="${e.value}"`).then(()=>{d.success(t("common.copyOk"))}).catch(()=>{d.error(t("common.copyFail"))})},O=c(!1),y=c(null),q=c(null),he=()=>s(r,{icon:"ic:round-numbers",style:"vertical-align: baseline"},{}),ke=async()=>{try{await ue({id:q.value,order:y.value}),d.success(t("page.env.table.message.sort.ok")),f()}catch{}finally{q.value=null,y.value=null}},te=()=>{O.value=!1,y.value=null,q.value=null},xe=()=>{F.error({title:t("page.env.table.action.delete.batchTitle"),content:t("page.env.table.action.delete.batchConfirm"),icon:()=>s(r,{icon:"fe:trash",size:24,style:"vertical-align: baseline"},{}),closable:!1,maskClosable:!1,autoFocus:!1,onPositiveClick:async()=>{try{const e=g.value.map(a=>Number(a));await pe({id:e}),d.success(t("page.env.table.message.delete.ok"))}catch{d.error(t("page.env.table.message.delete.fail"))}finally{f()}},negativeButtonProps:{ghost:!1,tertiary:!0}})},ae=e=>{F.info({title:t(`page.env.table.action.${e?"enable":"disable"}.batchTitle`),content:t(`page.env.table.action.${e?"enable":"disable"}.batchConfirm`),icon:()=>s(r,{icon:e?"tabler:variable":"tabler:variable-off",size:24,style:"vertical-align: baseline"},{}),closable:!1,maskClosable:!1,autoFocus:!1,onPositiveClick:async()=>{try{await Tt({id:g.value.map(a=>Number(a)),enable:e?1:0}),d.success(t(`page.env.table.message.${e?"enable":"disable"}.ok`))}catch{d.error(t(`page.env.table.message.${e?"enable":"disable"}.fail`))}finally{f()}},negativeButtonProps:{ghost:!1,tertiary:!0}})},f=()=>{setTimeout(()=>{W.value?.reload()},250),g.value=[]},M=()=>{B.value=!0,f(),B.value=!1},ne=()=>{k.value="",f()},we=e=>{J.value=e.enable},A=c("sort"),h=c("0"),Ce=async e=>{switch(e.order){case"ascend":A.value=e.columnKey,h.value="0";break;case"descend":A.value=e.columnKey,h.value="1";break;case!1:A.value="sort",h.value="0";break}f()},k=c(""),Te=async e=>{const a={page:e.page,size:e.size,group_id:_.model.id,search:k.value||"",enable:J.value.join(","),orderBy:A.value,order:h.value};return await $t(a)},$e=(e={})=>{const a={id:null,type:"",description:"",tag_list:"",enable:1,separator:"",envs:0};_.model=Qe(a),Object.assign(_.model,e),_.title=_.model.type||"未知变量名",_.show=!0},S=async e=>{switch(e){case"createValue":R.value?.open("composite_value",null,_.model.id);break;case"importEnv":H.value?.open(_.model.id);break;case"backEnvTable":E.value=!1,be("ok");break;case"showSearchBar":Q.value=!0,Xe().then(()=>{X.value?.focus()});break}};return V({open:$e}),(e,a)=>{const b=At,w=Ye,C=Ze,Se=et,ze=vt,K=mt,le=tt,Be=at,oe=bt,Ie=nt,Oe=lt,De=ot,Ne=st,Ee=Ot,qe=it,Ae=rt,Ve=ct,Fe=pt;return p(),N(Je,null,[o(Ae,{show:n(E),"onUpdate:show":a[9]||(a[9]=i=>z(E)?E.value=i:null),height:"calc(var(--vh) * 100)",width:"100%",placement:"right",to:"#env-table-drawer-target","trap-focus":!1,"block-scroll":!1,"auto-focus":!1,"mask-closable":!1},{default:l(()=>[o(Ne,{closable:!1,"header-style":"display: none","body-content-style":"padding: 0"},{header:l(()=>[]),default:l(()=>[o(De,{bordered:!1,style:{height:"100%","background-color":"var(--app-background-color)"},"header-style":{padding:n(u)?"0 10px":"20px 24px 20px 24px"},"content-style":{height:"100%",padding:n(u)?"10px":"0 24px 20px 24px"}},{header:l(()=>[o(Se,{style:{"align-items":"center"}},{default:l(()=>[n(u)?L("",!0):(p(),m(n(T),{key:0,strong:"",secondary:"",focusable:!1,style:{padding:"0 8px"},onClick:a[0]||(a[0]=i=>S("backEnvTable"))},{icon:l(()=>[o(w,{size:28},{default:l(()=>[o(b,{style:{"vertical-align":"baseline"}})]),_:1})]),_:1})),n(u)?(p(),m(C,{key:2,style:{height:"100%","max-width":"190px"}},{tooltip:l(()=>[$("span",Rt,v(n(U)),1)]),default:l(()=>[$("span",Ft,v(n(U)),1)]),_:1})):(p(),N("span",Vt,v(n(U)),1))]),_:1})]),default:l(()=>[o(n(dt),{ref_key:"tableRef",ref:W,"checked-row-keys":n(g),"onUpdate:checkedRowKeys":a[7]||(a[7]=i=>z(g)?g.value=i:null),class:"env-sub-table","table-id":"ENV_SUB","pagination-behavior-on-filter":"first",columns:_e,request:Te,"row-key":i=>`${i.id}`,"action-column":fe,"onUpdate:filters":we,"onUpdate:sorter":Ce},Ge({tableTitle:l(()=>[o(n(ie),{wrap:!1},{default:l(()=>[n(u)?(p(),m(n(T),{key:1,secondary:"",type:"primary",size:"small",style:{padding:"0 6px"},focusable:!1,onClick:a[2]||(a[2]=i=>S("createValue"))},{icon:l(()=>[o(ze)]),_:1})):(p(),m(n(T),{key:0,type:"primary",size:"small",style:{height:"32px"},focusable:!1,onClick:a[1]||(a[1]=i=>S("createValue"))},{default:l(()=>[x(v(n(t)("page.env.table.newValue")),1)]),_:1})),n(u)?L("",!0):(p(),m(n(T),{key:2,secondary:"",size:"small",style:{height:"32px"},focusable:!1,onClick:a[3]||(a[3]=i=>S("importEnv"))},{default:l(()=>[x(v(n(t)("page.env.table.batchImport")),1)]),_:1})),n(u)?(p(),m(le,{key:4,value:n(k),"onUpdate:value":a[6]||(a[6]=i=>z(k)?k.value=i:null),loading:n(B)||void 0,size:"small",clearable:"",placeholder:n(t)("page.env.table.search.placeholder"),"on-clear":ne,onKeyup:re(M,["enter"])},{prefix:l(()=>[o(K)]),_:1},8,["value","loading","placeholder"])):(p(),N("div",Ut,[n(Q)?(p(),m(ce,{key:1,name:n(G),mode:"default",appear:""},{default:l(()=>[o(Be,{style:{height:"32px"}},{default:l(()=>[o(le,{ref_key:"searchBarInputRef",ref:X,value:n(k),"onUpdate:value":a[5]||(a[5]=i=>z(k)?k.value=i:null),disabled:n(B),loading:n(B)||void 0,size:"small",clearable:"",placeholder:n(t)("page.env.table.search.placeholder"),"on-clear":ne,onKeyup:re(M,["enter"])},{prefix:l(()=>[o(K)]),_:1},8,["value","disabled","loading","placeholder"]),o(n(T),{strong:"",secondary:"",type:"primary",size:"small",style:{height:"32px"},onClick:M},{default:l(()=>[x(v(n(t)("common.searchText")),1)]),_:1})]),_:1})]),_:1},8,["name"])):(p(),m(n(T),{key:0,strong:"",secondary:"",size:"small",style:{padding:"0 8px",height:"32px"},focusable:!1,onClick:a[4]||(a[4]=i=>S("showSearchBar"))},{icon:l(()=>[o(K)]),_:1}))]))]),_:1})]),toolbar:l(()=>[He(o(ce,{name:"fade-slide-left",mode:"out-in",appear:""},{default:l(()=>[o(n(ie),{wrap:!1},{default:l(()=>[o(Oe,{size:"small",trigger:"click",options:n(ve)},{default:l(()=>[n(u)?(p(),m(Ie,{key:1,trigger:"hover"},{trigger:l(()=>[$("div",Mt,[o(w,{size:"20"},{default:l(()=>[o(oe)]),_:1})])]),default:l(()=>[$("span",null,v(n(t)("page.env.table.action.batchAction")),1)]),_:1})):(p(),m(n(T),{key:0,strong:"",secondary:"",size:"small",type:"primary",style:{padding:"0 8px"},focusable:!1},{icon:l(()=>[o(oe)]),default:l(()=>[x(" "+v(n(t)("page.env.table.action.batchAction")),1)]),_:1}))]),_:1},8,["options"])]),_:1})]),_:1},512),[[We,n(g).length]])]),_:2},[n(g).length&&!n(u)?{name:"info",fn:l(()=>[o(n(D),null,{default:l(()=>[x(v(n(t)("common.selected")),1)]),_:1}),x("  "),$("span",Kt,v(n(g).length),1),x("  "),o(n(D),null,{default:l(()=>[x(v(n(t)("common.item")),1)]),_:1})]),key:"0"}:void 0]),1032,["checked-row-keys","row-key"])]),_:1},8,["header-style","content-style"])]),_:1}),n(u)?(p(),m(qe,{key:0,left:20,bottom:20,onClick:a[8]||(a[8]=i=>S("backEnvTable"))},{default:l(()=>[o(w,null,{default:l(()=>[o(Ee)]),_:1})]),_:1})):L("",!0)]),_:1},8,["show"]),o(Fe,{show:n(O),"onUpdate:show":a[11]||(a[11]=i=>z(O)?O.value=i:null),preset:"dialog",style:{width:"360px"},"auto-focus":!1,"mask-closable":!1,icon:he,title:n(t)("page.env.table.action.sort.moveSpecifyTitle"),"positive-text":n(t)("common.okText"),"negative-text":n(t)("common.cancelText"),"on-close":te,"positive-button-props":{disabled:!n(y)},"negative-button-props":{ghost:!1,tertiary:!0},onNegativeClick:a[12]||(a[12]=i=>te()),onPositiveClick:a[13]||(a[13]=i=>ke())},{default:l(()=>[o(Ve,{value:n(y),"onUpdate:value":a[10]||(a[10]=i=>z(y)?y.value=i:null),clearable:"",min:1,max:99999,style:{"margin-top":"5px"}},null,8,["value"])]),_:1},8,["show","title","positive-text","negative-text","positive-button-props"]),o(xt,{ref_key:"editEnv",ref:R,onOk:f},null,512),o(wt,{ref_key:"importEnv",ref:H,onOk:f},null,512)],64)}}}),ra=ht(Lt,[["__scopeId","data-v-fd45b911"]]);export{ra as default};
