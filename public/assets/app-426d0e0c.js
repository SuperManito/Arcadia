import{_ as ne,a as oe,b as te}from"./app-91293384.js";import{aJ as le,a3 as _,aC as ae,ah as u,G as se,y as I,r as ie,J as re,F as t,a4 as g,a5 as e,a6 as n,aD as p,aP as D,aF as F,aE as W,al as q,aQ as ue,aw as ce,b1 as pe,aH as _e,co as ge,b8 as fe,aR as de,b5 as me,b2 as ve,be as ye,bD as he,bx as we,by as be}from"./vendor-191e7315.js";import{_ as ke,a as xe}from"./app-651c5cb6.js";import{g as J,j as ze,b as Ce}from"./app-d3fc3aa7.js";import{u as Le}from"./app-9adaac50.js";import{d as De,b as Fe}from"./app-16ee8ad9.js";const He={style:{display:"inline-block"},viewBox:"0 0 24 24",width:"1em",height:"1em"};function Ne(O,C){return _(),ae("svg",He,C[0]||(C[0]=[u("path",{fill:"currentColor",d:"M13.5 8H12v5l4.28 2.54l.72-1.21l-3.5-2.08zM13 3a9 9 0 0 0-9 9H1l3.96 4.03L9 12H6a7 7 0 0 1 7-7a7 7 0 0 1 7 7a7 7 0 0 1-7 7c-1.93 0-3.68-.79-4.94-2.06l-1.42 1.42A8.9 8.9 0 0 0 13 21a9 9 0 0 0 9-9a9 9 0 0 0-9-9"},null,-1)]))}const Be=le({name:"mdi-history",render:Ne}),Ee=se({__name:"viewHistory",setup(O,{expose:C}){const{message:L}=De(),{t:s}=Fe(),{getIsMobile:M}=Le(),H=I(null),y=I(M.value?14:16),N=I(null),G=ie({show:!1,log:"",showFullScreen:!1,currentPath:"",selectData:[]}),{show:h,log:f,showFullScreen:b,currentPath:d,selectData:m}=re(G);async function Q(a){let o="";try{o=typeof a.config=="object"&&a.config.logDirectory?a.config.logDirectory:a.logPath}catch{}if(!o)return;const w=a.isRunning;try{if(await Z(o),m.value.length){m.value.sort((i,c)=>{const z=i.name.replace(".log","").replace(/-/g,"");return c.name.replace(".log","").replace(/-/g,"")-z});const v=w&&m.value[1]?m.value[1]:m.value[0];d.value=v.path;const l=await J({path:v.path});f.value=l,h.value=!0}else L.warning(s("page.cron.viewHistory.noLatestMsg"))}catch{L.warning(s("page.cron.viewHistory.noLatestMsg"))}}async function R(a,o){if(!o.disabled)try{const w=await J({path:o.value});f.value=w,d.value=a}catch{}}async function Z(a){const o=await ze({path:a}),w=K(o.children);m.value=w.slice().reverse()}function K(a){return(v=>{v.length&&v.forEach(l=>{if(l.type===1){const i=l.name;if(i){const c=i.substring(i.lastIndexOf(".")+1),z=Ce[c]||{};Object.assign(l,{value:l.path,label:i.replace(/\.log$/,""),language:"plaintext",disabled:z.icon&&z.disabled||!1})}}})})(a),a=(v=>v.filter(l=>!l.disabled))(a),a}function k(a){switch(a){case"enlarge":y.value<20?y.value+=1:y.value===20&&L.info(s("page.log.enlargeMaxMsg"));break;case"narrow":y.value>12?y.value-=1:y.value===12&&L.info(s("page.log.narrowMinMsg"));break;case"bottom":const o=H.value?.$el?.clientHeight;N.value?.scrollTo({top:o,behavior:"smooth"});break;case"fullScreen":b.value=!b.value;break}}function x(){h.value=!1,f.value="",b.value=!1,d.value="",m.value=[]}return C({open:Q}),(a,o)=>{const w=ke,v=xe,l=ue,i=ce,c=pe,z=_e,B=Be,$=ge,S=ne,T=oe,E=te,j=fe,A=de,P=me,U=ve,V=ye,X=he,Y=we,ee=be;return t(M)?(_(),g(ee,{key:1,show:t(h),"onUpdate:show":o[10]||(o[10]=r=>F(h)?h.value=r:null),height:"calc(var(--vh) * 100)",width:"100vw",placement:"bottom","auto-focus":!1,"mask-closable":!1,onMaskClick:x,onAfterLeave:x},{default:e(()=>[n(Y,{"header-style":"height: 60px; padding: 16px 12px","body-content-style":"padding: 4px 0 4px 8px; overscroll-behavior: none","footer-style":"padding: 16px 24px 24px 24px"},{header:e(()=>[n(A,{style:{gap:"4px"}},{default:e(()=>[n(l,{size:28,color:"var(--app-primary-color)"},{default:e(()=>[n(B,{style:{"vertical-align":"0"}})]),_:1}),n($,{value:t(d),"onUpdate:value":o[6]||(o[6]=r=>F(d)?d.value=r:null),class:"max-w-190px w-190px ml-1",size:"small","consistent-menu-width":!1,options:t(m),"on-update:value":R},null,8,["value","options"]),t(f)?(_(),g(j,{key:0,style:{"padding-left":"8px"}},{default:e(()=>[n(c,{"show-arrow":!1,trigger:"hover",delay:500},{trigger:e(()=>[n(i,{strong:"",secondary:"",size:"small",focusable:!1,onClick:o[7]||(o[7]=r=>k("narrow"))},{icon:e(()=>[n(l,{size:18},{default:e(()=>[n(S,{style:{"vertical-align":"baseline"}})]),_:1})]),_:1})]),default:e(()=>[u("span",null,p(t(s)("page.cron.viewHistory.narrowButtonTips")),1)]),_:1}),n(c,{"show-arrow":!1,trigger:"hover",delay:500},{trigger:e(()=>[n(i,{strong:"",secondary:"",size:"small",focusable:!1,onClick:o[8]||(o[8]=r=>k("enlarge"))},{icon:e(()=>[n(l,{size:18},{default:e(()=>[n(T,{style:{"vertical-align":"baseline"}})]),_:1})]),_:1})]),default:e(()=>[u("span",null,p(t(s)("page.cron.viewHistory.enlargeButtonTips")),1)]),_:1}),n(c,{"show-arrow":!1,trigger:"click",delay:500},{trigger:e(()=>[n(i,{strong:"",secondary:"",size:"small",focusable:!1,onClick:o[9]||(o[9]=r=>k("bottom"))},{icon:e(()=>[n(l,{size:18},{default:e(()=>[n(E,{style:{"vertical-align":"baseline"}})]),_:1})]),_:1})]),default:e(()=>[u("span",null,p(t(s)("file.bottom.button")),1)]),_:1})]),_:1})):W("",!0)]),_:1})]),default:e(()=>[n(V,{ref_key:"logInstWrapRef",ref:N,"native-scrollbar":!0,style:{width:"100%",height:"100%","background-color":"transparent"}},{default:e(()=>[t(f)?(_(),g(U,{key:1,ref_key:"logInstRef",ref:H,log:t(f),"line-height":1.5,"font-size":t(y),language:"naive-log",style:{width:"100%",height:"100%"}},null,8,["log","font-size"])):(_(),g(P,{key:0},{default:e(()=>[D(p(t(s)("common.noData")),1)]),_:1}))]),_:1},512)]),footer:e(()=>[n(i,{block:"",strong:"",secondary:"",type:"primary",focusable:!1,onClick:x},{default:e(()=>[D(p(t(s)("component.modal.close")),1)]),_:1})]),_:1})]),_:1},8,["show"])):(_(),g(X,{key:0,show:t(h),"onUpdate:show":o[5]||(o[5]=r=>F(h)?h.value=r:null),preset:"dialog","auto-focus":!1,style:q({width:t(b)?"calc(-20px + 100vw)":"600px"}),"on-close":x,"on-mask-click":x},{close:e(()=>[n(z,null,{default:e(()=>[n(c,{"show-arrow":!1,trigger:"hover",delay:500},{trigger:e(()=>[n(i,{size:"tiny",quaternary:"",focusable:!1,style:{padding:"4px"},onClick:o[0]||(o[0]=r=>k("fullScreen"))},{icon:e(()=>[n(l,{size:20,depth:2},{default:e(()=>[t(b)?(_(),g(v,{key:1,style:{"vertical-align":"baseline"}})):(_(),g(w,{key:0,style:{"vertical-align":"baseline"}}))]),_:1})]),_:1})]),default:e(()=>[u("span",null,p(t(b)?t(s)("layout.header.tooltipExitFull"):t(s)("layout.header.tooltipEntryFull")),1)]),_:1}),n(i,{size:"tiny",quaternary:"",focusable:!1,style:{padding:"4px"},onClick:x},{icon:e(()=>[n(l,{size:18,depth:2},{default:e(()=>o[11]||(o[11]=[u("svg",{viewBox:"0 0 12 12",version:"1.1",xmlns:"http://www.w3.org/2000/svg","aria-hidden":"true"},[u("g",{stroke:"none","stroke-width":"1",fill:"none","fill-rule":"evenodd"},[u("g",{fill:"currentColor","fill-rule":"nonzero"},[u("path",{d:"M2.08859116,2.2156945 L2.14644661,2.14644661 C2.32001296,1.97288026 2.58943736,1.95359511 2.7843055,2.08859116 L2.85355339,2.14644661 L6,5.293 L9.14644661,2.14644661 C9.34170876,1.95118446 9.65829124,1.95118446 9.85355339,2.14644661 C10.0488155,2.34170876 10.0488155,2.65829124 9.85355339,2.85355339 L6.707,6 L9.85355339,9.14644661 C10.0271197,9.32001296 10.0464049,9.58943736 9.91140884,9.7843055 L9.85355339,9.85355339 C9.67998704,10.0271197 9.41056264,10.0464049 9.2156945,9.91140884 L9.14644661,9.85355339 L6,6.707 L2.85355339,9.85355339 C2.65829124,10.0488155 2.34170876,10.0488155 2.14644661,9.85355339 C1.95118446,9.65829124 1.95118446,9.34170876 2.14644661,9.14644661 L5.293,6 L2.14644661,2.85355339 C1.97288026,2.67998704 1.95359511,2.41056264 2.08859116,2.2156945 L2.14644661,2.14644661 L2.08859116,2.2156945 Z"})])])],-1)])),_:1})]),_:1})]),_:1})]),icon:e(()=>[n(l,{size:24},{default:e(()=>[n(B,{style:{"vertical-align":"0"}})]),_:1})]),header:e(()=>[n(A,null,{default:e(()=>[D(p(t(s)("page.cron.table.history"))+" ",1),n($,{value:t(d),"onUpdate:value":o[1]||(o[1]=r=>F(d)?d.value=r:null),class:"max-w-190px w-190px",size:"small","consistent-menu-width":!1,options:t(m),"on-update:value":R},null,8,["value","options"]),t(f)?(_(),g(j,{key:0},{default:e(()=>[n(c,{"show-arrow":!1,trigger:"hover",delay:500},{trigger:e(()=>[n(i,{strong:"",secondary:"",size:"small",focusable:!1,onClick:o[2]||(o[2]=r=>k("narrow"))},{icon:e(()=>[n(l,{size:18},{default:e(()=>[n(S,{style:{"vertical-align":"baseline"}})]),_:1})]),_:1})]),default:e(()=>[u("span",null,p(t(s)("page.cron.viewHistory.narrowButtonTips")),1)]),_:1}),n(c,{"show-arrow":!1,trigger:"hover",delay:500},{trigger:e(()=>[n(i,{strong:"",secondary:"",size:"small",focusable:!1,onClick:o[3]||(o[3]=r=>k("enlarge"))},{icon:e(()=>[n(l,{size:18},{default:e(()=>[n(T,{style:{"vertical-align":"baseline"}})]),_:1})]),_:1})]),default:e(()=>[u("span",null,p(t(s)("page.cron.viewHistory.enlargeButtonTips")),1)]),_:1}),n(c,{"show-arrow":!1,trigger:"hover",delay:500},{trigger:e(()=>[n(i,{strong:"",secondary:"",size:"small",focusable:!1,onClick:o[4]||(o[4]=r=>k("bottom"))},{icon:e(()=>[n(l,{size:18},{default:e(()=>[n(E,{style:{"vertical-align":"baseline"}})]),_:1})]),_:1})]),default:e(()=>[u("span",null,p(t(s)("file.bottom.button")),1)]),_:1})]),_:1})):W("",!0)]),_:1})]),default:e(()=>[n(V,{ref_key:"logInstWrapRef",ref:N,"native-scrollbar":!1,style:q({paddingTop:"1em",width:"100%",backgroundColor:"transparent",height:t(b)?"calc(-120px + 100vh)":"600px"})},{default:e(()=>[u("div",null,[t(f)?(_(),g(U,{key:1,ref_key:"logInstRef",ref:H,log:t(f),"line-height":1.5,"font-size":t(y),language:"naive-log",style:{width:"100%",height:"100%"}},null,8,["log","font-size"])):(_(),g(P,{key:0},{default:e(()=>[D(p(t(s)("common.noData")),1)]),_:1}))])]),_:1},8,["style"])]),_:1},8,["show","style"]))}}});export{Ee as _};
