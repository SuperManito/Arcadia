import{_ as ge}from"./plus-B-AkAw1V.js";import{a7 as s,aK as E,av as R,I as fe,A as le,r as be,K as ye,u as e,a8 as i,a9 as l,aa as a,aF as T,aS as v,aL as _,ax as te,aR as ae,aG as C,ai as he,aT as ke,bd as we,bn as xe,bz as Ce,a_ as Ue,bA as ze,bB as $e,ap as Te,cF as Ee,by as Le,aE as Ae,bb as Pe,bo as Se,aM as Ve,bj as Ie,b9 as Re,aU as Be,bE as Me,bF as Ne,n as O,bu as Oe}from"./vendor-CsvKI2kS.js";import{c as Fe,h as je,a as qe,af as ne}from"./index-hO6mdrNR.js";import{u as De}from"./useAppInject-BoZf51bk.js";import{s as oe,b as se}from"./env-B-vNm9vX.js";const He={style:{display:"inline-block"},viewBox:"0 0 24 24",width:"1em",height:"1em"},Ge=R("path",{fill:"currentColor",d:"M17 14h2v3h3v2h-3v3h-2v-3h-3v-2h3zm-6 2L2 9l9-7l9 7zm0 2.54l1-.79V18c0 .71.12 1.39.35 2L11 21.07l-9-7l1.62-1.26z"},null,-1),Je=[Ge];function Ke(F,B){return s(),E("svg",He,[...Je])}const Qe={name:"mdi-layers-plus",render:Ke},We={style:{display:"inline-block"},viewBox:"0 0 24 24",width:"1em",height:"1em"},Xe=R("path",{fill:"currentColor",d:"M4.63 10.27L3 9l9-7l7.94 6.17l-7.44 7.44l-.5.39zM10 18.94v-.83l.59-.58l.04-.03l-6.01-4.69L3 14.07l7 5.43zm11.7-6.36l-1.28-1.28a.55.55 0 0 0-.77 0l-1 1l2.05 2.05l1-1a.55.55 0 0 0 0-.77M12 21h2.06l6.05-6.07l-2.05-2.05L12 18.94z"},null,-1),Ye=[Xe];function Ze(F,B){return s(),E("svg",We,[...Ye])}const el={name:"mdi-layers-edit",render:Ze},ll={style:{"vertical-align":"-5px",padding:"0 2px"}},il=fe({__name:"editEnv",emits:["ok"],setup(F,{expose:B,emit:ue}){const ie=ue,{getIsMobile:j}=De(),{message:L}=Fe(),{getThemeColor:pe}=je(),{t:o}=qe(),g=le([]),M=le(null),c=be({title:"",type:"ordinary",show:!1,model:{},rules:{type:{required:!0,message:o("page.env.table.form.message.no_type"),trigger:["input","blur"]},enable:{required:!0},separator:{required:!1},value:{message:o("page.env.table.form.message.no_value"),trigger:["input","blur"]}},tagLabel:"",tagColor:pe.value,showAddTagPopover:!1,isCompositeEnvValue:!1}),{title:N,type:U,show:y,model:u,rules:q,tagLabel:f,tagColor:h,showAddTagPopover:b,isCompositeEnvValue:z}=ye(c),S={onkeydown(r){if(r.key==="Enter")return L.warning(o("page.env.table.form.message.no_enter")),!1}},D=()=>new Promise(r=>{M.value?.validate(async t=>{if(!t)try{const d=c.model,k=c.type==="composite",w=c.type==="composite_value";delete d.update_time,d.id||delete d.id,k&&delete d.envs,w?d.tag_list="":d.tag_list=g.value.length>0?JSON.stringify(g.value):"",d.id?(k?await oe(d):await se(d),L.success(o("page.env.table.message.edit.ok"))):(k?await oe(d):await se(d),L.success(o("page.env.table.message.new.ok"))),ie("ok"),r(!0),j&&(y.value=!1)}catch(d){throw new Error(d)}r(!1)}).catch(()=>{})}),H=()=>{if(!f.value||!h.value){L.warning(o("page.env.editEnv.needInputTagContentMsg"));return}if(g.value.length>0){for(const r of g.value)if(r.label===f.value){L.warning(o("page.env.editEnv.tagExistedMsg"));return}}g.value.push({label:f.value,color:h.value}),f.value="",b.value=!1},G=r=>{g.value.splice(r,1)},J=r=>({color:O(r).setAlpha(.12).toHex8String(),borderColor:O(r).toHexString(),textColor:O(r).toHexString()});return B({open:(r,t={},d=0)=>{const k=r==="composite";z.value=r==="composite_value",z.value?c.title=o(`page.env.table.${t?.id?"editValue":"newValue"}`):c.title=o(`page.env.table.${t?.id?"edit":"new"}`);const w=Object.assign({id:null,type:"",description:"",update_time:"",tag_list:"",enable:1},k?{separator:"",envs:0}:{group_id:r==="composite_value"?d:0,remark:"",value:"",sort:0});c.model=he(w),Object.assign(c.model,t);try{g.value=[];const m=JSON.parse(c.model.tag_list||"['']");Array.isArray(m)&&m.forEach(p=>{!p.label||!p.color||g.value.push(p)})}catch{c.model.tag_list=""}c.type=r,c.show=!0}}),(r,t)=>{const d=el,k=Qe,w=ke,m=we,p=xe,x=Ce,V=Ue,I=ze,K=$e,Q=Oe,W=ge,$=Te,X=Ee,Y=Le,A=Ae,Z=Pe,ee=Se,re=Ve,de=Ie,_e=Re,me=Be,ve=Me,ce=Ne;return e(j)?(s(),i(ce,{key:1,show:e(y),"onUpdate:show":t[24]||(t[24]=n=>C(y)?y.value=n:null),height:"calc(var(--vh) * 100)",width:"100vw",placement:"right","auto-focus":!1,"mask-closable":!1},{default:l(()=>[a(ve,{closable:"","header-style":"height: 60px; padding: 16px 12px","body-content-style":"padding: 4px 12px","footer-style":"padding: 16px 24px"},{header:l(()=>[a(me,{style:{gap:"4px"}},{default:l(()=>[a(w,{size:26,color:"var(--app-primary-color)"},{default:l(()=>[e(u).id?(s(),i(d,{key:0,style:{"vertical-align":"0"}})):(s(),i(k,{key:1,style:{"vertical-align":"0"}}))]),_:1}),a(_e,{style:{height:"100%","max-width":"260px"}},{tooltip:l(()=>[R("span",null,_(e(N)),1)]),default:l(()=>[R("span",ll,_(e(N)),1)]),_:1})]),_:1})]),footer:l(()=>[a(A,null,{default:l(()=>[a($,{tertiary:"",focusable:!1,onClick:t[23]||(t[23]=n=>y.value=!1)},{default:l(()=>[v(_(e(o)("common.cancelText")),1)]),_:1}),a($,{type:"primary",focusable:!1,onClick:D},{default:l(()=>[v(_(e(o)("common.okText")),1)]),_:1})]),_:1})]),default:l(()=>[a(ee,{ref_key:"formRef",ref:M,model:e(u),rules:e(q),style:{"padding-top":"1em"}},{default:l(()=>[e(z)?T("",!0):(s(),i(p,{key:0,label:e(o)("page.env.table.title.type"),path:"type"},{default:l(()=>[a(m,{value:e(u).type,"onUpdate:value":t[12]||(t[12]=n=>e(u).type=n),maxlength:"200",clearable:""},null,8,["value"])]),_:1},8,["label"])),e(U)==="composite"?(s(),i(K,{key:1,"x-gap":"12",cols:3},{default:l(()=>[a(I,{span:2},{default:l(()=>[a(p,{label:e(o)("page.env.table.title.enable"),path:"enable"},{default:l(()=>[a(V,{value:e(u).enable,"onUpdate:value":t[13]||(t[13]=n=>e(u).enable=n),animated:"",type:"segment",size:"small",style:{height:"34px"}},{default:l(()=>[(s(),i(x,{key:1,name:1},{default:l(()=>[v(_(e(o)("common.active")),1)]),_:1})),(s(),i(x,{key:0,name:0},{default:l(()=>[v(_(e(o)("common.inactive")),1)]),_:1}))]),_:1},8,["value"])]),_:1},8,["label"])]),_:1}),a(I,{span:1},{default:l(()=>[a(p,{label:e(o)("page.env.table.title.separator"),path:"separator"},{default:l(()=>[a(m,{value:e(u).separator,"onUpdate:value":t[14]||(t[14]=n=>e(u).separator=n),placeholder:e(o)("page.env.table.none"),style:{width:"100%"},"input-props":S},null,8,["value","placeholder"])]),_:1},8,["label"])]),_:1})]),_:1})):(s(),i(p,{key:2,label:e(o)("page.env.table.title.enable"),path:"enable"},{default:l(()=>[a(V,{value:e(u).enable,"onUpdate:value":t[15]||(t[15]=n=>e(u).enable=n),animated:"",type:"segment",size:"small",style:{height:"34px"}},{default:l(()=>[(s(),i(x,{key:1,name:1},{default:l(()=>[v(_(e(o)("common.active")),1)]),_:1})),(s(),i(x,{key:0,name:0},{default:l(()=>[v(_(e(o)("common.inactive")),1)]),_:1}))]),_:1},8,["value"])]),_:1},8,["label"])),e(U)!=="composite"?(s(),i(p,{key:3,label:e(o)("page.env.table.title.value"),path:"value"},{default:l(()=>[a(m,{value:e(u).value,"onUpdate:value":t[16]||(t[16]=n=>e(u).value=n),type:"textarea","input-props":S},null,8,["value"])]),_:1},8,["label"])):T("",!0),e(z)?(s(),i(p,{key:5,label:e(o)("page.env.table.title.remark"),path:"remark"},{default:l(()=>[a(m,{value:e(u).remark,"onUpdate:value":t[18]||(t[18]=n=>e(u).remark=n)},null,8,["value"])]),_:1},8,["label"])):(s(),i(p,{key:4,label:e(o)("page.env.table.title.description"),path:"description"},{default:l(()=>[a(m,{value:e(u).description,"onUpdate:value":t[17]||(t[17]=n=>e(u).description=n)},null,8,["value"])]),_:1},8,["label"])),e(U)!=="composite_value"?(s(),i(p,{key:6,label:e(o)("page.env.table.title.tag_list"),path:"tag_list"},{default:l(()=>[a(A,null,{default:l(()=>[(s(!0),E(ae,null,te(e(g),(n,P)=>(s(),E("div",{key:P,class:"tag-item"},[a(Q,{color:J(n.color),bordered:!1,closable:"",onClose:()=>G(P)},{default:l(()=>[v(_(n.label),1)]),_:2},1032,["color","onClose"])]))),128)),a(Z,{show:e(b),"onUpdate:show":t[22]||(t[22]=n=>C(b)?b.value=n:null),trigger:"click"},{trigger:l(()=>[a($,{dashed:"",focusable:!1,style:{height:"28px",padding:"0 6px"},onClick:t[19]||(t[19]=n=>b.value=!0)},{icon:l(()=>[a(w,{depth:3},{default:l(()=>[a(W,{style:{"vertical-align":"0"}})]),_:1})]),_:1})]),default:l(()=>[a(A,{wrap:!1},{default:l(()=>[a(Y,{size:"small"},{default:l(()=>[a(X,{value:e(h),"onUpdate:value":t[20]||(t[20]=n=>C(h)?h.value=n:null),size:"small",swatches:e(ne),"render-label":()=>null,modes:["hex"],"show-alpha":!1,style:{width:"28px",height:"100%"}},null,8,["value","swatches"]),a(m,{value:e(f),"onUpdate:value":t[21]||(t[21]=n=>C(f)?f.value=n:null),size:"small",style:{width:"120px"}},null,8,["value"])]),_:1}),a($,{size:"small",focusable:!1,onClick:H},{default:l(()=>[v(_(e(o)("component.modal.okText")),1)]),_:1})]),_:1})]),_:1},8,["show"])]),_:1})]),_:1},8,["label"])):T("",!0)]),_:1},8,["model","rules"])]),_:1})]),_:1},8,["show"])):(s(),i(de,{key:0,show:e(y),"onUpdate:show":t[11]||(t[11]=n=>C(y)?y.value=n:null),preset:"dialog","auto-focus":!1,"mask-closable":!1,title:e(N),"positive-text":e(o)("common.okText"),"negative-text":e(o)("common.cancelText"),"negative-button-props":{ghost:!1,tertiary:!0},style:{width:"460px"},onPositiveClick:D},{icon:l(()=>[a(w,{size:28},{default:l(()=>[e(u).id?(s(),i(d,{key:0,style:{"vertical-align":"0"}})):(s(),i(k,{key:1,style:{"vertical-align":"0"}}))]),_:1})]),default:l(()=>[a(re,{bordered:!1,style:{height:"100%","word-break":"unset"},"content-style":"padding: 0"},{default:l(()=>[a(ee,{ref_key:"formRef",ref:M,model:e(u),rules:e(q),"label-width":"auto","require-mark-placement":"right-hanging",style:{"padding-top":"1em"}},{default:l(()=>[e(z)?T("",!0):(s(),i(p,{key:0,label:e(o)("page.env.table.title.type"),path:"type"},{default:l(()=>[a(m,{value:e(u).type,"onUpdate:value":t[0]||(t[0]=n=>e(u).type=n),maxlength:"200",clearable:""},null,8,["value"])]),_:1},8,["label"])),e(U)==="composite"?(s(),i(K,{key:1,"x-gap":"12",cols:3},{default:l(()=>[a(I,{span:2},{default:l(()=>[a(p,{label:e(o)("page.env.table.title.enable"),path:"enable"},{default:l(()=>[a(V,{value:e(u).enable,"onUpdate:value":t[1]||(t[1]=n=>e(u).enable=n),animated:"",type:"segment",size:"small",style:{height:"34px"}},{default:l(()=>[(s(),i(x,{key:1,name:1},{default:l(()=>[v(_(e(o)("common.active")),1)]),_:1})),(s(),i(x,{key:0,name:0},{default:l(()=>[v(_(e(o)("common.inactive")),1)]),_:1}))]),_:1},8,["value"])]),_:1},8,["label"])]),_:1}),a(I,{span:1},{default:l(()=>[a(p,{label:e(o)("page.env.table.title.separator"),path:"separator"},{default:l(()=>[a(m,{value:e(u).separator,"onUpdate:value":t[2]||(t[2]=n=>e(u).separator=n),placeholder:e(o)("page.env.table.none"),style:{width:"100%"},"input-props":S},null,8,["value","placeholder"])]),_:1},8,["label"])]),_:1})]),_:1})):(s(),i(p,{key:2,label:e(o)("page.env.table.title.enable"),path:"enable"},{default:l(()=>[a(V,{value:e(u).enable,"onUpdate:value":t[3]||(t[3]=n=>e(u).enable=n),animated:"",type:"segment",size:"small",style:{height:"34px"}},{default:l(()=>[(s(),i(x,{key:1,name:1},{default:l(()=>[v(_(e(o)("common.active")),1)]),_:1})),(s(),i(x,{key:0,name:0},{default:l(()=>[v(_(e(o)("common.inactive")),1)]),_:1}))]),_:1},8,["value"])]),_:1},8,["label"])),e(U)!=="composite"?(s(),i(p,{key:3,label:e(o)("page.env.table.title.value"),path:"value"},{default:l(()=>[a(m,{value:e(u).value,"onUpdate:value":t[4]||(t[4]=n=>e(u).value=n),type:"textarea","input-props":S},null,8,["value"])]),_:1},8,["label"])):T("",!0),e(z)?(s(),i(p,{key:5,label:e(o)("page.env.table.title.remark"),path:"remark"},{default:l(()=>[a(m,{value:e(u).remark,"onUpdate:value":t[6]||(t[6]=n=>e(u).remark=n)},null,8,["value"])]),_:1},8,["label"])):(s(),i(p,{key:4,label:e(o)("page.env.table.title.description"),path:"description"},{default:l(()=>[a(m,{value:e(u).description,"onUpdate:value":t[5]||(t[5]=n=>e(u).description=n)},null,8,["value"])]),_:1},8,["label"])),e(U)!=="composite_value"?(s(),i(p,{key:6,label:e(o)("page.env.table.title.tag_list"),path:"tag_list"},{default:l(()=>[a(A,null,{default:l(()=>[(s(!0),E(ae,null,te(e(g),(n,P)=>(s(),E("div",{key:P,class:"tag-item"},[a(Q,{color:J(n.color),bordered:!1,closable:"",onClose:()=>G(P)},{default:l(()=>[v(_(n.label),1)]),_:2},1032,["color","onClose"])]))),128)),a(Z,{show:e(b),"onUpdate:show":t[10]||(t[10]=n=>C(b)?b.value=n:null),trigger:"click"},{trigger:l(()=>[a($,{dashed:"",style:{height:"28px",padding:"0 6px"},onClick:t[7]||(t[7]=n=>b.value=!0)},{icon:l(()=>[a(w,{depth:3},{default:l(()=>[a(W,{style:{"vertical-align":"0"}})]),_:1})]),_:1})]),default:l(()=>[a(A,{wrap:!1},{default:l(()=>[a(Y,{size:"small"},{default:l(()=>[a(X,{value:e(h),"onUpdate:value":t[8]||(t[8]=n=>C(h)?h.value=n:null),size:"small",swatches:e(ne),"render-label":()=>null,modes:["hex"],"show-alpha":!1,style:{width:"28px",height:"100%"}},null,8,["value","swatches"]),a(m,{value:e(f),"onUpdate:value":t[9]||(t[9]=n=>C(f)?f.value=n:null),size:"small",style:{width:"120px"}},null,8,["value"])]),_:1}),a($,{size:"small",focusable:!1,onClick:H},{default:l(()=>[v(_(e(o)("component.modal.okText")),1)]),_:1})]),_:1})]),_:1},8,["show"])]),_:1})]),_:1},8,["label"])):T("",!0)]),_:1},8,["model","rules"])]),_:1})]),_:1},8,["show","title","positive-text","negative-text"]))}}});export{il as _};
