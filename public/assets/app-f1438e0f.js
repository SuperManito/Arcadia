import{_ as M}from"./app-564c9d98.js";import{b as U,d as $,_ as q}from"./app-dbd4b5f0.js";import{_ as G}from"./app-7684c51a.js";import{_ as W}from"./app-66f89c3b.js";import{_ as H,C as K,a as Z}from"./app-3a6dce02.js";import{G as J,A as i,y as Q,aC as X,aD as Y,S as C,V as o,T as w,W as s,ax as ee,F as a,ab as I,aK as ne,aw as te,a3 as ae,av as oe,ak as se,aN as ie,as as le,a4 as re,aZ as ce,at as ue}from"./vendor-ca0e89fa.js";import{e as de,g as pe,b as fe,c as _e,f as ge,I as me,s as he}from"./app-2733701f.js";import{u as ve,h as ye}from"./app-67d12428.js";import{u as be}from"./app-40fcbbd5.js";import{F as T,a as xe}from"./app-f44d7ba5.js";import"./app-240cd649.js";import"./vendor-6c6d1442.js";import"./app-80666950.js";import"./app-f0aa7dbe.js";import"./app-64262975.js";import"./app-c16619b4.js";import"./app-a04700e8.js";import"./app-52337bf4.js";const Me=J({__name:"index",setup(ke){const{getIsMobile:N}=be(),{t:c}=U(),{message:v}=$(),g=i([]),_=i({}),u=i(),m=i({content:"",language:"plaintext"}),l=i(""),z=i(14),y=i(!1),b=i(!1),x=i(!1);async function D(e){switch(e){case"save":if(!u.value)break;y.value=!0;const t=u.value.getValue();try{await he({content:t,path:_.value.path}),v.success(c("editor.main.savedSuccess"))}finally{y.value=!1,await F()}break}}async function F(){x.value=!0;const e=await de({type:xe.CONFIG}),t=O(e);g.value=t,x.value=!1}function O(e){const t=d=>{d.length&&d.forEach(n=>{if(n.type===T.FOLDER)Object.assign(n,{key:n.path,label:n.title,disabled:!1,is_dir:!0,prefix:()=>fe(n.title)}),!n.children.length||n.children.length===0?(Object.assign(n,{children:null}),n.prefix=()=>_e()):t(n.children);else{const r=n.name;if(r){const k=r.substring(r.lastIndexOf(".")+1),p=ge[k]||{};Object.assign(n,{key:n.path,label:r,language:p.language||"plaintext",disabled:p.icon&&p.disabled||!1,is_dir:!1,prefix:()=>p.icon||me()})}}})};t(e);const h=d=>d.filter(n=>n.children?(n.children=h(n.children),!0):!n.disabled);return e=h(e),e}function L({option:e}){return{async onClick(){!e.children&&!e.disabled&&(_.value=e,await E(e))}}}async function E(e){b.value=!0;const t=await pe({path:encodeURIComponent(e.key)});t?m.value={content:t,language:e.language}:(m.value={content:"",language:"plaintext"},v.info(c("page.config.fileContentIsEmptyMsg"))),b.value=!1}async function S(){await F();let e={};if(g.value.length)for(const t of g.value)t.type===T.FILE&&t.name==="config.sh"&&(e=t);e.path?(_.value=e,E(_.value),l.value=_.value.path):v.error(c("page.config.mainConfigNotExistsMsg"),{keepAliveOnHover:!0})}return Q(l,e=>{e||(m.value={content:"",language:"plaintext"})}),X(()=>{S()}),Y(()=>{u.value&&u.value.dispose()}),(e,t)=>{const h=ce,d=Z,n=te,r=se,k=W,p=oe,B=G,P=ne,j=q,R=ee,V=M;return w(),C(V,{"content-full":"","no-header":""},{default:o(()=>[s(R,{bordered:!a(N),style:{height:"100%","word-break":"unset"},segmented:{content:!0},"header-style":"padding: 10px; font-weight: unset","content-style":"padding: 0"},{header:o(()=>[s(h,{value:a(l),"onUpdate:value":t[0]||(t[0]=f=>ue(l)?l.value=f:null),size:"small",class:"min-w-190px",style:{width:"fit-content"},loading:a(x),"consistent-menu-width":!1,clearable:"",placeholder:a(c)("page.config.selectConfigFilePlaceholder"),options:a(g),"override-default-node-click-behavior":a(ye),"node-props":L,"on-update:expanded-keys":a(ve)},null,8,["value","loading","placeholder","options","override-default-node-click-behavior","on-update:expanded-keys"])]),"header-extra":o(()=>[ae(s(I,{name:"fade",mode:"out-in",appear:""},{default:o(()=>[s(p,{style:{width:"fit-content"}},{default:o(()=>[s(a(K),{editor:a(u)},{trigger:o(({show:f,toggleShow:A})=>[s(r,{stron:"",size:"small",quaternary:!f,tertiary:f,type:f?"primary":"default",style:{padding:"6px"},focusable:!1,onClick:A},{default:o(()=>[s(n,{size:"18"},{default:o(()=>[s(d)]),_:1})]),_:2},1032,["quaternary","tertiary","type","onClick"])]),_:1},8,["editor"]),s(r,{strong:"",type:"primary",size:"small",loading:a(y),focusable:!1,onClick:t[1]||(t[1]=f=>D("save"))},{icon:o(()=>[s(k)]),default:o(()=>[ie(" "+le(a(c)("editor.main.saveButton")),1)]),_:1},8,["loading"])]),_:1})]),_:1},512),[[re,a(l)]])]),default:o(()=>[s(I,{name:"fade",mode:"out-in",appear:"",style:{"border-bottom-left-radius":"6px","border-bottom-right-radius":"6px"}},{default:o(()=>[a(l)?(w(),C(a(H),{key:0,ref_key:"editorRef",ref:u,value:a(m),"font-size":a(z)},null,8,["value","font-size"])):(w(),C(P,{key:1,class:"min-h-200px flex-jc-ac h-full",size:"huge",description:a(c)("common.selectFileEmptyDesc")},{icon:o(()=>[s(n,null,{default:o(()=>[s(B)]),_:1})]),_:1},8,["description"]))]),_:1}),s(j,{show:a(b)},null,8,["show"])]),_:1},8,["bordered"])]),_:1})}}});export{Me as default};
