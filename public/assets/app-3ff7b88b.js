import{_ as V}from"./app-18f65c91.js";import{b as A,d as U,_ as $}from"./app-16ee8ad9.js";import{_ as q}from"./app-8042bedb.js";import{_ as G}from"./app-2356d3e8.js";import{M as H,a as Q,_ as W}from"./app-6ef178c4.js";import{G as J,y as l,B as K,aM as X,aN as Y,a3 as w,a4 as C,a5 as o,a6 as s,F as t,aF as Z,af as ee,ag as ne,am as T,aP as te,aD as ae,bg as oe,aQ as se,aw as le,aH as ie,aS as re,aI as ce}from"./vendor-191e7315.js";import{s as ue,a as de,g as pe,c as fe,e as _e,I as ge,b as me}from"./app-d3fc3aa7.js";import{h as he,u as ve}from"./app-de22de5f.js";import{u as ye}from"./app-9adaac50.js";import{F as be}from"./app-58940cda.js";import"./app-d8a29f50.js";import"./app-fd53326f.js";import"./vendor-2714f153.js";import"./app-9f5af7f8.js";import"./app-f9713fa5.js";import"./app-6595fc31.js";const je=J({__name:"index",setup(xe){const{getIsMobile:F}=ye(),{t:c}=A(),{message:v}=U(),g=l([]),f=l({}),_=l(),m=l({content:"",language:""}),i=l(""),z=l(F.value?13:15),y=l(!1),b=l(!1),x=l(!1);async function D(e){switch(e){case"save":y.value=!0;const a=t(_).getValue();try{await ue({content:a,path:f.value.path}),v.success(c("editor.main.savedSuccess"))}finally{y.value=!1,await I()}break}}async function I(){x.value=!0;const e=await de({type:be.CONFIG}),a=E(e);g.value=a,x.value=!1}function E(e){const a=u=>{u.length&&u.forEach(n=>{if(n.type===0)Object.assign(n,{key:n.path,label:n.title,prefix:()=>fe(n.title)}),a(n.children),n.children.length||(Object.assign(n,{children:null}),n.prefix=_e());else{const r=n.name;if(r){const k=r.substring(r.lastIndexOf(".")+1),d=me[k]||{};Object.assign(n,{key:n.path,label:r,language:d.language||"plaintext",disabled:d.icon&&d.disabled||!1,prefix:()=>d.icon||ge})}}})};a(e);const h=u=>u.filter(n=>n.children?(n.children=h(n.children),!0):!n.disabled);return e=h(e),e}function O({option:e}){return{async onClick(){!e.children&&!e.disabled&&(f.value=e,await N(e))}}}async function N(e){b.value=!0;const a=await pe({path:encodeURI(e.key)});a?m.value={content:a,language:e.language}:(m.value={content:"",language:""},v.info(c("page.config.fileContentIsEmptyMsg"))),b.value=!1}async function S(){await I();let e={};if(g.value.length)for(const a of g.value)a.type===1&&a.name==="config.sh"&&(e=a);e.path?(f.value=e,N(f.value),i.value=f.value.path):v.error(c("page.config.mainConfigNotExistsMsg"),{keepAliveOnHover:!0})}return K(i,e=>{e||(m.value={content:"",language:""})}),X(()=>{S()}),Y(()=>{_.value&&_.value.dispose()}),(e,a)=>{const h=oe,u=W,n=se,r=le,k=G,d=ie,B=q,M=re,P=$,L=ce,j=V;return w(),C(j,{"content-full":"","no-header":""},{default:o(()=>[s(L,{bordered:!t(F),style:{height:"100%","word-break":"unset"},segmented:{content:!0},"header-style":"padding: 10px","content-style":"padding: 0"},{header:o(()=>[s(h,{value:t(i),"onUpdate:value":a[0]||(a[0]=p=>Z(i)?i.value=p:null),size:"small",class:"min-w-190px",style:{width:"fit-content"},loading:t(x),"consistent-menu-width":!1,clearable:"",placeholder:t(c)("page.config.selectConfigFilePlaceholder"),options:t(g),"override-default-node-click-behavior":t(he),"node-props":O,"on-update:expanded-keys":t(ve)},null,8,["value","loading","placeholder","options","override-default-node-click-behavior","on-update:expanded-keys"])]),"header-extra":o(()=>[ee(s(T,{name:"fade",mode:"out-in",appear:""},{default:o(()=>[s(d,{style:{width:"fit-content"}},{default:o(()=>[s(t(H),{editor:t(_)},{trigger:o(({show:p,toggleShow:R})=>[s(r,{stron:"",size:"small",quaternary:!p,tertiary:p,type:p?"primary":"default",style:{padding:"6px"},focusable:!1,onClick:R},{default:o(()=>[s(n,{size:"18"},{default:o(()=>[s(u,{style:{"vertical-align":"baseline"}})]),_:1})]),_:2},1032,["quaternary","tertiary","type","onClick"])]),_:1},8,["editor"]),s(r,{strong:"",type:"primary",size:"small",loading:t(y),focusable:!1,onClick:a[1]||(a[1]=p=>D("save"))},{icon:o(()=>[s(k)]),default:o(()=>[te(" "+ae(t(c)("editor.main.saveButton")),1)]),_:1},8,["loading"])]),_:1})]),_:1},512),[[ne,t(i)]])]),default:o(()=>[s(T,{name:"fade",mode:"out-in",appear:"",style:{"border-bottom-left-radius":"6px","border-bottom-right-radius":"6px"}},{default:o(()=>[t(i)?(w(),C(t(Q),{key:0,ref_key:"editorRef",ref:_,value:t(m),"font-size":t(z)},null,8,["value","font-size"])):(w(),C(M,{key:1,class:"min-h-200px flex-jc-ac h-full",size:"huge",description:t(c)("common.selectFileEmptyDesc")},{icon:o(()=>[s(n,null,{default:o(()=>[s(B)]),_:1})]),_:1},8,["description"]))]),_:1}),s(P,{show:t(b)},null,8,["show"])]),_:1},8,["bordered"])]),_:1})}}});export{je as default};
