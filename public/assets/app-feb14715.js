import{_ as A}from"./app-e7833723.js";import{b as U,d as q,_ as $}from"./app-b60428ff.js";import{_ as G}from"./app-1ea894c0.js";import{_ as H}from"./app-60231509.js";import{M as J,a as Q,_ as W}from"./app-de2955b8.js";import{G as K,y as l,B as X,aQ as Y,aR as Z,a6 as C,a7 as w,a8 as o,a9 as s,F as t,aJ as ee,aj as ne,ak as te,aq as T,aT as ae,aH as oe,bl as se,aU as le,aA as ie,aL as re,aV as ce,aM as ue}from"./vendor-c495fdf6.js";import{s as de,e as pe,g as fe,c as _e,d as ge,I as me,b as he}from"./app-c86a1b95.js";import{h as ye,u as ve}from"./app-0f24c8a0.js";import{u as be}from"./app-25ce29fa.js";import{a as xe,F as z}from"./app-30b30e0d.js";import"./app-ea00c288.js";import"./app-6e808beb.js";import"./vendor-8fb801c2.js";import"./app-f217d8bf.js";import"./app-72ae05ca.js";import"./app-33d5aac1.js";const Re=K({__name:"index",setup(ke){const{getIsMobile:F}=be(),{t:c}=U(),{message:y}=q(),g=l([]),f=l({}),_=l(),m=l({content:"",language:""}),i=l(""),L=l(F.value?13:15),v=l(!1),b=l(!1),x=l(!1);async function N(e){switch(e){case"save":v.value=!0;const a=t(_).getValue();try{await de({content:a,path:f.value.path}),y.success(c("editor.main.savedSuccess"))}finally{v.value=!1,await E()}break}}async function E(){x.value=!0;const e=await pe({type:xe.CONFIG}),a=O(e);g.value=a,x.value=!1}function O(e){const a=u=>{u.length&&u.forEach(n=>{if(n.type===z.FOLDER)Object.assign(n,{key:n.path,label:n.title,disabled:!1,is_dir:!0,prefix:()=>_e(n.title)}),!n.children.length||n.children.length===0?(Object.assign(n,{children:null}),n.prefix=()=>ge()):a(n.children);else{const r=n.name;if(r){const k=r.substring(r.lastIndexOf(".")+1),d=he[k]||{};Object.assign(n,{key:n.path,label:r,language:d.language||"plaintext",disabled:d.icon&&d.disabled||!1,is_dir:!1,prefix:()=>d.icon||me})}}})};a(e);const h=u=>u.filter(n=>n.children?(n.children=h(n.children),!0):!n.disabled);return e=h(e),e}function B({option:e}){return{async onClick(){!e.children&&!e.disabled&&(f.value=e,await I(e))}}}async function I(e){b.value=!0;const a=await fe({path:encodeURIComponent(e.key)});a?m.value={content:a,language:e.language}:(m.value={content:"",language:""},y.info(c("page.config.fileContentIsEmptyMsg"))),b.value=!1}async function D(){await E();let e={};if(g.value.length)for(const a of g.value)a.type===z.FILE&&a.name==="config.sh"&&(e=a);e.path?(f.value=e,I(f.value),i.value=f.value.path):y.error(c("page.config.mainConfigNotExistsMsg"),{keepAliveOnHover:!0})}return X(i,e=>{e||(m.value={content:"",language:""})}),Y(()=>{D()}),Z(()=>{_.value&&_.value.dispose()}),(e,a)=>{const h=se,u=W,n=le,r=ie,k=H,d=re,M=G,S=ce,j=$,P=ue,R=A;return C(),w(R,{"content-full":"","no-header":""},{default:o(()=>[s(P,{bordered:!t(F),style:{height:"100%","word-break":"unset"},segmented:{content:!0},"header-style":"padding: 10px; font-weight: unset","content-style":"padding: 0"},{header:o(()=>[s(h,{value:t(i),"onUpdate:value":a[0]||(a[0]=p=>ee(i)?i.value=p:null),size:"small",class:"min-w-190px",style:{width:"fit-content"},loading:t(x),"consistent-menu-width":!1,clearable:"",placeholder:t(c)("page.config.selectConfigFilePlaceholder"),options:t(g),"override-default-node-click-behavior":t(ye),"node-props":B,"on-update:expanded-keys":t(ve)},null,8,["value","loading","placeholder","options","override-default-node-click-behavior","on-update:expanded-keys"])]),"header-extra":o(()=>[ne(s(T,{name:"fade",mode:"out-in",appear:""},{default:o(()=>[s(d,{style:{width:"fit-content"}},{default:o(()=>[s(t(J),{editor:t(_)},{trigger:o(({show:p,toggleShow:V})=>[s(r,{stron:"",size:"small",quaternary:!p,tertiary:p,type:p?"primary":"default",style:{padding:"6px"},focusable:!1,onClick:V},{default:o(()=>[s(n,{size:"18"},{default:o(()=>[s(u,{style:{"vertical-align":"baseline"}})]),_:1})]),_:2},1032,["quaternary","tertiary","type","onClick"])]),_:1},8,["editor"]),s(r,{strong:"",type:"primary",size:"small",loading:t(v),focusable:!1,onClick:a[1]||(a[1]=p=>N("save"))},{icon:o(()=>[s(k)]),default:o(()=>[ae(" "+oe(t(c)("editor.main.saveButton")),1)]),_:1},8,["loading"])]),_:1})]),_:1},512),[[te,t(i)]])]),default:o(()=>[s(T,{name:"fade",mode:"out-in",appear:"",style:{"border-bottom-left-radius":"6px","border-bottom-right-radius":"6px"}},{default:o(()=>[t(i)?(C(),w(t(Q),{key:0,ref_key:"editorRef",ref:_,value:t(m),"font-size":t(L)},null,8,["value","font-size"])):(C(),w(S,{key:1,class:"min-h-200px flex-jc-ac h-full",size:"huge",description:t(c)("common.selectFileEmptyDesc")},{icon:o(()=>[s(n,null,{default:o(()=>[s(M)]),_:1})]),_:1},8,["description"]))]),_:1}),s(j,{show:t(b)},null,8,["show"])]),_:1},8,["bordered"])]),_:1})}}});export{Re as default};
